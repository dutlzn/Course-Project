---
typora-root-url: /images
---

# 单表管理功能前后端开发

## 大章列表查询功能开发

### 增加maven子项目business

把system pom.xml里的依赖全部拷贝到business中

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>course</artifactId>
        <groupId>com.lzn</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>business</artifactId>
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- 集成mybatis -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>

        <dependency>
            <groupId>com.lzn</groupId>
            <artifactId>server</artifactId>
        </dependency>
        <dependency>
            <groupId>com.lzn</groupId>
            <artifactId>server</artifactId>
        </dependency>


    </dependencies>

</project>
```

在business下面新建com.lzn.buiness包

把system下面的config和controller全部拷贝到这里来

重命名BusinessApplication



拷贝business里的resource文件

属性配置如下

```
spring.application.name=business
server.servlet.context-path=/business
server.port=9002
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

#spring.datasource.url=jdbc:mysql://192.168.56.101:3306/couse?characterEncoding=UTF8&autoReconnect=true
#spring.datasource.username=root
#spring.datasource.password=123456
#spring.datasource.driver-class-name=com.mysql.jdbc.Driver
#
#
## mybatis 路径
#mybatis.mapper-locations=classpath:/mapper/*.xml
#
## 日志输出级别
#logging.level.com.lzn.mapper=trace
#

```





新建大章sql

```
# ------ 大章 ---------
drop table if EXISTS `chapter`;
create table `chapter` (
	`id` char(8) not null COMMENT 'ID',
	`course_id` char(8) comment '课程id',
	`name` varchar(50) comment '名称',
	primary key (`id`)
) ENGINE=INNODB DEFAULT charset=utf8mb4 comment='大章';

# ----------------测试
drop table if exists `test`;
create table `test` (
    `id` char(8) not null default '' comment 'id',
    `name` varchar(255) comment '名称',
    primary key (`id`)
) engine=innodb default charset=utf8mb4 ;

insert into `test` (id, name) values (1, '测试');
insert into `test` (id, name) values (3, '测试2');



```

修改mapper 代码生成器

```
<table tableName="chapter" domainObjectName="Chapter"/>
```

### 完成后端列表查询接口

server service

```java
package com.lzn.service;

import com.lzn.domain.Chapter;
import com.lzn.domain.ChapterExample;
import com.lzn.domain.Test;
import com.lzn.domain.TestExample;
import com.lzn.mapper.ChapterMapper;
import com.lzn.mapper.TestMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;


@Service
public class ChapterService {

    @Autowired
    private ChapterMapper chapterMapper;


    public List<Chapter> list() {
//        return testMapper.list();
        ChapterExample chapterExample = new ChapterExample();


        // createCriteria才是相当于where
        chapterExample.createCriteria().andIdEqualTo("1");
//        testExample.setOrderByClause("id asc");// id 从小到大
        chapterExample.setOrderByClause("id desc");// id 从大到小
        return chapterMapper.selectByExample(chapterExample);
    }
}

```



business controller

```java
package com.lzn.business.controller;


import com.lzn.domain.Chapter;
import com.lzn.service.ChapterService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
public class ChapterController {
    @Autowired
    private ChapterService chapterService;

    @RequestMapping("/chapter")
    public List<Chapter> chapter() {
        return chapterService.list();
    }
}

```

business controller 

web 包 外网

admin 包 控台使用

ChapterController放在admin下面

```java
package com.lzn.business.controller.admin;


import com.lzn.domain.Chapter;
import com.lzn.service.ChapterService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("/admin")
public class ChapterController {
    @Autowired
    private ChapterService chapterService;

    @RequestMapping("/chapter")
    public List<Chapter> chapter() {
        return chapterService.list();
    }
}

```







分层

server domain 是属于底层的

增加数据传输层 dto 数据传输对象,用于数据传输

domain内的实体,是mybatis 自动生成的,不允许手动修改,一旦修改 再次生成实体类, 所做的的修改会被覆盖

domain 作用于service 和 mapper  

dto作用于ctroller 和 service



Chapter改名 ChapterDto

修改服务

```java
package com.lzn.service;

import com.lzn.domain.Chapter;
import com.lzn.domain.ChapterExample;
import com.lzn.domain.Test;
import com.lzn.domain.TestExample;
import com.lzn.dto.ChapterDto;
import com.lzn.mapper.ChapterMapper;
import com.lzn.mapper.TestMapper;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;


@Service
public class ChapterService {

    @Autowired
    private ChapterMapper chapterMapper;


    public List<ChapterDto> list() {
        ChapterExample chapterExample = new ChapterExample();
        chapterExample.createCriteria().andIdEqualTo("1");
        chapterExample.setOrderByClause("id desc");
        List<Chapter> chapterList = chapterMapper.selectByExample(chapterExample);
        List<ChapterDto> chapterDtoList = new ArrayList<>();

        for(int i = 0;i<chapterList.size();++i){
            Chapter chapter = chapterList.get(i);
            ChapterDto chapterDto = new ChapterDto();
            BeanUtils.copyProperties(chapter, chapterDto);
            chapterDtoList.add(chapterDto);
        }


        return chapterDtoList;


    }
}

```



增加测试数据

```sql
# ------ 大章 ---------
drop table if EXISTS `chapter`;
create table `chapter` (
	`id` char(8) not null COMMENT 'ID',
	`course_id` char(8) comment '课程id',
	`name` varchar(50) comment '名称',
	primary key (`id`)
) ENGINE=INNODB DEFAULT charset=utf8mb4 comment='大章';

insert into `chapter` (id, course_id, name) values ('00000000', '0000000', '测试大章一');
insert into `chapter` (id, course_id, name) values ('00000001', '0000001', '测试大章二');

# ----------------测试
drop table if exists `test`;
create table `test` (
    `id` char(8) not null default '' comment 'id',
    `name` varchar(255) comment '名称',
    primary key (`id`)
) engine=innodb default charset=utf8mb4 ;

insert into `test` (id, name) values (1, '测试');
insert into `test` (id, name) values (3, '测试2');



```



### 前端页面开发

路由

```
import Vue from 'vue'
import Router from 'vue-router'
import Login from './views/login.vue'
import Admin from './views/admin.vue'
import Welcome from './views/admin/welcome.vue'
import Chapter from './views/admin/chapter.vue'

Vue.use(Router);

export default new Router(
    {
        mode: 'history', // history hash 推荐使用history hash 的话前面由前缀，url形式不美观，history推荐使用，路由前面只有以恶搞#
        base: process.env.BASE_URL,
        routes: [{
            path: '*',
            redirect: "/login",
        }, {
            path: "/login",
            component: Login
        }, {
            path: "/admin",
            component: Admin,
            children: [{
                path: 'welcome',
                component: Welcome

            }, {
                path: 'business/chapter',
                component: Chapter
            }]
        }]
    }

)
```





利用tables 模板

定位  <!-- *PAGE CONTENT BEGINS* -->

直接复制到chapter.vue中

展示  假数据\

由于admin中已经有了row 和 col-xs-12的样式,所以chapter就不用了

```
<template>

    <table id="simple-table" class="table table-bordered table-hover">
        <thead>
            <tr>
                <th class="center">
                    <label class="pos-rel">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </th>
                <th class="detail-col">Details</th>
                <th>Domain</th>
                <th>Price</th>
                <th class="hidden-480">Clicks</th>

                <th>
                    <i class="ace-icon fa fa-clock-o bigger-110 hidden-480"></i>
                    Update
                </th>
                <th class="hidden-480">Status</th>

                <th></th>
            </tr>
        </thead>

        <tbody>
            <tr>
                <td class="center">
                    <label class="pos-rel">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </td>

                <td class="center">
                    <div class="action-buttons">
                        <a href="#" class="green bigger-140 show-details-btn" title="Show Details">
                            <i class="ace-icon fa fa-angle-double-down"></i>
                            <span class="sr-only">Details</span>
                        </a>
                    </div>
                </td>

                <td>
                    <a href="#">ace.com</a>
                </td>
                <td>$45</td>
                <td class="hidden-480">3,330</td>
                <td>Feb 12</td>

                <td class="hidden-480">
                    <span class="label label-sm label-warning">Expiring</span>
                </td>

                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown"
                                data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul
                                class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>

            <tr class="detail-row">
                <td colspan="8">
                    <div class="table-detail">
                        <div class="row">
                            <div class="col-xs-12 col-sm-2">
                                <div class="text-center">
                                    <img height="150" class="thumbnail inline no-margin-bottom"
                                        alt="Domain Owner's Avatar"
                                        src="assets/images/avatars/profile-pic.jpg" />
                                    <br />
                                    <div
                                        class="width-80 label label-info label-xlg arrowed-in arrowed-in-right">
                                        <div class="inline position-relative">
                                            <a class="user-title-label" href="#">
                                                <i class="ace-icon fa fa-circle light-green"></i>
                                                &nbsp;
                                                <span class="white">Alex M. Doe</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-7">
                                <div class="space visible-xs"></div>

                                <div class="profile-user-info profile-user-info-striped">
                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Username</div>

                                        <div class="profile-info-value">
                                            <span>alexdoe</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Location</div>

                                        <div class="profile-info-value">
                                            <i class="fa fa-map-marker light-orange bigger-110"></i>
                                            <span>Netherlands, Amsterdam</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Age</div>

                                        <div class="profile-info-value">
                                            <span>38</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Joined</div>

                                        <div class="profile-info-value">
                                            <span>2010/06/20</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Last Online</div>

                                        <div class="profile-info-value">
                                            <span>3 hours ago</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">About Me</div>

                                        <div class="profile-info-value">
                                            <span>Bio</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-3">
                                <div class="space visible-xs"></div>
                                <h4 class="header blue lighter less-margin">Send a message to Alex</h4>

                                <div class="space-6"></div>

                                <form>
                                    <fieldset>
                                        <textarea class="width-100" resize="none"
                                            placeholder="Type something…"></textarea>
                                    </fieldset>

                                    <div class="hr hr-dotted"></div>

                                    <div class="clearfix">
                                        <label class="pull-left">
                                            <input type="checkbox" class="ace" />
                                            <span class="lbl">Email me a copy</span>
                                        </label>

                                        <button class="pull-right btn btn-sm btn-primary btn-white btn-round"
                                            type="button">
                                            Submit
                                            <i class="ace-icon fa fa-arrow-right icon-on-right bigger-110"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td class="center">
                    <label class="pos-rel">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </td>

                <td class="center">
                    <div class="action-buttons">
                        <a href="#" class="green bigger-140 show-details-btn" title="Show Details">
                            <i class="ace-icon fa fa-angle-double-down"></i>
                            <span class="sr-only">Details</span>
                        </a>
                    </div>
                </td>

                <td>
                    <a href="#">base.com</a>
                </td>
                <td>$35</td>
                <td class="hidden-480">2,595</td>
                <td>Feb 18</td>

                <td class="hidden-480">
                    <span class="label label-sm label-success">Registered</span>
                </td>

                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown"
                                data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul
                                class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>

            <tr class="detail-row">
                <td colspan="8">
                    <div class="table-detail">
                        <div class="row">
                            <div class="col-xs-12 col-sm-2">
                                <div class="text-center">
                                    <img height="150" class="thumbnail inline no-margin-bottom"
                                        alt="Domain Owner's Avatar"
                                        src="assets/images/avatars/profile-pic.jpg" />
                                    <br />
                                    <div
                                        class="width-80 label label-info label-xlg arrowed-in arrowed-in-right">
                                        <div class="inline position-relative">
                                            <a class="user-title-label" href="#">
                                                <i class="ace-icon fa fa-circle light-green"></i>
                                                &nbsp;
                                                <span class="white">Alex M. Doe</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-7">
                                <div class="space visible-xs"></div>

                                <div class="profile-user-info profile-user-info-striped">
                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Username</div>

                                        <div class="profile-info-value">
                                            <span>alexdoe</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Location</div>

                                        <div class="profile-info-value">
                                            <i class="fa fa-map-marker light-orange bigger-110"></i>
                                            <span>Netherlands, Amsterdam</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Age</div>

                                        <div class="profile-info-value">
                                            <span>38</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Joined</div>

                                        <div class="profile-info-value">
                                            <span>2010/06/20</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Last Online</div>

                                        <div class="profile-info-value">
                                            <span>3 hours ago</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">About Me</div>

                                        <div class="profile-info-value">
                                            <span>Bio</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-3">
                                <div class="space visible-xs"></div>
                                <h4 class="header blue lighter less-margin">Send a message to Alex</h4>

                                <div class="space-6"></div>

                                <form>
                                    <fieldset>
                                        <textarea class="width-100" resize="none"
                                            placeholder="Type something…"></textarea>
                                    </fieldset>

                                    <div class="hr hr-dotted"></div>

                                    <div class="clearfix">
                                        <label class="pull-left">
                                            <input type="checkbox" class="ace" />
                                            <span class="lbl">Email me a copy</span>
                                        </label>

                                        <button class="pull-right btn btn-sm btn-primary btn-white btn-round"
                                            type="button">
                                            Submit
                                            <i class="ace-icon fa fa-arrow-right icon-on-right bigger-110"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td class="center">
                    <label class="pos-rel">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </td>

                <td class="center">
                    <div class="action-buttons">
                        <a href="#" class="green bigger-140 show-details-btn" title="Show Details">
                            <i class="ace-icon fa fa-angle-double-down"></i>
                            <span class="sr-only">Details</span>
                        </a>
                    </div>
                </td>

                <td>
                    <a href="#">max.com</a>
                </td>
                <td>$60</td>
                <td class="hidden-480">4,400</td>
                <td>Mar 11</td>

                <td class="hidden-480">
                    <span class="label label-sm label-warning">Expiring</span>
                </td>

                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown"
                                data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul
                                class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>

            <tr class="detail-row">
                <td colspan="8">
                    <div class="table-detail">
                        <div class="row">
                            <div class="col-xs-12 col-sm-2">
                                <div class="text-center">
                                    <img height="150" class="thumbnail inline no-margin-bottom"
                                        alt="Domain Owner's Avatar"
                                        src="assets/images/avatars/profile-pic.jpg" />
                                    <br />
                                    <div
                                        class="width-80 label label-info label-xlg arrowed-in arrowed-in-right">
                                        <div class="inline position-relative">
                                            <a class="user-title-label" href="#">
                                                <i class="ace-icon fa fa-circle light-green"></i>
                                                &nbsp;
                                                <span class="white">Alex M. Doe</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-7">
                                <div class="space visible-xs"></div>

                                <div class="profile-user-info profile-user-info-striped">
                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Username</div>

                                        <div class="profile-info-value">
                                            <span>alexdoe</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Location</div>

                                        <div class="profile-info-value">
                                            <i class="fa fa-map-marker light-orange bigger-110"></i>
                                            <span>Netherlands, Amsterdam</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Age</div>

                                        <div class="profile-info-value">
                                            <span>38</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Joined</div>

                                        <div class="profile-info-value">
                                            <span>2010/06/20</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Last Online</div>

                                        <div class="profile-info-value">
                                            <span>3 hours ago</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">About Me</div>

                                        <div class="profile-info-value">
                                            <span>Bio</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-3">
                                <div class="space visible-xs"></div>
                                <h4 class="header blue lighter less-margin">Send a message to Alex</h4>

                                <div class="space-6"></div>

                                <form>
                                    <fieldset>
                                        <textarea class="width-100" resize="none"
                                            placeholder="Type something…"></textarea>
                                    </fieldset>

                                    <div class="hr hr-dotted"></div>

                                    <div class="clearfix">
                                        <label class="pull-left">
                                            <input type="checkbox" class="ace" />
                                            <span class="lbl">Email me a copy</span>
                                        </label>

                                        <button class="pull-right btn btn-sm btn-primary btn-white btn-round"
                                            type="button">
                                            Submit
                                            <i class="ace-icon fa fa-arrow-right icon-on-right bigger-110"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td class="center">
                    <label class="pos-rel">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </td>

                <td class="center">
                    <div class="action-buttons">
                        <a href="#" class="green bigger-140 show-details-btn" title="Show Details">
                            <i class="ace-icon fa fa-angle-double-down"></i>
                            <span class="sr-only">Details</span>
                        </a>
                    </div>
                </td>

                <td>
                    <a href="#">best.com</a>
                </td>
                <td>$75</td>
                <td class="hidden-480">6,500</td>
                <td>Apr 03</td>

                <td class="hidden-480">
                    <span class="label label-sm label-inverse arrowed-in">Flagged</span>
                </td>

                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown"
                                data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul
                                class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>

            <tr class="detail-row">
                <td colspan="8">
                    <div class="table-detail">
                        <div class="row">
                            <div class="col-xs-12 col-sm-2">
                                <div class="text-center">
                                    <img height="150" class="thumbnail inline no-margin-bottom"
                                        alt="Domain Owner's Avatar"
                                        src="assets/images/avatars/profile-pic.jpg" />
                                    <br />
                                    <div
                                        class="width-80 label label-info label-xlg arrowed-in arrowed-in-right">
                                        <div class="inline position-relative">
                                            <a class="user-title-label" href="#">
                                                <i class="ace-icon fa fa-circle light-green"></i>
                                                &nbsp;
                                                <span class="white">Alex M. Doe</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-7">
                                <div class="space visible-xs"></div>

                                <div class="profile-user-info profile-user-info-striped">
                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Username</div>

                                        <div class="profile-info-value">
                                            <span>alexdoe</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Location</div>

                                        <div class="profile-info-value">
                                            <i class="fa fa-map-marker light-orange bigger-110"></i>
                                            <span>Netherlands, Amsterdam</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Age</div>

                                        <div class="profile-info-value">
                                            <span>38</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Joined</div>

                                        <div class="profile-info-value">
                                            <span>2010/06/20</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Last Online</div>

                                        <div class="profile-info-value">
                                            <span>3 hours ago</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">About Me</div>

                                        <div class="profile-info-value">
                                            <span>Bio</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-3">
                                <div class="space visible-xs"></div>
                                <h4 class="header blue lighter less-margin">Send a message to Alex</h4>

                                <div class="space-6"></div>

                                <form>
                                    <fieldset>
                                        <textarea class="width-100" resize="none"
                                            placeholder="Type something…"></textarea>
                                    </fieldset>

                                    <div class="hr hr-dotted"></div>

                                    <div class="clearfix">
                                        <label class="pull-left">
                                            <input type="checkbox" class="ace" />
                                            <span class="lbl">Email me a copy</span>
                                        </label>

                                        <button class="pull-right btn btn-sm btn-primary btn-white btn-round"
                                            type="button">
                                            Submit
                                            <i class="ace-icon fa fa-arrow-right icon-on-right bigger-110"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td class="center">
                    <label class="pos-rel">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </td>

                <td class="center">
                    <div class="action-buttons">
                        <a href="#" class="green bigger-140 show-details-btn" title="Show Details">
                            <i class="ace-icon fa fa-angle-double-down"></i>
                            <span class="sr-only">Details</span>
                        </a>
                    </div>
                </td>

                <td>
                    <a href="#">pro.com</a>
                </td>
                <td>$55</td>
                <td class="hidden-480">4,250</td>
                <td>Jan 21</td>

                <td class="hidden-480">
                    <span class="label label-sm label-success">Registered</span>
                </td>

                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown"
                                data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul
                                class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>

            <tr class="detail-row">
                <td colspan="8">
                    <div class="table-detail">
                        <div class="row">
                            <div class="col-xs-12 col-sm-2">
                                <div class="text-center">
                                    <img height="150" class="thumbnail inline no-margin-bottom"
                                        alt="Domain Owner's Avatar"
                                        src="assets/images/avatars/profile-pic.jpg" />
                                    <br />
                                    <div
                                        class="width-80 label label-info label-xlg arrowed-in arrowed-in-right">
                                        <div class="inline position-relative">
                                            <a class="user-title-label" href="#">
                                                <i class="ace-icon fa fa-circle light-green"></i>
                                                &nbsp;
                                                <span class="white">Alex M. Doe</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-7">
                                <div class="space visible-xs"></div>

                                <div class="profile-user-info profile-user-info-striped">
                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Username</div>

                                        <div class="profile-info-value">
                                            <span>alexdoe</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Location</div>

                                        <div class="profile-info-value">
                                            <i class="fa fa-map-marker light-orange bigger-110"></i>
                                            <span>Netherlands, Amsterdam</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Age</div>

                                        <div class="profile-info-value">
                                            <span>38</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Joined</div>

                                        <div class="profile-info-value">
                                            <span>2010/06/20</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">Last Online</div>

                                        <div class="profile-info-value">
                                            <span>3 hours ago</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name">About Me</div>

                                        <div class="profile-info-value">
                                            <span>Bio</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-3">
                                <div class="space visible-xs"></div>
                                <h4 class="header blue lighter less-margin">Send a message to Alex</h4>

                                <div class="space-6"></div>

                                <form>
                                    <fieldset>
                                        <textarea class="width-100" resize="none"
                                            placeholder="Type something…"></textarea>
                                    </fieldset>

                                    <div class="hr hr-dotted"></div>

                                    <div class="clearfix">
                                        <label class="pull-left">
                                            <input type="checkbox" class="ace" />
                                            <span class="lbl">Email me a copy</span>
                                        </label>

                                        <button class="pull-right btn btn-sm btn-primary btn-white btn-round"
                                            type="button">
                                            Submit
                                            <i class="ace-icon fa fa-arrow-right icon-on-right bigger-110"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>

</template>>
```





点击siderbar菜单实现页面跳转

二级菜单要显示成激活状态,只需要添加active样式

  <ul *class*="submenu">

​                            <li *class*="active">

                                <a href="tables.html">

​                                    <i *class*="menu-icon fa fa-caret-right"></i>

​                                    大章管理

​                                </a>





点击菜单,激活,跳转到相应的路由

```js
  */
            activeSidebar: function (id) {
                // 兄弟菜单去掉active样式，自身增加active样式
                // siblings是jquery的方法,获取兄弟节点
                $("#" + id).siblings().removeClass("active");
                $("#" + id).siblings().find("li").removeClass("active");
                $("#" + id).addClass("active");

                // 如果有父菜单，父菜单的兄弟菜单去掉open active，父菜单增加open active
                let parentLi = $("#" + id).parents("li");
                if (parentLi) {
                    parentLi.siblings().removeClass("open active");
                    parentLi.siblings().find("li").removeClass("active");
                    parentLi.addClass("open active");
                }
            },
```



给元素增加id属性

id的命名要和路由相关,后续我们会用到这个约定

子组件调用父组件的方法可以用 $parent





```vue
<template>
    <div>
        <div id="navbar" class="navbar navbar-default ace-save-state">
            <div class="navbar-container ace-save-state" id="navbar-container">
                <button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler"
                    data-target="#sidebar">
                    <span class="sr-only">Toggle sidebar</span>

                    <span class="icon-bar"></span>

                    <span class="icon-bar"></span>

                    <span class="icon-bar"></span>
                </button>

                <div class="navbar-header pull-left">
                    <a href="index.html" class="navbar-brand">
                        <small>
                            <i class="fa fa-leaf"></i>
                            在线视频系统
                        </small>
                    </a>
                </div>

                <div class="navbar-buttons navbar-header pull-right" role="navigation">
                    <ul class="nav ace-nav">
                        <li class="grey dropdown-modal">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                <i class="ace-icon fa fa-tasks"></i>
                                <span class="badge badge-grey">4</span>
                            </a>

                            <ul class="dropdown-menu-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
                                <li class="dropdown-header">
                                    <i class="ace-icon fa fa-check"></i>
                                    4 Tasks to complete
                                </li>

                                <li class="dropdown-content">
                                    <ul class="dropdown-menu dropdown-navbar">
                                        <li>
                                            <a href="#">
                                                <div class="clearfix">
                                                    <span class="pull-left">Software Update</span>
                                                    <span class="pull-right">65%</span>
                                                </div>

                                                <div class="progress progress-mini">
                                                    <div style="width:65%" class="progress-bar"></div>
                                                </div>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#">
                                                <div class="clearfix">
                                                    <span class="pull-left">Hardware Upgrade</span>
                                                    <span class="pull-right">35%</span>
                                                </div>

                                                <div class="progress progress-mini">
                                                    <div style="width:35%" class="progress-bar progress-bar-danger">
                                                    </div>
                                                </div>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#">
                                                <div class="clearfix">
                                                    <span class="pull-left">Unit Testing</span>
                                                    <span class="pull-right">15%</span>
                                                </div>

                                                <div class="progress progress-mini">
                                                    <div style="width:15%" class="progress-bar progress-bar-warning">
                                                    </div>
                                                </div>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#">
                                                <div class="clearfix">
                                                    <span class="pull-left">Bug Fixes</span>
                                                    <span class="pull-right">90%</span>
                                                </div>

                                                <div class="progress progress-mini progress-striped active">
                                                    <div style="width:90%" class="progress-bar progress-bar-success">
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </li>

                                <li class="dropdown-footer">
                                    <a href="#">
                                        See tasks with details
                                        <i class="ace-icon fa fa-arrow-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="purple dropdown-modal">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                <i class="ace-icon fa fa-bell icon-animated-bell"></i>
                                <span class="badge badge-important">8</span>
                            </a>

                            <ul
                                class="dropdown-menu-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
                                <li class="dropdown-header">
                                    <i class="ace-icon fa fa-exclamation-triangle"></i>
                                    8 Notifications
                                </li>

                                <li class="dropdown-content">
                                    <ul class="dropdown-menu dropdown-navbar navbar-pink">
                                        <li>
                                            <a href="#">
                                                <div class="clearfix">
                                                    <span class="pull-left">
                                                        <i class="btn btn-xs no-hover btn-pink fa fa-comment"></i>
                                                        New Comments
                                                    </span>
                                                    <span class="pull-right badge badge-info">+12</span>
                                                </div>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#">
                                                <i class="btn btn-xs btn-primary fa fa-user"></i>
                                                Bob just signed up as an editor ...
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#">
                                                <div class="clearfix">
                                                    <span class="pull-left">
                                                        <i
                                                            class="btn btn-xs no-hover btn-success fa fa-shopping-cart"></i>
                                                        New Orders
                                                    </span>
                                                    <span class="pull-right badge badge-success">+8</span>
                                                </div>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#">
                                                <div class="clearfix">
                                                    <span class="pull-left">
                                                        <i class="btn btn-xs no-hover btn-info fa fa-twitter"></i>
                                                        Followers
                                                    </span>
                                                    <span class="pull-right badge badge-info">+11</span>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </li>

                                <li class="dropdown-footer">
                                    <a href="#">
                                        See all notifications
                                        <i class="ace-icon fa fa-arrow-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="green dropdown-modal">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                <i class="ace-icon fa fa-envelope icon-animated-vertical"></i>
                                <span class="badge badge-success">5</span>
                            </a>

                            <ul class="dropdown-menu-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
                                <li class="dropdown-header">
                                    <i class="ace-icon fa fa-envelope-o"></i>
                                    5 Messages
                                </li>

                                <li class="dropdown-content">
                                    <ul class="dropdown-menu dropdown-navbar">
                                        <li>
                                            <a href="#" class="clearfix">
                                                <img src="../../public/ace/assets/images/avatars/avatar.png"
                                                    class="msg-photo" alt="Alex's Avatar" />
                                                <span class="msg-body">
                                                    <span class="msg-title">
                                                        <span class="blue">Alex:</span>
                                                        Ciao sociis natoque penatibus et auctor ...
                                                    </span>

                                                    <span class="msg-time">
                                                        <i class="ace-icon fa fa-clock-o"></i>
                                                        <span>a moment ago</span>
                                                    </span>
                                                </span>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#" class="clearfix">
                                                <img src="../../public/ace/assets/images/avatars/avatar3.png"
                                                    class="msg-photo" alt="Susan's Avatar" />
                                                <span class="msg-body">
                                                    <span class="msg-title">
                                                        <span class="blue">Susan:</span>
                                                        Vestibulum id ligula porta felis euismod ...
                                                    </span>

                                                    <span class="msg-time">
                                                        <i class="ace-icon fa fa-clock-o"></i>
                                                        <span>20 minutes ago</span>
                                                    </span>
                                                </span>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#" class="clearfix">
                                                <img src="../../public/ace/assets/images/avatars/avatar4.png"
                                                    class="msg-photo" alt="Bob's Avatar" />
                                                <span class="msg-body">
                                                    <span class="msg-title">
                                                        <span class="blue">Bob:</span>
                                                        Nullam quis risus eget urna mollis ornare ...
                                                    </span>

                                                    <span class="msg-time">
                                                        <i class="ace-icon fa fa-clock-o"></i>
                                                        <span>3:15 pm</span>
                                                    </span>
                                                </span>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#" class="clearfix">
                                                <img src="../../public/ace/assets/images/avatars/avatar2.png"
                                                    class="msg-photo" alt="Kate's Avatar" />
                                                <span class="msg-body">
                                                    <span class="msg-title">
                                                        <span class="blue">Kate:</span>
                                                        Ciao sociis natoque eget urna mollis ornare ...
                                                    </span>

                                                    <span class="msg-time">
                                                        <i class="ace-icon fa fa-clock-o"></i>
                                                        <span>1:33 pm</span>
                                                    </span>
                                                </span>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="#" class="clearfix">
                                                <img src="../../public/ace/assets/images/avatars/avatar5.png"
                                                    class="msg-photo" alt="Fred's Avatar" />
                                                <span class="msg-body">
                                                    <span class="msg-title">
                                                        <span class="blue">Fred:</span>
                                                        Vestibulum id penatibus et auctor ...
                                                    </span>

                                                    <span class="msg-time">
                                                        <i class="ace-icon fa fa-clock-o"></i>
                                                        <span>10:09 am</span>
                                                    </span>
                                                </span>
                                            </a>
                                        </li>
                                    </ul>
                                </li>

                                <li class="dropdown-footer">
                                    <a href="inbox.html">
                                        See all messages
                                        <i class="ace-icon fa fa-arrow-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="light-blue dropdown-modal">
                            <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                                <img class="nav-user-photo" src="../../public/ace/assets/images/avatars/user.jpg"
                                    alt="Jason's Photo" />
                                <span class="user-info">
                                    <small>Welcome,</small>
                                    Jason
                                </span>

                                <i class="ace-icon fa fa-caret-down"></i>
                            </a>

                            <ul
                                class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                                <li>
                                    <a href="#">
                                        <i class="ace-icon fa fa-cog"></i>
                                        Settings
                                    </a>
                                </li>

                                <li>
                                    <a href="profile.html">
                                        <i class="ace-icon fa fa-user"></i>
                                        Profile
                                    </a>
                                </li>

                                <li class="divider"></li>

                                <li>
                                    <a href="#">
                                        <i class="ace-icon fa fa-power-off"></i>
                                        Logout
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-container -->
        </div>

        <div class="main-container ace-save-state" id="main-container">
            <!-- <script type="text/javascript">
                try {
                    ace.settings.loadState("main-container");
                } catch (e) { }
            </script> -->

            <div id="sidebar" class="sidebar responsive ace-save-state">
                <!-- <script type="text/javascript">
                    try {
                        ace.settings.loadState("sidebar");
                    } catch (e) { }
                </script> -->

                <div class="sidebar-shortcuts" id="sidebar-shortcuts">
                    <div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
                        <button class="btn btn-success">
                            <i class="ace-icon fa fa-signal"></i>
                        </button>

                        <button class="btn btn-info">
                            <i class="ace-icon fa fa-pencil"></i>
                        </button>

                        <button class="btn btn-warning">
                            <i class="ace-icon fa fa-users"></i>
                        </button>

                        <button class="btn btn-danger">
                            <i class="ace-icon fa fa-cogs"></i>
                        </button>
                    </div>

                    <div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
                        <span class="btn btn-success"></span>

                        <span class="btn btn-info"></span>

                        <span class="btn btn-warning"></span>

                        <span class="btn btn-danger"></span>
                    </div>
                </div>
                <!-- /.sidebar-shortcuts -->

                <ul class="nav nav-list">
                    <li class="" id="welcome-sidebar">
                        <a href="index.html">
                            <i class="menu-icon fa fa-tachometer"></i>
                            <span class="menu-text">欢迎</span>
                        </a>

                        <b class="arrow"></b>
                    </li>



                    <li class="">
                        <a href="#" class="dropdown-toggle">
                            <i class="menu-icon fa fa-list"></i>
                            <span class="menu-text">系统管理</span>

                            <b class="arrow fa fa-angle-down"></b>
                        </a>

                        <b class="arrow"></b>

                        <ul class="submenu">
                            <li class>
                                <a href="tables.html">
                                    <i class="menu-icon fa fa-caret-right"></i>
                                    用户管理
                                </a>

                                <b class="arrow"></b>
                            </li>

                            <li class>
                                <a href="jqgrid.html">
                                    <i class="menu-icon fa fa-caret-right"></i>
                                    权限管理
                                </a>

                                <b class="arrow"></b>
                            </li>
                        </ul>
                    </li>

                    <li class="active open">
                        <a href="#" class="dropdown-toggle">
                            <i class="menu-icon fa fa-list"></i>
                            <span class="menu-text">业务管理</span>

                            <b class="arrow fa fa-angle-down"></b>
                        </a>

                        <b class="arrow"></b>

                        <ul class="submenu">
                            <li class="active" id="business-chapter-sidebar">
                                <a href="tables.html">
                                    <i class="menu-icon fa fa-caret-right"></i>
                                    大章管理
                                </a>

                                <b class="arrow"></b>
                            </li>

                        </ul>
                    </li>



                </ul>
                <!-- /.nav-list -->

                <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
                    <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state"
                        data-icon1="ace-icon fa fa-angle-double-left"
                        data-icon2="ace-icon fa fa-angle-double-right"></i>
                </div>
            </div>

            <div class="main-content">
                <div class="main-content-inner">


                    <div class="page-content">

                        <div class="row">
                            <div class="col-xs-12">
                                <!-- PAGE CONTENT BEGINS -->
                                <router-view></router-view>
                                <!-- PAGE CONTENT ENDS -->
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                    </div>
                    <!-- /.page-content -->
                </div>
            </div>
            <!-- /.main-content -->

            <div class="footer">
                <div class="footer-inner">
                    <div class="footer-content">
                        <span class="bigger-120">
                            <span class="blue bolder">无敌</span>
                            版权所有 &copy; 2020
                        </span>
                        &nbsp; &nbsp;

                    </div>
                </div>
            </div>

            <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
                <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
            </a>
        </div>
        <!-- /.main-container -->
    </div>
</template>

<script>
    export default {
        name: 'admin',
        mounted: function () {
            $('body').removeAttr('class', 'login-layout light-login');
            $('body').attr('class', 'no-skin');
        },
        methods: {
            
            /**
            菜单激活样式，id是当前点击的菜单的id
            */
            /**
         * 菜单激活样式，id是当前点击的菜单的id
         * @param id
         */
            activeSidebar: function (id) {
                // 兄弟菜单去掉active样式，自身增加active样式
                $("#" + id).siblings().removeClass("active");
                $("#" + id).siblings().find("li").removeClass("active");
                $("#" + id).addClass("active");

                // 如果有父菜单，父菜单的兄弟菜单去掉open active，父菜单增加open active
                let parentLi = $("#" + id).parents("li");
                if (parentLi) {
                    parentLi.siblings().removeClass("open active");
                    // parentLi.siblings().find("li").removeClass("active");
                    parentLi.addClass("open active");
                }
            },


        }
    }


</script>
```





进入welcome 最下面追加

```vue
<script>
export default {
    name: 'welcome',
    // 页面初始化加载
    mounted: function() {
        this.$parent.activeSidebar('welcome-sidebar');
    },

    
    methods: {

    }
}
</script>
```





进入chapter

```vue

<script>
export default {
    name: 'chapter',

    // 页面初始化加载方法
    mounted: function() {
        this.$parent.activeSidebar('business-chapter-sidebar');
    },
    methods: {

    }
}
</script>
```



在浏览器中输入地址,就可以看到菜单激活的样式了



接下去做路由自动跳转功能



点击跳转

<router-link to=""> 类似于 <a href ="">用于连接跳转



```
          <li class="active" id="business-chapter-sidebar">
                                <router-link to="/admin/business/chapter">
                                    <i class="menu-icon fa fa-caret-right"></i>
                                    大章管理
                                </router-link>

                                <b class="arrow"></b>
                            </li>
```





为每一个路由都 加上一个name属性,后续做通用的sidebar激活样式方法时候会用到



路由修改

login.vue

```
<script>
export default {
  name: "login",
  mounted: function() {
    $("body").attr("class", "login-layout light-login");
  },
  methods: {
    login() {
      this.$router.push("/welcome");
    }
  }
};
</script>

```





admin.vue  去掉/admin

```
          <li class="" id="welcome-sidebar">
                        <router-link to="/welcome">
                            <i class="menu-icon fa fa-tachometer"></i>
                            <span class="menu-text">欢迎</span>
                        </router-link>

                        <b class="arrow"></b>
                    </li>

```



修改router.js

```vue
import Vue from 'vue'
import Router from 'vue-router'
import Login from './views/login.vue'
import Admin from './views/admin.vue'
import Welcome from './views/admin/welcome.vue'
import Chapter from './views/admin/chapter.vue'

Vue.use(Router);

export default new Router(
    {
        mode: 'history', // history hash 推荐使用history hash 的话前面由前缀，url形式不美观，history推荐使用，路由前面只有以恶搞#
        base: process.env.BASE_URL,
        routes: [{
            path: '*',
            redirect: "/login",
        }, {
            path: "/login",
            component: Login
        }, {
            path: "/",
            name: "admin",
            component: Admin,
            children: [{
                path: 'welcome',
                name: 'welcome',
                component: Welcome

            }, {
                path: 'business/chapter',
                name: 'business/chapter',
                component: Chapter
            }]
        }]
    }

)
```



通用的sidebar点击激活样式方法

vue 内置的watch,用来检测vue实例上的数据变化,$route也是一个变量

admin.vue

```
  watch: {
    $route: {
      handler: function(val, oldVal) {
        // sidebar激活样式方法二
        console.log("---->页面跳转：", val, oldVal);

        _this.$nextTick(function() {
          //页面加载完成后执行
          _this.activeSidebar(_this.$route.name.replace("/", "-") + "-sidebar");
        });
      }
    }
  },
```



然后就可以去掉 chapter 和 welcome 里sidebar的话了

通过name属性值,得到菜单id的值,前面我们有约定,id的命名要和路由相关,程序开发中有一个设计范式叫,约定优于配置,(按约定编程)

此时如果从login点击登录跳到welcome页面 , welcome并不会有激活样式 这里的watch 只在admin下面的自组件互相跳转时才有效



js有关键字,代表当前执行方法的对象,养成习惯,在方法开头,声明本地变量_this 代替this,后面会介绍直接使用this 的坑



所以在admin.vue js改成这样

```
mounted: function() {
    let _this = this;
    $("body").removeAttr("class", "login-layout light-login");
    $("body").attr("class", "no-skin");
     _this.activeSidebar(_this.$route.name.replace("/", "-") + "-sidebar");
  },

  watch: {
    $route: {
      handler: function(val, oldVal) {
        // sidebar激活样式方法二
        console.log("---->页面跳转：", val, oldVal);
        let _this = this;

        _this.$nextTick(function() {
          //页面加载完成后执行
          _this.activeSidebar(_this.$route.name.replace("/", "-") + "-sidebar");
        });
      }
    }
  },

```



这里有一个bug 从login跳转到 welcome 无法伸缩

cnpm i axios --save

--save 在pacjage.json添加依赖  不加,只是去下载插件,项目中并没有依赖插件









### 集成axios完成前后端交互

修改main.js

```
import Vue from 'vue'
import App from './App.vue'
import router from './router'

import axios from 'axios'

Vue.config.productionTip = false
Vue.prototype.$ajax=axios;

new Vue({
  router,
  render: h => h(App),
}).$mount('#app')

```



Vue.prototype. 可以理解为vue组件的全局变量,可以在任意vue组件中,使用this.xxx来获取这个值, $是达标vue全局属性的一个约定



chapter.vue 中 获取后端数据

```
export default {
    name: 'chapter',

    // 页面初始化加载方法
    mounted: function() {
        // this.$parent.activeSidebar('business-chapter-sidebar');
        let _this = this;
        _this.list();
    },
    methods: {
        list() {
            let _this = this;
            _this.$ajax.get('http://127.0.0.1:9002/business/admin/chapter/list').then((response)=>{
                console.log("查询大章列表结果:", response);
            })
        }
    }
}
</script>
```



后端 chapterController 改成

```
package com.lzn.business.controller.admin;


import com.lzn.domain.Chapter;
import com.lzn.dto.ChapterDto;
import com.lzn.service.ChapterService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
// 该路径说明是用来供控台使用了
@RequestMapping("/admin/chapter")
public class ChapterController {
    @Autowired
    private ChapterService chapterService;

    @RequestMapping("/list")
    public List<ChapterDto> chapter() {
        return chapterService.list();
    }
}

```





cors 跨站点,资源分享, 属于跨域问题, 同个ip 的不同端口间的访问也属于跨域,前后端分离必然有跨域问题





在后端,server  config 加入

```
package com.lzn.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class CorsConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("*")
                .allowedHeaders(CorsConfiguration.ALL)
                .allowedMethods(CorsConfiguration.ALL)
                .allowCredentials(true)
                .maxAge(3600); // 1小时内不需要再预检（发OPTIONS请求）
    }
}
```



页面改造显示真实数据 chapter.vue

```
<template>

    <table id="simple-table" class="table table-bordered table-hover">
        <thead>
            <tr>
              <th>ID</th>
              <th>名称</th>
              <th>课程ID</th>
              <th>操作</th>
            </tr>
        </thead>

        <tbody>
            <tr v-for="chapter in chapters">

                <td>{{chapter.id}}
                </td>
                <td>{{chapter.name}}</td>
                <td>{{chapter.courseId}}</td>
                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown"
                                data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul
                                class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>


        </tbody>
    </table>

</template>>


<script>
export default {
    name: 'chapter',

    data: function() {
        return {
            chapters: []
        }
    },

    // 页面初始化加载方法
    mounted: function() {
        // this.$parent.activeSidebar('business-chapter-sidebar');
        let _this = this;
        _this.list();
    },
    methods: {
        list() {
            let _this = this;
            _this.$ajax.get('http://127.0.0.1:9002/business/admin/chapter/list').then((response)=>{
                console.log("查询大章列表结果:", response);
                _this.chapters = response.data;
            })
        }
    }
}
</script>
```





使用gateway路由转发



gateway 添加配置

```
# 应用名字
spring.application.name=gateway
# 启动端口
server.port=9000
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# 路由转发配置
spring.cloud.gateway.routes[0].id=system
spring.cloud.gateway.routes[0].uri=http://127.0.0.1:9001
spring.cloud.gateway.routes[0].predicates[0].name=Path
spring.cloud.gateway.routes[0].predicates[0].args[0]=/system/**


spring.cloud.gateway.routes[1].id=business
spring.cloud.gateway.routes[1].uri=http://127.0.0.1:9002
spring.cloud.gateway.routes[1].predicates[0].name=Path
spring.cloud.gateway.routes[1].predicates[0].args[0]=/business/**
```





http://127.0.0.1:9000/business/admin/chapter/list



gateway跨域配置

在gateway启动类里增加



```java
修改gateway的启动类
    package com.lzn;


import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
//import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
import org.springframework.context.annotation.Bean;
import org.springframework.core.env.Environment;
import org.springframework.web.cors.CorsConfiguration;

import org.springframework.web.cors.reactive.CorsWebFilter;
import org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;
import org.springframework.web.util.pattern.PathPatternParser;

@SpringBootApplication
@EnableEurekaClient
public class GatewayApplication {
    private static final Logger LOG = LoggerFactory.getLogger(GatewayApplication.class);

    public static void main(String[] args) {
//		SpringApplication.run(EurekaApplication.class, args);
        SpringApplication app = new SpringApplication(GatewayApplication.class);
        Environment env = app.run(args).getEnvironment();
        LOG.info("启动成功！！");
        LOG.info("Gateway: \thttp://127.0.0.1:{}", env.getProperty("server.port"));
    }

    @Bean
    public CorsWebFilter corsWebFilter() {
        CorsConfiguration config = new CorsConfiguration();

        config.setAllowCredentials(Boolean.TRUE);
        config.addAllowedMethod("*");
        config.addAllowedOrigin("*");
        config.addAllowedHeader("*");
        config.setMaxAge(3600L);

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(new PathPatternParser());
        source.registerCorsConfiguration("/**", config);

        return new CorsWebFilter(source);
    }
}

```





然后注释掉server中的corsconfig

是否是直接访问gateway 就不需要跨域配置了呢？ 需要继续验证一下

那就注释掉刚才加的 跨域配置  就会有报错，所以说明了刚才加的代码是起到了跨域配置的作用



**单个springboot应用使用corsconfig 解决跨域问题，使用springcloud gateway的，使用corswebfileter来解决跨域问题**



**记录**



**问题：**

**如果配置的是ip端口，那发布到生产时就可能会访问不到，就算配置了maven多环节，也需要提前知道上线后的ip和端口，提前配置好**



gateway 属性文件修改



```
# 应用名字
spring.application.name=gateway
# 启动端口
server.port=9000
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# 路由转发配置
spring.cloud.gateway.routes[0].id=system
spring.cloud.gateway.routes[0].uri=http://127.0.0.1:9001
spring.cloud.gateway.routes[0].predicates[0].name=Path
spring.cloud.gateway.routes[0].predicates[0].args[0]=/system/**


spring.cloud.gateway.routes[1].id=business
#spring.cloud.gateway.routes[1].uri=http://127.0.0.1:9002
spring.cloud.gateway.routes[1].uri=lb://business
spring.cloud.gateway.routes[1].predicates[0].name=Path
spring.cloud.gateway.routes[1].predicates[0].args[0]=/business/**
```



使用lb://+注册中心名称路由转发 loadbalance



## 分页功能开发



### 集成分页插件pagehelper



mybatis-generator生成的代码是不带分页功能的，使用pagehelper插件来扩展分页功能







根目录下的pom文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
   <modelVersion>4.0.0</modelVersion>
    <packaging>pom</packaging>
    <modules>
        <module>eureka</module>
      <module>system</module>
      <module>gateway</module>
        <module>server</module>
        <module>business</module>
    </modules>
    <parent>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-parent</artifactId>
      <version>2.3.4.RELEASE</version>
      <relativePath/> <!-- lookup parent from repository -->
   </parent>
   <groupId>com.lzn</groupId>
   <artifactId>course</artifactId>
   <version>0.0.1-SNAPSHOT</version>
   <name>course</name>
   <description>Demo project for Spring Boot</description>

   <properties>
      <java.version>1.8</java.version>
      <spring-cloud.version>Hoxton.SR8</spring-cloud.version>
   </properties>



   <dependencyManagement>
      <dependencies>
         <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>${spring-cloud.version}</version>
            <type>pom</type>
            <scope>import</scope>
         </dependency>


         <!-- 集成mybatis -->
         <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>1.3.2</version>
         </dependency>
         <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.37</version>
         </dependency>

         <dependency>
            <groupId>com.lzn</groupId>
            <artifactId>server</artifactId>
            <version>0.0.1-SNAPSHOT</version>
         </dependency>

<!--         mybatis分页插件pagehelper-->
         <dependency>
            <groupId>com.github.pagehelper</groupId>
            <artifactId>pagehelper-spring-boot-starter</artifactId>
            <version>1.2.11</version>
         </dependency>



      </dependencies>


   </dependencyManagement>

   <build>
      <plugins>
         <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
         </plugin>

         <!-- mybatis generator 自动生成代码插件 -->
         <plugin>
            <groupId>org.mybatis.generator</groupId>
            <artifactId>mybatis-generator-maven-plugin</artifactId>
            <version>1.3.7</version>
            <configuration>
<!--               配置文件 -->
               <configurationFile>src/main/resources/generator/generatorConfig.xml</configurationFile>
               <overwrite>true</overwrite>
               <verbose>true</verbose>
            </configuration>
            <dependencies>
               <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>5.1.37</version>
               </dependency>
            </dependencies>
         </plugin>

      </plugins>
   </build>

</project>
```



server下的pom文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>course</artifactId>
        <groupId>com.lzn</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>server</artifactId>

    <dependencies>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- 集成mybatis -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>


<!--        分页插件-->
        <dependency>
            <groupId>com.github.pagehelper</groupId>
            <artifactId>pagehelper-spring-boot-starter</artifactId>
        </dependency>



    </dependencies>
</project>
```



server 下的 chapaterService

```java
package com.lzn.service;

import com.github.pagehelper.PageHelper;
import com.lzn.domain.Chapter;
import com.lzn.domain.ChapterExample;
import com.lzn.domain.Test;
import com.lzn.domain.TestExample;
import com.lzn.dto.ChapterDto;
import com.lzn.mapper.ChapterMapper;
import com.lzn.mapper.TestMapper;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;


@Service
public class ChapterService {

    @Autowired
    private ChapterMapper chapterMapper;


    public List<ChapterDto> list() {
        PageHelper.startPage(1,1);
        ChapterExample chapterExample = new ChapterExample();
//        chapterExample.createCriteria().andIdEqualTo("1");
//        chapterExample.setOrderByClause("id desc ");
        List<Chapter> chapterList = chapterMapper.selectByExample(chapterExample);
        List<ChapterDto> chapterDtoList = new ArrayList<>();

        for(int i = 0;i<chapterList.size();++i){
            Chapter chapter = chapterList.get(i);
            ChapterDto chapterDto = new ChapterDto();
            BeanUtils.copyProperties(chapter, chapterDto);
            chapterDtoList.add(chapterDto);
        }


        return chapterDtoList;


    }
}
```



pageHelper的分页参数： pageNum从1开始的

分页功能的关键字：limit 

从日志可以看出，该sql执行的是limit 1 相当于 limit 0 ， 1即从第0行开始查1条

插件分页语句规则，调用startPage方法之后，执行的第一个select语句会进行分页

分页查询功能需要两条sql，一条是查总记录数，通过每页条数计算出总共有多少页，

一条是查当前页的记录



### 分页参数前后端交互

前后端数据交互

泛型需要熟练掌握，在写一些通用类、工具类时候很好用

使用泛型的地方都可以用Object代替，但是泛型可以在编译期就发现问题，并且避免了代码中写强制类型转换



在server中 增加分页泛型类

```java
package com.lzn.dto;

import java.util.List;


/**
 * 分页泛型类
 * @param <T>
 */
public class PageDto<T> {

    /**
     * 当前页码
     */
    protected int page;

    /**
     * 每页条数
     */
    protected int size;

    /**
     * 总条数
     */
    protected long total;

    protected List<T> list;

    public int getPage() {
        return page;
    }

    public void setPage(int page) {
        this.page = page;
    }

    public int getSize() {
        return size;
    }

    public void setSize(int size) {
        this.size = size;
    }

    public long getTotal() {
        return total;
    }

    public void setTotal(long total) {
        this.total = total;
    }

    public List<T> getList() {
        return list;
    }

    public void setList(List<T> list) {
        this.list = list;
    }

    @Override
    public String toString() {
        final StringBuffer sb = new StringBuffer("PageDto{");
        sb.append("page=").append(page);
        sb.append(", size=").append(size);
        sb.append(", total=").append(total);
        sb.append(", list=").append(list);

        sb.append('}');
        return sb.toString();
    }
}
```





charpterService

```
package com.lzn.service;

import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import com.lzn.domain.Chapter;
import com.lzn.domain.ChapterExample;
import com.lzn.domain.Test;
import com.lzn.domain.TestExample;
import com.lzn.dto.ChapterDto;
import com.lzn.dto.PageDto;
import com.lzn.mapper.ChapterMapper;
import com.lzn.mapper.TestMapper;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;


@Service
public class ChapterService {

    @Autowired
    private ChapterMapper chapterMapper;


//    public List<ChapterDto> list(PageDto pageDto) {
    public void list(PageDto pageDto) {

//        PageHelper.startPage(1,1);
        PageHelper.startPage(pageDto.getPage(), pageDto.getSize());
        ChapterExample chapterExample = new ChapterExample();
//        chapterExample.createCriteria().andIdEqualTo("1");
//        chapterExample.setOrderByClause("id desc ");
        List<Chapter> chapterList = chapterMapper.selectByExample(chapterExample);

        PageInfo<Chapter> pageInfo = new PageInfo<>(chapterList);
        pageDto.setTotal(pageInfo.getTotal());

        List<ChapterDto> chapterDtoList = new ArrayList<>();

        for(int i = 0;i<chapterList.size();++i){
            Chapter chapter = chapterList.get(i);
            ChapterDto chapterDto = new ChapterDto();
            BeanUtils.copyProperties(chapter, chapterDto);
            chapterDtoList.add(chapterDto);
        }
        pageDto.setList(chapterDtoList);
        
    }
}

```





business chapterController

```
package com.lzn.business.controller.admin;


import com.github.pagehelper.Page;
import com.lzn.domain.Chapter;
import com.lzn.dto.ChapterDto;
import com.lzn.dto.PageDto;
import com.lzn.service.ChapterService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
// 该路径说明是用来供控台使用了
@RequestMapping("/admin/chapter")
public class ChapterController {
    @Autowired
    private ChapterService chapterService;

    @RequestMapping("/list")
    public PageDto list(PageDto pageDto) {
        chapterService.list(pageDto);
        return pageDto;
    }
}
```





测试

http://127.0.0.1:9002/business/admin/chapter/list?page=1&size=1



经验： 在开发完代码后，需要进行测试，特别要针对一些边界值做测试



前端：

接口请求参数传递 尽量使用post，使用get请求，在url里拼参数的话，会让url变得很长，有些浏览器或服务器会对url长度做限制，导致请求失败



post请求有多种参数传递，通过header里的Content-Type来标识，常见的有两种，一种是表单方式，另一种是json流的方式



jquery默认是表单方式， vue  angular 默认是json方式





```
package com.lzn.business.controller.admin;


import com.github.pagehelper.Page;
import com.lzn.domain.Chapter;
import com.lzn.dto.ChapterDto;
import com.lzn.dto.PageDto;
import com.lzn.service.ChapterService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
// 该路径说明是用来供控台使用了
@RequestMapping("/admin/chapter")
public class ChapterController {
    @Autowired
    private ChapterService chapterService;

    @RequestMapping("/list")
    public PageDto list(@RequestBody PageDto pageDto) {
        chapterService.list(pageDto);
        return pageDto;
    }
}
```





前端



chapter.vue

```vue
<template>

    <table id="simple-table" class="table table-bordered table-hover">
        <thead>
            <tr>
              <th>ID</th>
              <th>名称</th>
              <th>课程ID</th>
              <th>操作</th>
            </tr>
        </thead>

        <tbody>
            <tr v-for="chapter in chapters">

                <td>{{chapter.id}}
                </td>
                <td>{{chapter.name}}</td>
                <td>{{chapter.courseId}}</td>
                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown"
                                data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul
                                class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>


        </tbody>
    </table>

</template>>


<script>
export default {
    name: 'chapter',

    data: function() {
        return {
            chapters: []
        }
    },

    // 页面初始化加载方法
    mounted: function() {
        // this.$parent.activeSidebar('business-chapter-sidebar');
        let _this = this;
        _this.list();
    },
    methods: {
        list() {
            let _this = this;
            _this.$ajax.post('http://127.0.0.1:9000/business/admin/chapter/list', {
                page: 1,
                size: 1
            }).then((response)=>{
                console.log("查询大章列表结果:", response);
                _this.chapters = response.data.list;
            })
        }
    }
}
</script>
```





# 前端分页组件的使用



## 刷新功能



vue template 里只能有一个子标签

用p段落标签包裹按钮元素块，可以让按钮和下面的表格有一定的空格

    <p>
      <button v-on:click="list()" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-refresh"></i>
        刷新
      </button>
    </p>



fa样式是fontawesome图标，可以百度图标查看所有的图标样式



## 前端分页组件的使用

增加sql 增加数据

```sql
# ------ 大章 ---------
drop table if EXISTS `chapter`;
create table `chapter` (
	`id` char(8) not null COMMENT 'ID',
	`course_id` char(8) comment '课程id',
	`name` varchar(50) comment '名称',
	primary key (`id`)
) ENGINE=INNODB DEFAULT charset=utf8mb4 comment='大章';

insert into `chapter` (id, course_id, name) values ('00000000', '0000000', '测试大章1');
insert into `chapter` (id, course_id, name) values ('00000001', '00000000', '测试大章2');
insert into `chapter` (id, course_id, name) values ('00000002', '00000002', '测试大章3');
insert into `chapter` (id, course_id, name) values ('00000003', '00000003', '测试大章4');
insert into `chapter` (id, course_id, name) values ('00000004', '00000004', '测试大章5');
insert into `chapter` (id, course_id, name) values ('00000005', '00000005', '测试大章6');
insert into `chapter` (id, course_id, name) values ('00000006', '00000006', '测试大章7');
insert into `chapter` (id, course_id, name) values ('00000007', '00000007', '测试大章8');
insert into `chapter` (id, course_id, name) values ('00000008', '00000008', '测试大章9');
insert into `chapter` (id, course_id, name) values ('00000009', '00000009', '测试大章10');
insert into `chapter` (id, course_id, name) values ('00000010', '00000010', '测试大章11');
insert into `chapter` (id, course_id, name) values ('00000011', '00000011', '测试大章12');
insert into `chapter` (id, course_id, name) values ('00000012', '00000012', '测试大章13');
insert into `chapter` (id, course_id, name) values ('00000013', '00000013', '测试大章14');
insert into `chapter` (id, course_id, name) values ('00000014', '00000014', '测试大章15');
insert into `chapter` (id, course_id, name) values ('00000015', '00000015', '测试大章16');
insert into `chapter` (id, course_id, name) values ('00000016', '00000016', '测试大章17');
insert into `chapter` (id, course_id, name) values ('00000017', '00000017', '测试大章18');
insert into `chapter` (id, course_id, name) values ('00000018', '00000018', '测试大章19');
insert into `chapter` (id, course_id, name) values ('00000019', '00000019', '测试大章20');


# ----------------测试
drop table if exists `test`;
create table `test` (
    `id` char(8) not null default '' comment 'id',
    `name` varchar(255) comment '名称',
    primary key (`id`)
) engine=innodb default charset=utf8mb4 ;

insert into `test` (id, name) values (1, '测试');
insert into `test` (id, name) values (3, '测试2');

```



分页组件

当数据量很大的时候，分页页码很多，这时会把所有页码显示出来，会占用页面大大部分空间，影响体验，所以需要设置现实页码数量



vue components 新增pagination.vue

先对chapter.vue 进行修改

```vue
<template>
  <div>
    <p>
      <button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-refresh"></i>
        刷新
      </button>
    </p>

    <pagination ref="pagination" v-bind:list="list"></pagination>

    <table id="simple-table" class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>名称</th>
          <th>课程ID</th>
          <th>操作</th>
        </tr>
      </thead>

      <tbody>
        <tr v-for="chapter in chapters">
          <td>{{ chapter.id }}</td>
          <td>{{ chapter.name }}</td>
          <td>{{ chapter.courseId }}</td>
          <td>
            <div class="hidden-sm hidden-xs btn-group">
              <button class="btn btn-xs btn-success">
                <i class="ace-icon fa fa-check bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-info">
                <i class="ace-icon fa fa-pencil bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-danger">
                <i class="ace-icon fa fa-trash-o bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-warning">
                <i class="ace-icon fa fa-flag bigger-120"></i>
              </button>
            </div>

            <div class="hidden-md hidden-lg">
              <div class="inline pos-rel">
                <button
                  class="btn btn-minier btn-primary dropdown-toggle"
                  data-toggle="dropdown"
                  data-position="auto"
                >
                  <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                </button>

                <ul
                  class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close"
                >
                  <li>
                    <a
                      href="#"
                      class="tooltip-info"
                      data-rel="tooltip"
                      title="View"
                    >
                      <span class="blue">
                        <i class="ace-icon fa fa-search-plus bigger-120"></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-success"
                      data-rel="tooltip"
                      title="Edit"
                    >
                      <span class="green">
                        <i
                          class="ace-icon fa fa-pencil-square-o bigger-120"
                        ></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-error"
                      data-rel="tooltip"
                      title="Delete"
                    >
                      <span class="red">
                        <i class="ace-icon fa fa-trash-o bigger-120"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</template>>


<script>
import Pagination from '../../components/pagination.vue' 

export default {
  name: "chapter",
  components: { Pagination },

  data: function () {
    return {
      chapters: [],
    };
  },

  // 页面初始化加载方法
  mounted: function () {
    // this.$parent.activeSidebar('business-chapter-sidebar');
    let _this = this;
    _this.$refs.pagination.size = 5;
    _this.list(1);
  },
  methods: {
    list(page) {
      let _this = this;
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/list", {
          page: page,
        //  跟组子组件获取  size应该有一个默认的参数
          size: _this.$refs.pagination.size,
        })
        .then((response) => {
          console.log("查询大章列表结果:", response);
          _this.chapters = response.data.list;
          _this.$refs.pagination.render(page, response.data.total);

        });
    },
  },
};
</script>
```



v-bind:list = "list" 

前面的list，是分页组件暴露出来的一个回调方法，后面的list，是chapter组件的list方法





新建pagination.vue

分页组件 通用分页组件

```vue
<template>
  <div class="pagination" role="group" aria-label="分页">
    <button type="button" class="btn btn-default btn-white btn-round" 
            v-bind:disabled="page === 1"
            v-on:click="selectPage(1)">
      1
    </button>
    <button type="button" class="btn btn-default btn-white btn-round" 
            v-bind:disabled="page === 1"
            v-on:click="selectPage(page - 1)">
      上一页
    </button>
    <button v-for="p in pages" v-bind:id="'page-' + p" 
            type="button" class="btn btn-default btn-white btn-round"
            v-bind:class="{'btn-primary active':page == p}" 
            v-on:click="selectPage(p)">
      {{p}}
    </button>
    <button type="button" class="btn btn-default btn-white btn-round" 
            v-bind:disabled="page === pageTotal"
            v-on:click="selectPage(page + 1)">
      下一页
    </button>
    <button type="button" class="btn btn-default btn-white btn-round"
            v-bind:disabled="page === pageTotal"
            v-on:click="selectPage(pageTotal)">
      {{pageTotal||1}}
    </button>
    &nbsp;
    <span class="m--padding-10">
        每页
        <select v-model="size">
            <option value="1">1</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
        条，共【{{total}}】条
    </span>
  </div>
</template>

<script>
  export default {
    name: 'pagination',
    props: {
      list: {
        type: Function,
        default: null
      },
      itemCount: Number // 显示的页码数，比如总共有100页，只显示10页，其它用省略号表示
    },
    data: function () {
      return {
        total: 0, // 总行数
        size: 10, // 每页条数
        page: 0, // 当前页码
        pageTotal: 0, // 总页数
        pages: [], // 显示的页码数组
      }
    },
    methods: {
      /**
       * 渲染分页组件
       * @param page
       * @param total
       */
      render(page, total) {
        let _this = this;
        _this.page = page;
        _this.total = total;
        _this.pageTotal = Math.ceil(total / _this.size);
        _this.pages = _this.getPageItems(_this.pageTotal, page, _this.itemCount || 5);
      },

      /**
       * 查询某一页
       * @param page
       */
      selectPage(page) {
        let _this = this;
        if (page < 1) {
          page = 1;
        }
        if (page > _this.pageTotal) {
          page = _this.pageTotal;
        }
        if (this.page !== page) {
          _this.page = page;
          if (_this.list) {
            _this.list(page);
          }
        }
      },

      /**
       * 当前要显示在页面上的页码
       * @param total
       * @param current
       * @param length
       * @returns {Array}
       */
      getPageItems(total, current, length) {
        let items = [];
        if (length >= total) {
          for (let i = 1; i <= total; i++) {
            items.push(i);
          }
        } else {
          let base = 0;
          // 前移
          if (current - 0 > Math.floor((length - 1) / 2)) {
            // 后移
            base = Math.min(total, current - 0 + Math.ceil((length - 1) / 2)) - length;
          }
          for (let i = 1; i <= length; i++) {
            items.push(base + i);
          }
        }
        return items;
      }
    }
  }
</script>

<style scoped>
  .pagination {
    vertical-align: middle !important;
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 10px;
  }

  .pagination button {
    margin-right: 5px;
  }

  .btn-primary.active {
    background-color: #2f7bba !important;
    border-color: #27689d !important;
    color: white !important;
    font-weight: 600;
  }

  /*.pagination select {*/
  /*vertical-align: middle !important;*/
  /*font-size: 16px;*/
  /*margin-top: 0;*/
  /*}*/
</style>


```





props: 定义父组件向子组件传递的阐述，可以是一个函数或数据，本组件中暴露了两个参数list和itemCount给外部



# 新增大章功能

## 页面设计与前端代码开发

新增功能的页面如何设计，需要平时心里有些储备，可以平时浏览bootstrap文档，看看

都有哪些组件，用的时候心里有数



boostrap 模态框

https://v3.bootcss.com/javascript/#modals

模态框分为三个大块：

modal-header标题

modal-body 是主体内容

大章的表单内容就放在这里

modal-footer是底部按钮



modal的样式有display:none,所以模态框初始是和不可见的，这段代码可以放在html代码的顶部，也可以

放在html代码的底部

复制的代码

```html
<div class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Modal title</h4>
      </div>
      <div class="modal-body">
        <p>One fine body&hellip;</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
```





在chapter.vue下面复制



全局css样式 表单 水平排列的表单

```html
<form class="form-horizontal">
  <div class="form-group">
    <label for="inputEmail3" class="col-sm-2 control-label">Email</label>
    <div class="col-sm-10">
      <input type="email" class="form-control" id="inputEmail3" placeholder="Email">
    </div>
  </div>
  <div class="form-group">
    <label for="inputPassword3" class="col-sm-2 control-label">Password</label>
    <div class="col-sm-10">
      <input type="password" class="form-control" id="inputPassword3" placeholder="Password">
    </div>
  </div>
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <div class="checkbox">
        <label>
          <input type="checkbox"> Remember me
        </label>
      </div>
    </div>
  </div>
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <button type="submit" class="btn btn-default">Sign in</button>
    </div>
  </div>
</form>
```

##  



复制到模态框的body里面

```html
   <button v-on:click="add()" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-edit"></i>
        新增
      </button>

```





可以使用$(".modal").modal({backdrop:'static})

禁止点击空白的地方关闭，某些场景需求会用到这个功能

vuecli会将我们写的html js css代码编译压缩，空格和换行符

会被压缩掉，导致按钮间的间隔没有了

<label for="id">有个场景会经常用到，点击复选框checkbox时选中，使用label for后，点击label的我呢子，也能选中该复选框



模态框的弹出和关闭，可以用js代码，也可以用button属性，data-dismiss="css选择器" 关闭，data_toggle

模态框打开

## 短id设计与后端代码开发

面试：为什么不用自增id，自增id至少有三个问题？

1 ： id是连续的，容易被探测

2：需要+1次查询才能得到id的值

3：分布式存储中，id会出现重复



uuid是根据机器，时间等多个维度生成的32位16进制数，有生之年不会重复，在uuid的基础上，封装了8位短uuid

server util UuidUtil.java

```java
package com.lzn.util;
import java.util.UUID;

public class UuidUtil {


    // dict
    public static String[] chars = new String[] { "a", "b", "c", "d", "e", "f",
            "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s",
            "t", "u", "v", "w", "x", "y", "z", "0", "1", "2", "3", "4", "5",
            "6", "7", "8", "9", "A", "B", "C", "D", "E", "F", "G", "H", "I",
            "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V",
            "W", "X", "Y", "Z" };


    /**
     * 获取短UUID
     * @return
     */
    public static String getShortUuid() {
        StringBuffer shortBuffer = new StringBuffer();
        String uuid = UuidUtil.getUuid();
        for (int i = 0; i < 8; i++) {
            String str = uuid.substring(i * 4, i * 4 + 4);
            int x = Integer.parseInt(str, 16);
            shortBuffer.append(chars[x % 0x3E]); // 对62取余
        }
        return shortBuffer.toString();

    }

    /**
     * 获得32位UUID
     */
    public static String getUuid(){
        String uuid = UUID.randomUUID().toString();
        //去掉“-”符号
        return uuid.replaceAll("-", "");
    }

    public static void main(String[] args) {
        System.out.println(getShortUuid());

        for (int i = 0; i < 10; i++) {
            System.out.println(getShortUuid());
        }
    }
}

```

短id 是根据32位id，转为62进制8位id，减少存储空间

原理是将uuid转为10进制，在对62取余，也可以再添加两个符号，转成64进制

idea 开发技巧： xxx.sout 用到了 postfix

server service 

```java
    // 保存大章
    public void save(ChapterDto chapterDto){
        // 传进来没有id
        chapterDto.setId(UuidUtil.getShortUuid());
        Chapter chapter = new Chapter();
        BeanUtils.copyProperties(chapterDto, chapter);
        chapterMapper.insert(chapter);
    }

```



business 控制器

```java
@RequestMapping("/save")
public ChapterDto save(@RequestBody ChapterDto chapterDto){
    chapterService.save(chapterDto);
    return chapterDto;
}
```



前端，将绑定好数据的chapter作为前后端交互传参

chapter.vue

```vue
<template>
  <div>
    <p>
      <button v-on:click="add()" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-edit"></i>
        新增
      </button>
      &nbsp;
      <button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-refresh"></i>
        刷新
      </button>
    </p>

    <pagination ref="pagination" v-bind:list="list"></pagination>

    <table id="simple-table" class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>名称</th>
          <th>课程ID</th>
          <th>操作</th>
        </tr>
      </thead>

      <tbody>
        <tr v-for="chapter in chapters">
          <td>{{ chapter.id }}</td>
          <td>{{ chapter.name }}</td>
          <td>{{ chapter.courseId }}</td>
          <td>
            <div class="hidden-sm hidden-xs btn-group">
              <button class="btn btn-xs btn-success">
                <i class="ace-icon fa fa-check bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-info">
                <i class="ace-icon fa fa-pencil bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-danger">
                <i class="ace-icon fa fa-trash-o bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-warning">
                <i class="ace-icon fa fa-flag bigger-120"></i>
              </button>
            </div>

            <div class="hidden-md hidden-lg">
              <div class="inline pos-rel">
                <button
                  class="btn btn-minier btn-primary dropdown-toggle"
                  data-toggle="dropdown"
                  data-position="auto"
                >
                  <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                </button>

                <ul
                  class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close"
                >
                  <li>
                    <a
                      href="#"
                      class="tooltip-info"
                      data-rel="tooltip"
                      title="View"
                    >
                      <span class="blue">
                        <i class="ace-icon fa fa-search-plus bigger-120"></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-success"
                      data-rel="tooltip"
                      title="Edit"
                    >
                      <span class="green">
                        <i
                          class="ace-icon fa fa-pencil-square-o bigger-120"
                        ></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-error"
                      data-rel="tooltip"
                      title="Delete"
                    >
                      <span class="red">
                        <i class="ace-icon fa fa-trash-o bigger-120"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- 模态框 -->
    <div class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">表单</h4>
          </div>
          <div class="modal-body">
            <!-- 表单 -->
            <form class="form-horizontal">
              <div class="form-group">
                <label for="name" class="col-sm-2 control-label">名称</label>
                <div class="col-sm-10">
                  <input
                    v-model="chapter.name"
                    type="text"
                    class="form-control"
                    id="name"
                    placeholder="名称"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="courseID" class="col-sm-2 control-label"
                  >课程id</label
                >
                <div class="col-sm-10">
                  <input
                    v-model="chapter.courseId"
                    type="text"
                    class="form-control"
                    id="courseID"
                    placeholder="课程id"
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              取消
            </button>
            <button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>

    <!-- /.modal -->
  </div>
</template>>


<script>
import Pagination from "../../components/pagination.vue";

export default {
  name: "chapter",
  components: { Pagination },

  data: function () {
    return {
      // 映射表单数据
      chapter: {},
      chapters: [],
    };
  },

  // 页面初始化加载方法
  mounted: function () {
    // this.$parent.activeSidebar('business-chapter-sidebar');
    let _this = this;
    _this.$refs.pagination.size = 5;
    _this.list(1);
  },
  methods: {
    // 编辑大章
    edit() {},
    // 删除大章
    delete() {},
    // 新增大章
    add() {
      let _this = this;
      // 禁止点击空白的地方关闭
      $(".modal").modal({
        backdrop: "static",
      });
      $(".modal").modal("show");
    },


    // 获取所有大章的数据
    list(page) {
      let _this = this;
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/list", {
          page: page,
          //  跟组子组件获取  size应该有一个默认的参数
          size: _this.$refs.pagination.size,
        })
        .then((response) => {
          console.log("查询大章列表结果:", response);
          _this.chapters = response.data.list;
          _this.$refs.pagination.render(page, response.data.total);
        });
    },
    // 保存大章的数据
    save(page) {
      let _this = this;
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/save",
        _this.chapter)
        .then((response) => {
          console.log("保存大章列表结果:", response);
        });
    },
  },
};
</script>
```

## 增加复制工具类CopyUtil

对于常用的代码，可以提取成工具类，简化开发代码，提高开发效率



```java
package com.course.server.util;

import org.springframework.beans.BeanUtils;
import org.springframework.util.CollectionUtils;

import java.util.ArrayList;
import java.util.List;

public class CopyUtil {

    public static <T> List<T> copyList(List source, Class<T> clazz) {
        List<T> target = new ArrayList<>();
        if (!CollectionUtils.isEmpty(source)){
            if (!CollectionUtils.isEmpty(source)){
                for (Object c: source) {
                    T obj = copy(c, clazz);
                    target.add(obj);
                }
            }
        }
        return target;
    }

    public static <T> T copy(Object source, Class<T> clazz) {
        if (source == null) {
            return null;
        }
        T obj = null;
        try {
            obj = clazz.newInstance();
        } catch (Exception e) {
            e.printStackTrace();
        }
        BeanUtils.copyProperties(source, obj);
        return obj;
    }
}

```



利用反射，牺牲了一点性能，（可以忽略不计），换取开发效率



## 统一返回参数ResponseDto

纯接口应用，一般会规范固定的请求参数，如版本号、请求流水线等，再规范固定的返回参数，

如返回码、返回描述等，方便调用方统一处理

```java
package com.lzn.dto;

public class ResponseDto<T> {

    /**
     * 业务上的成功或失败
     */
    private boolean success = true;

    /**
     * 返回码
     */
    private String code;

    /**
     * 返回信息
     */
    private String message;

    /**
     * 返回泛型数据，自定义类型
     */
    private T content;

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public boolean getSuccess() {
        return success;
    }

    public void setSuccess(boolean success) {
        this.success = success;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public T getContent() {
        return content;
    }

    public void setContent(T content) {
        this.content = content;
    }

    @Override
    public String toString() {
        final StringBuffer sb = new StringBuffer("ResponseDto{");
        sb.append("success=").append(success);
        sb.append(", code='").append(code).append('\'');
        sb.append(", message='").append(message).append('\'');
        sb.append(", content=").append(content);
        sb.append('}');
        return sb.toString();
    }
}

```





控制器

```java
package com.lzn.business.controller.admin;


import com.lzn.dto.ChapterDto;
import com.lzn.dto.PageDto;
import com.lzn.dto.ResponseDto;
import com.lzn.service.ChapterService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
// 该路径说明是用来供控台使用了
@RequestMapping("/admin/chapter")
public class ChapterController {
    @Autowired
    private ChapterService chapterService;

    @RequestMapping("/list")
    // requestBody --- json 默认是表单
    public ResponseDto list(@RequestBody PageDto pageDto) {
        ResponseDto responseDto = new ResponseDto();
        chapterService.list(pageDto);
        responseDto.setContent(pageDto);
//        return pageDto;
        return responseDto;
    }


    @RequestMapping("/save")
    public ResponseDto save(@RequestBody ChapterDto chapterDto){
        ResponseDto responseDto = new ResponseDto();
        chapterService.save(chapterDto);
        responseDto.setContent(chapterDto);
//        return chapterDto;
        return responseDto;
    }


}

```



修改前端

列表查询业务一般都是成功的，查不到数据也是成功，所以不需要判断success，保存有可能失败，所以需要判断success

验证功能：

列表查询没问题

保存功能没问题

保存成功以后关闭model 并刷新列表

chapter.vue

css 选择器，可以通过id class 标签等选择页面元素

同一个页面有多个modal时，用class选择时，会出现重复，所以需要给每个modal增加id属性



之前的时class 选择器 --> id选择器



```vue
<template>
  <div>
    <p>
      <button v-on:click="add()" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-edit"></i>
        新增
      </button>
      &nbsp;
      <button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-refresh"></i>
        刷新
      </button>
    </p>

    <pagination ref="pagination" v-bind:list="list"></pagination>

    <table id="simple-table" class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>名称</th>
          <th>课程ID</th>
          <th>操作</th>
        </tr>
      </thead>

      <tbody>
        <tr v-for="chapter in chapters">
          <td>{{ chapter.id }}</td>
          <td>{{ chapter.name }}</td>
          <td>{{ chapter.courseId }}</td>
          <td>
            <div class="hidden-sm hidden-xs btn-group">
              <button class="btn btn-xs btn-success">
                <i class="ace-icon fa fa-check bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-info">
                <i class="ace-icon fa fa-pencil bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-danger">
                <i class="ace-icon fa fa-trash-o bigger-120"></i>
              </button>

              <button class="btn btn-xs btn-warning">
                <i class="ace-icon fa fa-flag bigger-120"></i>
              </button>
            </div>

            <div class="hidden-md hidden-lg">
              <div class="inline pos-rel">
                <button
                  class="btn btn-minier btn-primary dropdown-toggle"
                  data-toggle="dropdown"
                  data-position="auto"
                >
                  <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                </button>

                <ul
                  class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close"
                >
                  <li>
                    <a
                      href="#"
                      class="tooltip-info"
                      data-rel="tooltip"
                      title="View"
                    >
                      <span class="blue">
                        <i class="ace-icon fa fa-search-plus bigger-120"></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-success"
                      data-rel="tooltip"
                      title="Edit"
                    >
                      <span class="green">
                        <i
                          class="ace-icon fa fa-pencil-square-o bigger-120"
                        ></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-error"
                      data-rel="tooltip"
                      title="Delete"
                    >
                      <span class="red">
                        <i class="ace-icon fa fa-trash-o bigger-120"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- 模态框 -->
    <div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">表单</h4>
          </div>
          <div class="modal-body">
            <!-- 表单 -->
            <form class="form-horizontal">
              <div class="form-group">
                <label for="name" class="col-sm-2 control-label">名称</label>
                <div class="col-sm-10">
                  <input
                    v-model="chapter.name"
                    type="text"
                    class="form-control"
                    id="name"
                    placeholder="名称"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="courseID" class="col-sm-2 control-label"
                  >课程id</label
                >
                <div class="col-sm-10">
                  <input
                    v-model="chapter.courseId"
                    type="text"
                    class="form-control"
                    id="courseID"
                    placeholder="课程id"
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              取消
            </button>
            <button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>

    <!-- /.modal -->
  </div>
</template>>


<script>
import Pagination from "../../components/pagination.vue";

export default {
  name: "chapter",
  components: { Pagination },

  data: function () {
    return {
      // 映射表单数据
      chapter: {},
      chapters: [],
    };
  },

  // 页面初始化加载方法
  mounted: function () {
    // this.$parent.activeSidebar('business-chapter-sidebar');
    let _this = this;
    _this.$refs.pagination.size = 5;
    _this.list(1);
  },
  methods: {
    // 编辑大章
    edit() {},
    // 删除大章
    delete() {},
    // 新增大章
    add() {
      let _this = this;
      // 禁止点击空白的地方关闭
      $(".modal").modal({
        backdrop: "static",
      });
      $("#form-modal").modal("show");
    },


    // 获取所有大章的数据
    list(page) {
      let _this = this;
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/list", {
          page: page,
          //  跟组子组件获取  size应该有一个默认的参数
          size: _this.$refs.pagination.size,
        })
        .then((response) => {
          let resp = response.data;
          _this.chapters = resp.content.list;
          _this.$refs.pagination.render(page, resp.content.total);
        });
    },

    // 保存大章的数据
    save(page) {
      let _this = this;
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/save",
        _this.chapter)
        .then((response) => {
          let resp = response.data;
          if(resp.success) {
            // 关闭模态框
            $("#form-modal").modal("hide");
            _this.list(1);
          }
        });
    },
  },
};
</script>
```







# 修改删除大章功能

## 修改大章功能

新增和编辑功能弹出来的模态框时同一个，vue controller service 调用的都是同一个方法，只是到service层再根据id

是否有值来判断是新增还是删除

修改chapterService.java

```java
package com.lzn.service;

import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import com.lzn.domain.Chapter;
import com.lzn.domain.ChapterExample;
import com.lzn.domain.Test;
import com.lzn.domain.TestExample;
import com.lzn.dto.ChapterDto;
import com.lzn.dto.PageDto;
import com.lzn.mapper.ChapterMapper;
import com.lzn.mapper.TestMapper;
import com.lzn.util.CopyUtil;
import com.lzn.util.UuidUtil;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.util.StringUtils;

import java.util.ArrayList;
import java.util.List;


@Service
public class ChapterService {

    @Autowired
    private ChapterMapper chapterMapper;


//    public List<ChapterDto> list(PageDto pageDto) {
    public void list(PageDto pageDto) {

//        PageHelper.startPage(1,1);
        PageHelper.startPage(pageDto.getPage(), pageDto.getSize());
        ChapterExample chapterExample = new ChapterExample();
//        chapterExample.createCriteria().andIdEqualTo("1");
//        chapterExample.setOrderByClause("id desc ");
        List<Chapter> chapterList = chapterMapper.selectByExample(chapterExample);

        PageInfo<Chapter> pageInfo = new PageInfo<>(chapterList);
        pageDto.setTotal(pageInfo.getTotal());

        List<ChapterDto> chapterDtoList = new ArrayList<>();

        for(int i = 0;i<chapterList.size();++i){
            Chapter chapter = chapterList.get(i);
            ChapterDto chapterDto = new ChapterDto();
            BeanUtils.copyProperties(chapter, chapterDto);
            chapterDtoList.add(chapterDto);
        }
        pageDto.setList(chapterDtoList);

    }

    public void save(ChapterDto chapterDto){
        Chapter chapter = CopyUtil.copy(chapterDto, Chapter.class);
        if(StringUtils.isEmpty(chapterDto.getId())){
            // 新增
            this.insert(chapter);
        } else {
            // 更新
            this.update(chapter);
        }
    }

    // 新增大章
    private void insert(Chapter chapter){
        // 传进来没有id
        chapter.setId(UuidUtil.getShortUuid());
//        Chapter chapter = new Chapter();
//        BeanUtils.copyProperties(chapterDto, chapter);
//        Chapter chapter = CopyUtil.copy(chapterDto, Chapter.class);
        chapterMapper.insert(chapter);
    }

    // 更新大章
    private void update(Chapter chapter){
//        Chapter chapter = CopyUtil.copy(chapterDto, Chapter.class);
        chapterMapper.updateByPrimaryKey(chapter);
    }
}

```

写完代码应该及时测试新增功能



前端:

hidden-md 中等屏幕隐藏，其他可见 

hidden-lg 大屏幕隐藏，其他可见，

相反的有 visible-xx

增加编辑功能

```vue

<template>
  <div>
    <p>
      <button v-on:click="add()" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-edit"></i>
        新增
      </button>
      &nbsp;
      <button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-refresh"></i>
        刷新
      </button>
    </p>

    <pagination ref="pagination" v-bind:list="list"></pagination>

    <table id="simple-table" class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>名称</th>
          <th>课程ID</th>
          <th>操作</th>
        </tr>
      </thead>

      <tbody>
        <tr v-for="chapter in chapters">
          <td>{{ chapter.id }}</td>
          <td>{{ chapter.name }}</td>
          <td>{{ chapter.courseId }}</td>
          <td>
            <div class="hidden-sm hidden-xs btn-group">
              <button v-on:click="edit(chapter)" class="btn btn-xs btn-info">
                <i class="ace-icon fa fa-pencil bigger-120"></i>
              </button>
              <button class="btn btn-xs btn-danger">
                <i class="ace-icon fa fa-trash-o bigger-120"></i>
              </button>
            </div>

            <div class="hidden-md hidden-lg">
              <div class="inline pos-rel">
                <button
                  class="btn btn-minier btn-primary dropdown-toggle"
                  data-toggle="dropdown"
                  data-position="auto"
                >
                  <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                </button>

                <ul
                  class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close"
                >
                  <li>
                    <a
                      href="#"
                      class="tooltip-info"
                      data-rel="tooltip"
                      title="View"
                    >
                      <span class="blue">
                        <i class="ace-icon fa fa-search-plus bigger-120"></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-success"
                      data-rel="tooltip"
                      title="Edit"
                    >
                      <span class="green">
                        <i
                          class="ace-icon fa fa-pencil-square-o bigger-120"
                        ></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-error"
                      data-rel="tooltip"
                      title="Delete"
                    >
                      <span class="red">
                        <i class="ace-icon fa fa-trash-o bigger-120"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- 模态框 -->
    <div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">表单</h4>
          </div>
          <div class="modal-body">
            <!-- 表单 -->
            <form class="form-horizontal">
              <div class="form-group">
                <label for="name" class="col-sm-2 control-label">名称</label>
                <div class="col-sm-10">
                  <input
                    v-model="chapter.name"
                    type="text"
                    class="form-control"
                    id="name"
                    placeholder="名称"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="courseID" class="col-sm-2 control-label"
                  >课程id</label
                >
                <div class="col-sm-10">
                  <input
                    v-model="chapter.courseId"
                    type="text"
                    class="form-control"
                    id="courseID"
                    placeholder="课程id"
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              取消
            </button>
            <button v-on:click="save()" type="button" class="btn btn-primary">
              保存
            </button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>

    <!-- /.modal -->
  </div>
</template>>


<script>
import Pagination from "../../components/pagination.vue";

export default {
  name: "chapter",
  components: { Pagination },

  data: function () {
    return {
      // 映射表单数据
      chapter: {},
      chapters: [],
    };
  },

  // 页面初始化加载方法
  mounted: function () {
    // this.$parent.activeSidebar('business-chapter-sidebar');
    let _this = this;
    _this.$refs.pagination.size = 5;
    _this.list(1);
  },
  methods: {
    // 编辑大章
    edit(chapter) {
      let _this = this;
      _this.chapter = chapter;
      // 禁止点击空白的地方关闭
      $(".modal").modal({
        backdrop: "static",
      });
      $("#form-modal").modal("show");
    },
    // 删除大章
    delete() {},
    // 新增大章
    add() {
      let _this = this;
      // 禁止点击空白的地方关闭
      $(".modal").modal({
        backdrop: "static",
      });
      $("#form-modal").modal("show");
    },

    // 获取所有大章的数据
    list(page) {
      let _this = this;
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/list", {
          page: page,
          //  跟组子组件获取  size应该有一个默认的参数
          size: _this.$refs.pagination.size,
        })
        .then((response) => {
          let resp = response.data;
          _this.chapters = resp.content.list;
          _this.$refs.pagination.render(page, resp.content.total);
        });
    },

    // 保存大章的数据
    save(page) {
      let _this = this;
      _this.$ajax
        .post(
          "http://127.0.0.1:9000/business/admin/chapter/save",
          _this.chapter
        )
        .then((response) => {
          let resp = response.data;
          if (resp.success) {
            // 关闭模态框
            $("#form-modal").modal("hide");
            _this.list(1);
          }
        });
    },
  },
};
</script>
```



vue的双向绑定反而会在修改的时候带来不好的影响

   _this.chapter = $.extend({}, chapter);



有新的问题：

对文本框编辑后，点新增弹出文本框，会带出上一次编辑过的值

```vue
    add() {
      let _this = this;
      // 禁止点击空白的地方关闭
      _this.chapter = {};
      $(".modal").modal({
        backdrop: "static",
      });
      $("#form-modal").modal("show");
    },
```

前端删除

```vue
<template>
  <div>
    <p>
      <button v-on:click="add()" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-edit"></i>
        新增
      </button>
      &nbsp;
      <button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
        <i class="ace-icon fa fa-refresh"></i>
        刷新
      </button>
    </p>

    <pagination ref="pagination" v-bind:list="list"></pagination>

    <table id="simple-table" class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>名称</th>
          <th>课程ID</th>
          <th>操作</th>
        </tr>
      </thead>

      <tbody>
        <tr v-for="chapter in chapters">
          <td>{{ chapter.id }}</td>
          <td>{{ chapter.name }}</td>
          <td>{{ chapter.courseId }}</td>
          <td>
            <div class="hidden-sm hidden-xs btn-group">
              <button v-on:click="edit(chapter)" class="btn btn-xs btn-info">
                <i class="ace-icon fa fa-pencil bigger-120"></i>
              </button>
              <button
                v-on:click="del(chapter.id)"
                class="btn btn-xs btn-danger"
              >
                <i class="ace-icon fa fa-trash-o bigger-120"></i>
              </button>
            </div>

            <div class="hidden-md hidden-lg">
              <div class="inline pos-rel">
                <button
                  class="btn btn-minier btn-primary dropdown-toggle"
                  data-toggle="dropdown"
                  data-position="auto"
                >
                  <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                </button>

                <ul
                  class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close"
                >
                  <li>
                    <a
                      href="#"
                      class="tooltip-info"
                      data-rel="tooltip"
                      title="View"
                    >
                      <span class="blue">
                        <i class="ace-icon fa fa-search-plus bigger-120"></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-success"
                      data-rel="tooltip"
                      title="Edit"
                    >
                      <span class="green">
                        <i
                          class="ace-icon fa fa-pencil-square-o bigger-120"
                        ></i>
                      </span>
                    </a>
                  </li>

                  <li>
                    <a
                      href="#"
                      class="tooltip-error"
                      data-rel="tooltip"
                      title="Delete"
                    >
                      <span class="red">
                        <i class="ace-icon fa fa-trash-o bigger-120"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- 模态框 -->
    <div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">表单</h4>
          </div>
          <div class="modal-body">
            <!-- 表单 -->
            <form class="form-horizontal">
              <div class="form-group">
                <label for="name" class="col-sm-2 control-label">名称</label>
                <div class="col-sm-10">
                  <input
                    v-model="chapter.name"
                    type="text"
                    class="form-control"
                    id="name"
                    placeholder="名称"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="courseID" class="col-sm-2 control-label"
                  >课程id</label
                >
                <div class="col-sm-10">
                  <input
                    v-model="chapter.courseId"
                    type="text"
                    class="form-control"
                    id="courseID"
                    placeholder="课程id"
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              取消
            </button>
            <button v-on:click="save()" type="button" class="btn btn-primary">
              保存
            </button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>

    <!-- /.modal -->
  </div>
</template>>


<script>
import Pagination from "../../components/pagination.vue";

export default {
  name: "chapter",
  components: { Pagination },

  data: function () {
    return {
      // 映射表单数据
      chapter: {},
      chapters: [],
    };
  },

  // 页面初始化加载方法
  mounted: function () {
    // this.$parent.activeSidebar('business-chapter-sidebar');
    let _this = this;
    _this.$refs.pagination.size = 5;
    _this.list(1);
  },
  methods: {
    // 编辑大章
    edit(chapter) {
      let _this = this;
      // _this.chapter = chapter;
      _this.chapter = $.extend({}, chapter);
      // 禁止点击空白的地方关闭
      $(".modal").modal({
        backdrop: "static",
      });
      $("#form-modal").modal("show");
    },
    // 删除大章
    del(id) {
      let _this = this;
      _this.$ajax
        .delete(
          "http://127.0.0.1:9000/business/admin/chapter/delete/" + id
        )
        .then((response) => {
          let resp = response.data;
          if (resp.success) {
            // 关闭模态框
            // $("#form-modal").modal("hide");
            _this.list(1);
          }
        });
    },
    // 新增大章
    add() {
      let _this = this;
      // 禁止点击空白的地方关闭
      _this.chapter = {};
      $(".modal").modal({
        backdrop: "static",
      });
      $("#form-modal").modal("show");
    },

    // 获取所有大章的数据
    list(page) {
      let _this = this;
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/list", {
          page: page,
          //  跟组子组件获取  size应该有一个默认的参数
          size: _this.$refs.pagination.size,
        })
        .then((response) => {
          let resp = response.data;
          _this.chapters = resp.content.list;
          _this.$refs.pagination.render(page, resp.content.total);
        });
    },

    // 保存大章的数据
    save(page) {
      let _this = this;
      _this.$ajax
        .post(
          "http://127.0.0.1:9000/business/admin/chapter/save",
          _this.chapter
        )
        .then((response) => {
          let resp = response.data;
          if (resp.success) {
            // 关闭模态框
            $("#form-modal").modal("hide");
            _this.list(1);
          }
        });
    },
  },
};
</script>
```



后端 

```
package com.lzn.business.controller.admin;


import com.lzn.dto.ChapterDto;
import com.lzn.dto.PageDto;
import com.lzn.dto.ResponseDto;
import com.lzn.service.ChapterService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
// 该路径说明是用来供控台使用了
@RequestMapping("/admin/chapter")
public class ChapterController {
    @Autowired
    private ChapterService chapterService;

    @PostMapping("/list")
    // requestBody --- json 默认是表单
    public ResponseDto list(@RequestBody PageDto pageDto) {
        ResponseDto responseDto = new ResponseDto();
        chapterService.list(pageDto);
        responseDto.setContent(pageDto);
//        return pageDto;
        return responseDto;
    }


    @PostMapping("/save")
    public ResponseDto save(@RequestBody ChapterDto chapterDto){
        ResponseDto responseDto = new ResponseDto();
        chapterService.save(chapterDto);
        responseDto.setContent(chapterDto);
//        return chapterDto;
        return responseDto;
    }


    @DeleteMapping("/delete/{id}")
    public ResponseDto delete(@PathVariable String id) {
        // 根据id 找到 chapter
        ResponseDto responseDto = new ResponseDto();
        chapterService.delete(id);
        return responseDto;

    }


}

```

```
public void delete(String id) {
    chapterMapper.deleteByPrimaryKey(id);
}
```



# 集成前端通用组件

## 集成sweetalert 用于界面消息确认框

删除时一个有风险的操作，需要有确认的动作

https://sweetalert2.github.io/

index.html

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

```js
Swal.fire({
  title: 'Are you sure?',
  text: "You won't be able to revert this!",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, delete it!'
}).then((result) => {
  if (result.isConfirmed) {
    Swal.fire(
      'Deleted!',
      'Your file has been deleted.',
      'success'
    )
  }
})
```



```
 // 删除大章
    del(id) {
      let _this = this;
      Swal.fire({
        title: "确认删除?",
        text: "删除后不可恢复，确认删除？",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "确认！",
      }).then((result) => {
        if (result.isConfirmed) {
          _this.$ajax
            .delete("http://127.0.0.1:9000/business/admin/chapter/delete/" + id)
            .then((response) => {
              let resp = response.data;
              if (resp.success) {
                // 关闭模态框
                // $("#form-modal").modal("hide");
                Swal.fire("删除成功!", "删除成功.", "success");
                _this.list(1);
              }
            });
        }
      });
    },
```



## 制作消息提示框

toast public/static/js/toast.js

```js
const Toast = Swal.mixin({
    toast: true,
    position: 'top-end',
    showConfirmButton: false,
    timer: 3000,
    timerProgressBar: true,
    didOpen: (toast) => {
        toast.addEventListener('mouseenter', Swal.stopTimer)
        toast.addEventListener('mouseleave', Swal.resumeTimer)
    }
})

// Toast.fire({
//     icon: 'success',
//     title: 'Signed in successfully'
// });


toast = {
    success: function (message) {
        Toast.fire({
            icon: 'success',
            title: message
        })
    },

    error: function (message) {
        Toast.fire({
            icon: 'error',
            title: message
        })
    },

    warning: function (message) {
        Toast.fire({
            icon: 'warning',
            title: message
        })
    }
};
```



通用代码提取出来做成一个组件

vue组件必须要引入

用原生

index.html



```js

		<!-- 消息框 -->
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

		<!-- toast.js -->
		<script src="<%= BASE_URL %>static/js/toast.js"></script>

```



toast是js全局变量，可以在其他js文件中使用，也可以在vue组件中直接使用



chapter.vue

```vue
    // 保存大章的数据
    save(page) {
      let _this = this;
      _this.$ajax
        .post(
          "http://127.0.0.1:9000/business/admin/chapter/save",
          _this.chapter
        )
        .then((response) => {
          let resp = response.data;
          if (resp.success) {
            // 关闭模态框
            $("#form-modal").modal("hide");
            _this.list(1);
            toast.success("保存成功");
          }
        });
    },
```



## 集成blockUI用于界面等待框



等待框的作用：

1 让用户知道，后端正在处理，耐心等待

2 防止用户恶心重复点击

http://malsup.com/jquery/block/



https://www.bootcdn.cn/





index.html

```js

		<!-- blockUI -->
		<script src="https://cdn.bootcdn.net/ajax/libs/jquery.blockUI/2.70.0-2014.11.23/jquery.blockUI.min.js"></script>
		<!-- loading等待框 -->
		<script src="<%= BASE_URL %>static/js/loading.js"></script>



```





loading.js

```js
Loading = {
    show: function () {
      $.blockUI({
        message: '<img src="/static/image/loading.gif" />',
        css: {
          zIndex: "10011",
          padding: "10px",
          left: "50%",
          width: "80px",
          marginLeft: "-40px",
        }
      });
    },
    hide: function () {
      // 本地查询速度太快，loading显示一瞬间，故意做个延迟
      setTimeout(function () {
        $.unblockUI();
      }, 500)
    }
  };
```



chapter.vue

```vue
    // 获取所有大章的数据
    list(page) {
      let _this = this;
      Loading.show();
      _this.$ajax
        .post("http://127.0.0.1:9000/business/admin/chapter/list", {
          page: page,
          //  跟组子组件获取  size应该有一个默认的参数
          size: _this.$refs.pagination.size,
        })
        .then((response) => {
          Loading.hide();
          let resp = response.data;
          _this.chapters = resp.content.list;
          _this.$refs.pagination.render(page, resp.content.total);
        });
    },
```





代码优化一下toast.js之前的太小了

```js
// const Toast = Swal.mixin({
//     toast: true,
//     position: 'top-end',
//     showConfirmButton: false,
//     timer: 3000,
//     timerProgressBar: true,
//     didOpen: (toast) => {
//         toast.addEventListener('mouseenter', Swal.stopTimer)
//         toast.addEventListener('mouseleave', Swal.resumeTimer)
//     }
// })

// Toast.fire({
//     icon: 'success',
//     title: 'Signed in successfully'
// });


Toast = {
    success: function (message) {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: message,
            showConfirmButton: false,
            timer: 3000
        })
    },

    error: function (message) {
        Swal.fire({
            position: 'top-end',
            icon: 'error',
            title: message,
            showConfirmButton: false,
            timer: 3000
        })
    },

    warning: function (message) {
        Swal.fire({
            position: 'top-end',
            icon: 'waring',
            title: message,
            showConfirmButton: false,
            timer: 3000
        })
    }
};
```





确认框优化

简单理解js回调函数：

将一个函数以参数形式传递到另一个函数里去执行，在自定义组件中经常用到回调函数

将变化的代码（组件无关的代码）作为回调函数传递进来



confirm.js

```js
Confirm = {
    show: function (message, callback) {
        Swal.fire({
            title: '确认？',
            text: message,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: '确认!'
        }).then((result) => {
            if (result.value) {
                if (callback) {
                    callback()
                }
            }
        })
    }
}
```

index.html引入

chapter.vue

```js

  del(id) {
      let _this = this;

      Confirm.show("删除大章后不可恢复，确认删除？", function () {
        Loading.show();
        _this.$ajax
          .delete("http://127.0.0.1:9000/business/admin/chapter/delete/" + id)
          .then((response) => {
            Loading.hide();
            let resp = response.data;
            if (resp.success) {
              _this.list(1);
              Toast.success("删除成功！");
            }
          });
      });
    },
```







# 代码优化



## 前端代码校验

新增，长度，非空



tool.js

```js

Tool = {
    /**
     * 空校验 null或""都返回true
     */
    isEmpty: function (obj) {
      if ((typeof obj == 'string')) {
        // https://blog.csdn.net/dreamjay1997/article/details/86599404
        return !obj || obj.replace(/\s+/g, "") == ""
      } else {
        return (!obj || JSON.stringify(obj) === "{}" || obj.length === 0);
      }
    },
  
    /**
     * 非空校验
     */
    isNotEmpty: function (obj) {
      return !this.isEmpty(obj);
    },
  
    /**
     * 长度校验
     */
    isLength: function (str, min, max) {
      return $.trim(str).length >= min && $.trim(str).length <= max;
    }
}
```



validator.js

```js

Validator = {
    require: function (value, text) {
      if (Tool.isEmpty(value)) {
        Toast.warning(text + "不能为空");
        return false;
      } else {
        return true
      }
    },
  
    length: function (value, text, min, max) {
      if (Tool.isEmpty(value)) {
        return true;
      }
      if (!Tool.isLength(value, min, max)) {
        Toast.warning(text + "长度" + min + "~" + max + "位");
        return false;
      } else {
        return true
      }
    }
  };
```

index.html引入tool.js 和 validator.js



chapter.vue

```js
      // 保存校验 非空检验和长度检验
      if (
        !Validator.require(_this.chapter.name, "名称") ||
        !Validator.require(_this.chapter.courseId, '课程ID') || 
        !Validator.length(_this.chapter.courseId, "课程ID", 1, 8)
      ) {
        return;
      }

```







## 后端代码校验

目的：

前后端分离的项目，后端接口需要增加和前端一样的校验，防止被绕过前端界面，利用第三方工具如postman，直接访问后端接口



验证异常

server exception

```java
package com.lzn.exception;

public class ValidatorException extends RuntimeException{

    public ValidatorException(String message) {
        super(message);
    }
}

```

server util

```java
package com.lzn.util;


import com.lzn.exception.ValidatorException;
import org.springframework.util.StringUtils;

public class ValidatorUtil {

    /**
     * 空校验（null or ""）
     */
    public static void require(Object str, String fieldName) {
        if (StringUtils.isEmpty(str)) {
            throw new ValidatorException(fieldName + "不能为空");
        }
    }

    /**
     * 长度校验
     */
    public static void length(String str, String fieldName, int min, int max) {
        if (StringUtils.isEmpty(str)) {
            return;
        }
        int length = 0;
        if (!StringUtils.isEmpty(str)) {
            length = str.length();
        }
        if (length < min || length > max) {
            throw new ValidatorException(fieldName + "长度" + min + "~" + max + "位");
        }
    }
}

```



自定义异常类可以继承 runtimeException或者exception 

一般项目内部业务一场，可以用runtimeException，不需要try catch

如果是开发一些框架或工具类，明确告诉外部

需要做异常处理的，可以用exception， 另外还需要考虑事务中的异常处理



在business  controller 里应用validator

```
    @PostMapping("/save")
    public ResponseDto save(@RequestBody ChapterDto chapterDto){

        // 保存验证
        ValidatorUtil.require(chapterDto.getName(), "名称");
        ValidatorUtil.require(chapterDto.getCourseId(), "课程ID");
        ValidatorUtil.length(chapterDto.getCourseId(), "课程ID",
        1, 8);
        
        ResponseDto responseDto = new ResponseDto();
        chapterService.save(chapterDto);
        responseDto.setContent(chapterDto);
//        return chapterDto;
        return responseDto;
    }
```

后端出现异常， 前端then无法继续，前端卡死在刷新请求，只能通过刷新网站来解决

解决方式：

```java
        // 保存验证
        try {
            ValidatorUtil.require(chapterDto.getName(), "名称");
            ValidatorUtil.require(chapterDto.getCourseId(), "课程ID");
            ValidatorUtil.length(chapterDto.getCourseId(), "课程ID",
                    1, 8);
        } catch (Exception e) {
            ResponseDto responseDto = new ResponseDto();
            responseDto.setSuccess(false);
            
            return responseDto;
        }
```

但是这种方式还是不够好



在business controller 新建ControllerException

关键注解：@ControllerAdvice

是controller的增强器，可以对controller做统一的处理，如异常处理，数据处理等



有时候，我们的接口原本是不对外的，或者只限定特定的第三方应用做对策，这时为了内部

安全，不应该把参数的校验规则暴露出去，所以需要模糊返回信息，不然容器被探测





```
package com.lzn.business.controller;

import com.lzn.dto.ResponseDto;
import com.lzn.exception.ValidatorException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

/**
 * 统一控制层异常处理器
 */
@ControllerAdvice
public class ControllerException {

    @ExceptionHandler(value = ValidatorException.class)
    @ResponseBody
    public ResponseDto validatorExceptionHandle(ValidatorException e) {
        ResponseDto responseDto = new ResponseDto();
        responseDto.setSuccess(false);
        responseDto.setMessage("请求参数异常!");
        return responseDto;
    }
}
```



然后再取消前端校验的注释
如果开发过程中提示 请求参数异常，说明后端有校验拦截，前端没有，此时应该把前端校验加上






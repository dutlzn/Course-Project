---
typora-root-url: /images
---

# 文件上传功能开发

# 完成基本的文件上传功能

## 搭建单独文件模块file

com.lzn.file.config

启动类

```
package com.lzn.file.config;


import org.mybatis.spring.annotation.MapperScan;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.core.env.Environment;

@SpringBootApplication
@EnableEurekaClient // 注册到注册中心
@MapperScan("com.lzn.mapper")
@ComponentScan("com.lzn")
public class FileApplication {
    private static final Logger LOG = LoggerFactory.getLogger(FileApplication.class);

    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(FileApplication.class);
        Environment environment = app.run(args).getEnvironment();
        LOG.info("启动成功！！");
        LOG.info("File地址: \thttp://127.0.0.1:{}", environment.getProperty("server.port"));
    }
}

```

file pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>course</artifactId>
        <groupId>com.lzn</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>file</artifactId>
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- 集成mybatis -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>

        <dependency>
            <groupId>com.lzn</groupId>
            <artifactId>server</artifactId>
        </dependency>
        <dependency>
            <groupId>com.lzn</groupId>
            <artifactId>server</artifactId>
        </dependency>


    </dependencies>


</project>
```

复制system resource 下面的两个文件到file模块里

```
# 系统名称
spring.application.name=file
# 系统路径
server.servlet.context-path=/file
# 系统端口
server.port=9003
# 注册中心
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
```





修改logback.xml中的路径





修改gateway 配置文件

```
# 应用名字
spring.application.name=gateway
# 启动端口
server.port=9000
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# 路由转发配置
spring.cloud.gateway.routes[0].id=system
spring.cloud.gateway.routes[0].uri=http://127.0.0.1:9001
spring.cloud.gateway.routes[0].predicates[0].name=Path
spring.cloud.gateway.routes[0].predicates[0].args[0]=/system/**


spring.cloud.gateway.routes[1].id=business
#spring.cloud.gateway.routes[1].uri=http://127.0.0.1:9002
spring.cloud.gateway.routes[1].uri=lb://business
spring.cloud.gateway.routes[1].predicates[0].name=Path
spring.cloud.gateway.routes[1].predicates[0].args[0]=/business/**

spring.cloud.gateway.routes[2].id=file
spring.cloud.gateway.routes[2].uri=lb://file
spring.cloud.gateway.routes[2].predicates[0].name=Path
spring.cloud.gateway.routes[2].predicates[0].args[0]=/file/**
```





## springboot + vue文件上传功能

type = "file" 文件上传控件

触发文件上传动作方法一： 在文件上传组件上增加change事件

teacher.vue

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" />
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<input id="file-upload-input" type="file" v-on:change="uploadImage()">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
				})
			}
		}
	}
</script>

```

后端

file controller admin

```java
package com.lzn.file.controller.admin;


import com.lzn.dto.ResponseDto;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug


        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        String key = UuidUtil.getShortUuid();
        String fullPath = "D:/code/file/teacher/" + key +"-" + fileName;
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        ResponseDto responseDto = new ResponseDto();
        return responseDto;
    }
}

```



# 讲师头像的保存和显示

## 文件访问配置

springboot 静态资源的配置，静态自愿包含图片、css、js等

file config 



```
package com.lzn.file.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class SpringMvcConfig implements WebMvcConfigurer {
//
//    @Value("${file.path}")
//    private String FILE_PATH;

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/**").addResourceLocations("file:D:/code/file/teacher/");
    }
    // http:127.0.0.1:9003/file/f/teacher/XPEC7kSP-头像1.jpg
}
```

浏览器可以直接访问到图片

http://127.0.0.1:9000/file/teacher/njSFOZ5M-%E5%A4%B4%E5%83%8F2.jpg





测试路由转发到file是否生效，

测试的时候要注意浏览器是有静态资源缓存的，可以用ctrl+f5强制刷新，

也可以用chrome 无痕浏览来测试，不会有缓存





这里测试打开不来于是开始学习，如何进行文件访问配置

https://blog.csdn.net/shuaigg001/article/details/94433969

https://www.cnblogs.com/java-synchronized/p/7091723.html





## 修改BUG

uploadController



```
package com.lzn.file.controller.admin;


import com.lzn.dto.ResponseDto;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug


        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        String key = UuidUtil.getShortUuid();
        String fullPath = "D:/code/file/teacher/" + key +"-" + fileName;
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        ResponseDto responseDto = new ResponseDto();
        return responseDto;
    }
}
```



config配置

```
package com.lzn.file.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

//@Configuration
//@EnableWebMvc
//public class SpringMvcConfig implements WebMvcConfigurer {
//    @Override
//    public void addResourceHandlers(ResourceHandlerRegistry registry) {
//        registry.addResourceHandler("/f/**")
//                .addResourceLocations("file:D:/code/file/teacher/");
//
//    }
//}


@Configuration
public  class SpringMvcConfig extends WebMvcConfigurationSupport {
    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/**")
                .addResourceLocations("file:D:/code/file/teacher/");

        super.addResourceHandlers(registry);
    }
}
```

http://127.0.0.1:9003/file/f/hc7gLRQ2-%E5%A4%B4%E5%83%8F1.jpg

为什么f 后面不能跟teacher

```
package com.lzn.file.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

//@Configuration
//@EnableWebMvc
//public class SpringMvcConfig implements WebMvcConfigurer {
//    @Override
//    public void addResourceHandlers(ResourceHandlerRegistry registry) {
//        registry.addResourceHandler("/f/**")
//                .addResourceLocations("file:D:/code/file/teacher/");
//
//    }
//}


@Configuration
public  class SpringMvcConfig extends WebMvcConfigurationSupport {
    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/teacher/**")
                .addResourceLocations("file:D:/code/file/teacher/");

        super.addResourceHandlers(registry);
    }
}
```

改成这样http://127.0.0.1:9003/file/f/teacher/hc7gLRQ2-%E5%A4%B4%E5%83%8F1.jpg 就可以访问了



图片卡单自适应bug

```html
						<img v-show="!course.image" style="width: 100%;" class="media-object img-responsive" src="/static/image/demo-course.jpg" />
						<img v-show="course.image" style="width: 100%;"  class="media-object img-responsive" v-bind:src="course.image" />
```





img-responsive : bootstrap 内置的样式，图片自适应，

前面有一个图片自适应的bug已经解决了，但是效果还是不好，如果文字过长的话，应该决定了整个页面的高度’





## 实时显示与保存

前端 teacher.vue

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable  editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" />
						<img v-show="teacher.image" class="editable  editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<input id="file-upload-input" type="file" v-on:change="uploadImage()">
									<img v-bind:src="teacher.image" class="img-responsive" >
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
					
				})
			}
		}
	}
</script>

```



## 显示美化



利用bootstrap 栅格系统，一个div是12格，可以让图片只占用4格的宽度

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" />
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<input id="file-upload-input" type="file" v-on:change="uploadImage()">
									<div v-show="teacher.image" class="row">
										<div class="col-sm-4">
											<img v-bind:src="teacher.image" class="img-responsive" >
										</div>
									
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
					
				})
			}
		}
	}
</script>

```



后端修改

```
# 系统名称
spring.application.name=file
# 系统路径
server.servlet.context-path=/file
# 系统端口
server.port=9003
# 注册中心
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
# 文件配置
file.path=D:/code/file/
file.domain=http://127.0.0.1:9000/file/


```





```
package com.lzn.file.controller.admin;


import com.lzn.dto.ResponseDto;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    @Value("${file.path}")
    private String FILE_PATH;
    @Value("${file.domain}")
    private String FILE_DOMAIN;

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug

        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        String key = UuidUtil.getShortUuid();
        String fullPath =FILE_PATH  + "teacher/" + key +"-" + fileName;
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        ResponseDto responseDto = new ResponseDto();
        responseDto.setContent(FILE_DOMAIN + "f/teacher/" + key + "-" +fileName);
        return responseDto;
    }
}
```







```
package com.lzn.file.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public  class SpringMvcConfig extends WebMvcConfigurationSupport {

    @Value("${file.path}")
    private String FILE_PATH;

    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/teacher/**")
                .addResourceLocations("file:" + FILE_PATH+ "/teacher/");

        super.addResourceHandlers(registry);
    }
}
```





maven多环境配置，将开发环境和生产环境配置成不同的值





# 文件上传组件开发

优化的点：

用一个单独的按钮，来代替file 空间， 且操作的流程没有变化





图片自适应调整：

1. flex  bootstrap4才有的。
2. img-responsive bootstrap自带样式



teacher.vue:

```
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" 
						 style="width: 200px;height:200px;"/>
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro"
							style="width: 200px;height:200px;"/>
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<button 
									style="margin-bottom: 5px;"
									v-on:click="selectImage()"
									type="button"
									class= "btn btn-white btn-default btn-round">
										<i class="ace-icon fa fa-upload">
											上传头像
										</i>
									</button>
									
									<div></div>
									
									<input class="hidden" id="file-upload-input" type="file" v-on:change="uploadImage()">
									<div v-show="teacher.image" class="row">
										<div class="col-sm-4">
											<img v-bind:src="teacher.image" class="img-responsive" >
										</div>
									
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
				})
			},
			
			selectImage() {
				$("#file-upload-input").trigger("click");// 触发
			}
		}
	}
</script>

```



## 增加上传文件类型的判断

优化： 使用vue的$refs来获取组件

teacher.vue

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" 
						 style="width: 200px;height:200px;"/>
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro"
							style="width: 200px;height:200px;"/>
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<button 
									style="margin-bottom: 5px;"
									v-on:click="selectImage()"
									type="button"
									class= "btn btn-white btn-default btn-round">
										<i class="ace-icon fa fa-upload">
											上传头像
										</i>
									</button>
									
									<div></div>
									
									<input ref="file" class="hidden" id="file-upload-input" type="file" v-on:change="uploadImage()">
									<div v-show="teacher.image" class="row">
										<div class="col-sm-4">
											<img v-bind:src="teacher.image" class="img-responsive" >
										</div>
									
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				let file = _this.$refs.file.files[0];
				// 判断文件格式
				let suffixs = ["jpg", "jpeg", "png"];
				let fileName = file.name;
				let suffix = fileName.substring(fileName.lastIndexOf(".") + 1, fileName.length).toLowerCase();
				
				let validateSuffix = false;
				for(let i = 0;i<suffixs.length;++i) {
					if(suffixs[i].toLowerCase() === suffix ) {
						validateSuffix = true;
						break;
					}
				}
				
				if(!validateSuffix) {
					Toast.warning("文件格式不正确,只支持上传:" + suffixs.join(","));
					return ;
				}
				
				formData.append('file', file);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
				})
			},
			
			selectImage() {
				$("#file-upload-input").trigger("click");// 触发
			}
		}
	}
</script>

```





## 制作文件上传公共组件

一个项目中 很多地方会用到文件上传，所以有必要把文件上传功能做成组件

props用于父子组件传递数据，可以理解成组件可配置的属性



为组件增加上传 成功后的回调函数，和组件不相关的业务代码应该由外部通过回调函数传进来

如果一个页面放了两个文件上传组件，会出现两个input的id重复

，可以把id也做成可以配置的





components file.vue

```vue
<template>
	<div>
		<button style="margin-bottom: 5px;" v-on:click="selectFile()" type="button" class="btn btn-white btn-default btn-round">
			<i class="ace-icon fa fa-upload">
				{{ text }}
			</i>
		</button>


		<input ref="file" class="hidden" v-bind:id="inputId+'-input'" type="file" v-on:change="uploadFile()">
	</div>
</template>

<script>
	export default {
		name: 'file',
		props: {
			text: {
				default: "上传文件"
			},
			inputId: {
				default: "file-upload"
			},
			suffixs: {
				default: []
			},
			afterUpload: {
				type: Function,
				default: null
			}
		},
		data: function() {
			return {

			};
		},
		methods: {

			uploadFile() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				let file = _this.$refs.file.files[0];
				// 判断文件格式
				let suffixs = _this.suffixs;
				let fileName = file.name;
				let suffix = fileName.substring(fileName.lastIndexOf(".") + 1, fileName.length).toLowerCase();

				let validateSuffix = false;
				for (let i = 0; i < suffixs.length; ++i) {
					if (suffixs[i].toLowerCase() === suffix) {
						validateSuffix = true;
						break;
					}
				}

				if (!validateSuffix) {
					Toast.warning("文件格式不正确,只支持上传:" + suffixs.join(","));
					$("#" + _this.inputId + "-input").val("");
					return;
				}

				formData.append('file', file);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					console.log("上传文件成功:", resp);
					_this.afterUpload(resp);
					
					// 清空，下次在选择同一个东西时候，也会触发
					$("#" + _this.intputId + "-input").val("");
					

				})
			},

			selectFile() {
				let _this = this;
        $("#" + _this.inputId + "-input").trigger("click");
			}
		}
	}
</script>

<style>
</style>

```





view teacher.vue

```vue

<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" style="width: 200px;height:200px;" />
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" style="width: 200px;height:200px;" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<file v-bind:text="'上传头像1'" 
									v-bind:after-upload="afterUpload"
									v-bind:suffixs="['jpg', 'jpeg', 'png']"
									v-bind:input-id="'image-upload'"></file>
									
									<div v-show="teacher.image" class="row">
										<div class="col-md-4">
											<img v-bind:src="teacher.image" class="img-responsive">
										</div>
									</div>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	import File from "../../components/file.vue";
	export default {
		components: {
			Pagination,
			File
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},

			afterUpload(resp) {
				let _this = this;
				let image = resp.content;
				console.log("头像地址:" , image);
				_this.teacher.image = image;
			}
		}
	}
</script>

```





# 增加文件管理功能

## 文件表设计与基本代码生成

```sql
-- 文件
drop table if exists `file`;
create table `file` (
  `id` char(8) not null default '' comment 'id',
  `path` varchar(100) not null comment '相对路径',
  `name` varchar(100) comment '文件名',
  `suffix` varchar(10) comment '后缀',
  `size` int comment '大小|字节B',
  `use` char(1) comment '用途|枚举[FileUseEnum]：COURSE("C", "讲师"), TEACHER("T", "课程")',
  `created_at` datetime(3) comment '创建时间',
  `updated_at` datetime(3) comment '修改时间',
  primary key (`id`),
  unique key `path_unique` (`path`)
) engine=innodb default charset=utf8mb4 comment='文件';
```





持久层

```
<table tableName="file" domainObjectName="File"/>
```



服务层  生成



server enum：

```java
package com.lzn.enums;

public enum FileUseEnum {

    COURSE("C", "课程"),
    TEACHER("T", "讲师");

    private String code;

    private String desc;

    FileUseEnum(String code, String desc) {
        this.code = code;
        this.desc = desc;
    }

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public void setDesc(String desc) {
        this.desc = desc;
    }

    public String getDesc() {
        return desc;
    }

    public static FileUseEnum getByCode(String code){
        for(FileUseEnum e: FileUseEnum.values()){
            if(code.equals(e.getCode())){
                return e;
            }
        }
        return  null;
    }
}

```



然后枚举类生成

```
package com.lzn.generator.enums;


import com.lzn.enums.*;

import java.io.FileOutputStream;
import java.io.OutputStreamWriter;
import java.lang.reflect.Method;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class EnumGenerator {
    static String path = "D:\\code\\course-project\\admin\\public\\static\\js\\enums.js";

    public static void main(String[] args) {
        StringBuffer bufferObject = new StringBuffer();
        StringBuffer bufferArray = new StringBuffer();
        long begin = System.currentTimeMillis();
        try {
            toJson(SectionChargeEnum.class, bufferObject, bufferArray);
            toJson(YesNoEnum.class, bufferObject, bufferArray);
            toJson(CourseLevelEnum.class, bufferObject, bufferArray);
            toJson(CourseStatusEnum.class, bufferObject, bufferArray);
            toJson(CourseChargeEnum.class, bufferObject, bufferArray);
            toJson(FileUseEnum.class, bufferObject, bufferArray);


            StringBuffer buffer = bufferObject.append("\r\n").append(bufferArray);
            writeJs(buffer);
        } catch (Exception e) {
            e.printStackTrace();
        }
        long end = System.currentTimeMillis();
        System.out.println("执行耗时:" + (end - begin) + " 毫秒");
    }

    private static void toJson(Class clazz, StringBuffer bufferObject, StringBuffer bufferArray) throws Exception {
        String key = toUnderline(clazz.getSimpleName());
        toJson(clazz, key, bufferObject, bufferArray);
    }

    private static void toJson(Class clazz, String key, StringBuffer bufferObject, StringBuffer bufferArray) throws Exception {
        Object[] objects = clazz.getEnumConstants();
        Method name = clazz.getMethod("name");
        Method getDesc = clazz.getMethod("getDesc");
        Method getCode = clazz.getMethod("getCode");

        // 生成对象
        bufferObject.append(key).append("={");
        for (int i = 0; i < objects.length; i++) {
            Object obj = objects[i];
            if (getCode == null) {
                bufferObject.append(name.invoke(obj)).append(":{key:\"").append(name.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            } else {
                bufferObject.append(name.invoke(obj)).append(":{key:\"").append(getCode.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            }
            if (i < objects.length - 1) {
                bufferObject.append(",");
            }
        }
        bufferObject.append("};\r\n");

        // 生成数组
        bufferArray.append(key).append("_ARRAY=[");
        for (int i = 0; i < objects.length; i++) {
            Object obj = objects[i];
            if (getCode == null) {
                bufferArray.append("{key:\"").append(name.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            } else {
                bufferArray.append("{key:\"").append(getCode.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            }
            if (i < objects.length - 1) {
                bufferArray.append(",");
            }
        }
        bufferArray.append("];\r\n");
    }

    /**
     * 写文件
     * @param stringBuffer
     */
    public static void writeJs(StringBuffer stringBuffer) {
        FileOutputStream out = null;
        try {
            out = new FileOutputStream(path);
            OutputStreamWriter osw = new OutputStreamWriter(out, "UTF-8");
            System.out.println(path);
            osw.write(stringBuffer.toString());
            osw.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        finally {
            try {
                out.close();
            } catch (Exception e) {
                e.printStackTrace();
            }

        }
    }

    /**
     * 功能：驼峰转大写下划线，并去掉_ENUM
     * 如：SectionChargeEnum 变成 SECTION_CHARGE
     * @param str
     * @return
     */
    public static String toUnderline(String str) {
        String result = underline(str).toString();
        return result.substring(1, result.length()).toUpperCase().replace("_ENUM", "");
    }

    /**
     * 驼峰转下划线，第一位是下划线
     * 如：SectionChargeEnum 变成 _section_charge_enum
     * @param str
     * @return
     */
    private static StringBuffer underline(String str) {
        Pattern pattern = Pattern.compile("[A-Z]");
        Matcher matcher = pattern.matcher(str);
        StringBuffer sb = new StringBuffer(str);
        if(matcher.find()) {
            sb = new StringBuffer();
            matcher.appendReplacement(sb,"_"+matcher.group(0).toLowerCase());
            matcher.appendTail(sb);
        }else {
            return sb;
        }
        return underline(sb.toString());
    }
}
```

再运行





vue生成

-----



# 重点！



我先重写了前端 用vuetify

在另外一个仓库里

另外小节保存时长更新有个bug，需要修改sql，已经完成



todo: 修改前端代码生成器





从这里开始 就开始用新的前端模板了

navbar.vue

				<v-list-group :value="true" prepend-icon="apps" color="blue" no-action="">
					<template v-slot:activator>
						<v-list-item-content>
							<v-list-item-title>文件管理</v-list-item-title>
						</v-list-item-content>
					</template>
				
					<v-list-item to="/file/file">
						<v-list-item-content>
							<v-list-item-title>文件管理</v-list-item-title>
						</v-list-item-content>
					</v-list-item>


route index.js

```js
import Vue from 'vue'
// import VueRouter from 'vue-router'
import Router from 'vue-router'
// 导入组件
import Login from '../views/login.vue'
import Admin from '../views/admin.vue'
import Welcome from '../views/admin/welcome.vue'
import Category from '../views/admin/category.vue'
import Teacher from '../views/admin/teacher.vue'
import Course from '../views/admin/course.vue'
import Chapter from '../views/admin/chapter.vue'
import Section from '../views/admin/section.vue'
import File from '../views/admin/file.vue'
// Vue.use(VueRouter);
Vue.use(Router);

// const routes = [
	
// ]

// const router = new VueRouter({
//   mode: 'history',
//   base: process.env.BASE_URL,
//   routes
// })

// export default router
export default new Router(
    {
        mode: 'history', // history hash 推荐使用history hash 的话前面由前缀，url形式不美观，history推荐使用，路由前面只有以恶搞#
        base: process.env.BASE_URL,
        routes: [{
            path: '*',
            redirect: "/login",
        }, {
            path: "/login",
            component: Login
        }, {
            path: "/",
            name: "admin", 
            // name属性后面会用到
            component: Admin,
            children: [{
                path: 'welcome',
                name: 'welcome',
                component: Welcome
            }, {
                path: 'business/category',
                name: 'business/category',
                component: Category
            }, {
							path: 'business/teacher',
							name: 'business/teacher',
							component: Teacher
						}, {
							path: 'business/course',
							name: 'business/course',
							component: Course
						}, {
							path: 'business/chapter',
							name: 'business/chapter',
							component: Chapter
						}, {
							path: 'business/section',
							name: 'business/section',
							component: Section
						}, {
							path: 'file/file',
							name: 'file/file',
							component: File
						}]
        }],
				
				ScrollBehavior(to ,from, savedPosition) {
					return {x: 0, y:0};
				}
    }

)
```



mapper 自动配置文件钟

```
<property name="autoDelimitKeywords" value="true"/>
```

可以自动检测关键字



server 生成器

```
static String MODULE = "file";
```

vue 生成器

```
static String MODULE = "file";
```

然后再生成



## 上传文件保存文件记录

统一文件名为 8 位uuid文件后缀，后面会进一步规范文件名

修改file 属性配置

```
# 系统名称
spring.application.name=file
# 系统路径
server.servlet.context-path=/file
# 系统端口
server.port=9003
# 注册中心
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
# 文件配置
file.path=D:/code/file/
file.domain=http://127.0.0.1:9000/file/f/
```





uploadController

```
package com.lzn.file.controller.admin;


import com.lzn.dto.FileDto;
import com.lzn.dto.ResponseDto;
import com.lzn.service.FileService;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    @Value("${file.path}")
    private String FILE_PATH;
    @Value("${file.domain}")
    private String FILE_DOMAIN;

    @Autowired
    private FileService fileService;

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug

        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        // 文件后缀
        String suffix = fileName.substring(fileName.lastIndexOf(".") + 1).toLowerCase();
        String key = UuidUtil.getShortUuid();
        String path  = "teacher/" + key + "." + suffix;

        String fullPath =FILE_PATH  + path;
        // 文件的路径应该是自动生成的
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        LOG.info("保存文件记录开始");
        FileDto fileDto = new FileDto();
        fileDto.setPath(path);
        fileDto.setName(fileName);
        fileDto.setSize(Math.toIntExact(file.getSize()));
        fileDto.setSuffix(suffix);
        fileDto.setUse("");


        fileService.save(fileDto);


        ResponseDto responseDto = new ResponseDto();
        responseDto.setContent(FILE_DOMAIN + path);
        return responseDto;
    }
}

```



文件记录不允许编辑和删除，但是可以做一些统计功能，比如文件大小统计，文件类型统计，也可以增加文件审核功能，对不合规的图片、视频做处理



file.vue 去掉 新增、编辑、删除功能

```vue
<!-- 小节页面 -->
<template>
	<v-app class="ma-3" app>
		<v-dialog v-model="dialog" persistent max-width="300">
			<v-card>
				<v-card-title>
					表单
				</v-card-title>

				<v-card-text>
					<v-col cols="12">
						<v-text-field label="相对路径" v-model="file.path" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-text-field label="文件名" v-model="file.name" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-text-field label="后缀" v-model="file.suffix" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-text-field label="大小" v-model="file.size" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-select label="用途" v-model="file.use" :items="FILE_USE" item-text="value" item-value="key"></v-select>
					</v-col>

				</v-card-text>
				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn @click="dialog = false" clas="info">
						取消
					</v-btn>

					<v-btn @click="save()" class="success">
						保存
					</v-btn>
				</v-card-actions>
			</v-card>
		</v-dialog>


		<p class="ma-10">

<!-- 			<v-btn class="mr-5 mb-5" color="primary" @click="add()">
				<v-icon left small>add</v-icon>
				新增
			</v-btn>
 -->
			<v-btn class="mb-5" color="primary" @click="list(1)">
				<v-icon left small>refresh</v-icon>
				刷新
			</v-btn>

		</p>


		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="5"></pagination>


		<v-container>
			<v-row>
				<v-col cols="12">
					<v-simple-table>
						<thead>
							<tr>
								<th class="primary--text text-h6 text-center">id</th>
								<th class="primary--text text-h6 text-center">相对路径</th>
								<th class="primary--text text-h6 text-center">文件名</th>
								<th class="primary--text text-h6 text-center">后缀</th>
								<th class="primary--text text-h6 text-center">大小</th>
								<th class="primary--text text-h6 text-center">用途</th>
				<!-- 				<th class="primary--text  text-h6 text-center">
									操作
								</th> -->
							</tr>
						</thead>
						<tbody>
							<tr v-for="file in files" class="text-center">

								<td>{{file.id}}</td>
								<td>{{file.path}}</td>
								<td>{{file.name}}</td>
								<td>{{file.suffix}}</td>
								<td>{{file.size}}</td>
								<td>{{FILE_USE | optionKV(file.use)}}</td>
<!-- 
								<td>
									<v-row align="center" justify="space-around">
										<v-btn x-small fab @click="edit(file)" class="primary">
											<v-icon>edit</v-icon>
										</v-btn>

										<v-btn x-small fab @click="del(file.id)" class="warning">
											<v-icon>delete</v-icon>
										</v-btn>
									</v-row>
								</td> -->
							</tr>
						</tbody>
					</v-simple-table>
				</v-col>
			</v-row>
		</v-container>

	</v-app>
</template>

<script>
	import Pagination from "../../components/pagination.vue";
	export default {
		name: "file-file",
		components: {
			Pagination
		},

		data: function() {
			return {
				file: {},
				files: [],
				FILE_USE: FILE_USE_ARRAY,

				dialog: false,
			}
		},

		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);

		},

		methods: {
			// 获取所有小节的数据
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/file/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.files = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},
			/**
			 * 新增小节
			 */
			add() {
				let _this = this;
				_this.file = {};
				_this.dialog = true;
			},

			/**
			 * 编辑小节
			 */
			edit(file) {
				let _this = this;
				_this.file = $.extend({}, file);
				_this.dialog = true;
			},

			/**
			 * 保存
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.file.path, "相对路径") ||
					!Validator.length(_this.file.path, "相对路径", 1, 100) ||
					!Validator.length(_this.file.name, "文件名", 1, 100) ||
					!Validator.length(_this.file.suffix, "后缀", 1, 10)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/file/save', _this.file).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						_this.dialog = false,
							_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 删除小节
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除文件后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/file/admin/file/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			}
		}
	}
</script>

<style>
</style>

```



## 文件格式化

filter.js

```JS
/**
 * 数组过滤器 例如：{{SECTION_CHARGE | optionKV(section.charge)}}
 * @param object 例如：{CHARGE:{key:"C", value:"收费"},FREE:{key:"F", value:"免费"}}
 * @param key 例如：C
 * @returns {string} 例如：收费
 */
let optionKV = (object, key) =>  {
    if (!object || !key) {
        return "";
    } else {
        let result = "";
        for(let enums in object){
            if (key === object[enums]["key"]) {
                result = object[enums]["value"];
            }
        }
        return result;
    }
};
/**
 * 数组过滤器 例如：{{CHARGE | optionKVArray(section.charge)}}
 * @param list 例如：[{key:"C", value:"收费"},{key:"F", value:"免费"}]
 * @param key 例如：C
 * @returns {string} 例如：收费
 */
let optionKVArray = (list, key) =>  {
    if (!list || !key) {
        return "";
    } else {
        let result = "";
        for (let i = 0; i < list.length; i++) {
            if (key === list[i]["key"]) {
                result = list[i]["value"];
            }
        }
        return result;
    }
};



/**
 * 时长格式化
 * @param value 例如：36000
 * @returns {string} 例如：10:00:00
 */
let formatSecond = (value) => {
    value = value || 0;
    let second = parseInt(value, 10); // 秒
    let minute = 0; // 分
    let hour = 0; // 小时
    if (second > 60) {
        // 当大于60秒时，才需要做转换
        minute = Math.floor(second / 60);
        second = Math.floor(second % 60);
        if (minute > 60) {
            hour = Math.floor(minute / 60);
            minute = Math.floor(minute % 60);
        }
    } else {
        // 小于60秒时，直接显示，不需要处理
    }
    let result = "" + PrefixInteger(second, 2) + "";
    // 拼上分钟
    result = "" + PrefixInteger(minute, 2) + ":" + result;
    // 拼上小时
    result = "" + PrefixInteger(hour, 2) + ":" + result;
    return result;
};



/**
 * 格式化指定长度，前面补0
 */
function PrefixInteger(num, length) {
    return (Array(length).join('0') + num).slice(-length);
}

/**
 * 格式化文件大小
 * @param value
 * @returns {string}
 */
let formatFileSize = (value) => {
    value = value || 0;
    let result;
    if (value > 100 * 1024) {
        result = Math.round((value / 1024 / 1024) * 100) / 100 + "MB";
    } else {
        result = Math.round((value / 1024) * 100) / 100 + "KB";
    }
    return result;
};


/**
 * 控制长度
 */
function ellipsis(value) {
    if(!value) return '';
    if(value.length > 32) {
        return value.slice(0,32)+ '...';
    }
    return value;
}


export default {
    optionKV,
    formatSecond,
    ellipsis,
		formatFileSize
}
```





file.vue

​		<td>{{file.size | formatFileSize }}</td>



##  文件按用途分类保存

fileUseEnum

```java
package com.lzn.enums;

public enum FileUseEnum {

    COURSE("C", "课程"),
    TEACHER("T", "讲师");

    private String code;

    private String desc;

    FileUseEnum(String code, String desc) {
        this.code = code;
        this.desc = desc;
    }

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public void setDesc(String desc) {
        this.desc = desc;
    }

    public String getDesc() {
        return desc;
    }

    public static FileUseEnum getByCode(String code){
        for(FileUseEnum e: FileUseEnum.values()){
            if(code.equals(e.getCode())){
                return e;
            }
        }
        return  null;
    }
}

```





前端 component file.vue

```vue
<template>
	<div>

		<v-col cols="3">
			<v-btn v-on:click="selectFile()" class="warning">
				<!-- <v-icon>upload</v-icon> -->
					{{ text }}
			</v-btn>
		</v-col>
		
		<input ref="file" v-bind:id="inputId+'-input'" type="file" v-on:change="uploadFile()">
	<!-- 	 <v-file-input

				ref="file"
			  v-bind:id="inputId+'-input'" type="file" v-on:change="uploadFile()"
		  ></v-file-input> -->
	</div>
</template>

<script>
	export default {
		name: 'file',
		props: {
			text: {
				default: "上传文件"
			},
			inputId: {
				default: "file-upload"
			},
			suffixs: {
				default: []
			},
			use: {
				default: ""
			},
			afterUpload: {
				type: Function,
				default: null
			}
		},
		data: function() {
			return {

			};
		},
		methods: {

			uploadFile() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				let file = _this.$refs.file.files[0];
				// 判断文件格式
				let suffixs = _this.suffixs;
				let fileName = file.name;
				let suffix = fileName.substring(fileName.lastIndexOf(".") + 1, fileName.length).toLowerCase();

				let validateSuffix = false;
				for (let i = 0; i < suffixs.length; ++i) {
					if (suffixs[i].toLowerCase() === suffix) {
						validateSuffix = true;
						break;
					}
				}

				if (!validateSuffix) {
					Toast.warning("文件格式不正确,只支持上传:" + suffixs.join(","));
					$("#" + _this.inputId + "-input").val("");
					return;
				}

				formData.append('file', file);
				formData.append('use', _this.use);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.afterUpload(resp);
					
					// 清空，下次在选择同一个东西时候，也会触发
					$("#" + _this.intputId + "-input").val("");
					

				})
			},

			selectFile() {
				let _this = this;
        $("#" + _this.inputId + "-input").trigger("click");
			}
		}
	}
</script>

<style scoped>
   input {
		 /* 设计透明度 */
     opacity: 0;

    }
</style>

```







teacher.vue

```vue
<template>
	<v-app class="ma-3">


		<v-dialog persistent id="form-modal" max-width="500px" v-model="dialog">
			<v-card>
				<v-card-title class="font-weight-bold">
					教师表单
				</v-card-title>
				<v-card-text>


					<v-row>
						<v-col cols="6">
							<v-text-field label="姓名" v-model="teacher.name"></v-text-field>
						</v-col>

						<v-col cols="6">
							<v-text-field label="昵称" v-model="teacher.nickname"></v-text-field>
						</v-col>
					</v-row>

					<v-col cols="12">

						<file v-bind:text="'上传头像'" v-bind:after-upload="afterUpload" v-bind:suffixs="['jpg', 'jpeg', 'png']"
						 v-bind:use="FILE_USE.TEACHER.key"
							v-bind:input-id="'image-upload'" v-bind:label="'头像'"></file>

					</v-col>



					<!-- <div v-show="teacher.image"> -->
					<v-col cols="4">
						<v-img v-show="teacher.image" v-bind:src="teacher.image"></v-img>
						<v-img v-show="!teacher.image" src="/static/image/avatar.png"></v-img>
					</v-col>
					<!-- </div> -->


					<v-row>
						<v-col cols="6">
							<v-text-field label="职位" v-model="teacher.position"></v-text-field>
						</v-col>

						<v-col cols="6">
							<v-text-field label="座右铭" v-model="teacher.motto"></v-text-field>
						</v-col>

					</v-row>
					<v-col cols="12">
						<v-textarea outlined label="简介" v-model="teacher.intro"></v-textarea>
					</v-col>


				</v-card-text>

				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn @click="dialog = false" class="info">
						取消
					</v-btn>

					<v-btn @click="save()" class="success">
						确认
					</v-btn>
				</v-card-actions>
			</v-card>
		</v-dialog>

		<!-- 主要内容 -->
		<div class="display-1 grey--text">讲师管理</div>

		<p class="ma-10">
			<v-btn class="mr-5 mb-5" color="primary" @click="add()">
				<v-icon left small>edit</v-icon>
				新增
			</v-btn>

			<v-btn class="mb-5" color="primary" @click="list(1)">
				<v-icon left small>refresh</v-icon>
				刷新
			</v-btn>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="5"></pagination>


		<v-container>
			<v-row>
				<v-col sm="12" md="3" v-for="(teacher, i) in teachers" :key="i">
					<v-card>
						<v-img class="card-img" v-show="!teacher.image" src="/static/image/avatar.png" v-bind:title="teacher.intro">

						</v-img>

						<v-img class="card-img" v-show="teacher.image" :src="teacher.image" v-bind:title="teacher.intro">

						</v-img>

						<v-card-title align="center" class="font-weight-bold">
							<v-row>
								<v-col>
									{{ teacher.position }}
								</v-col>
							</v-row>
						</v-card-title>

						<v-card-text align="center">
							<v-icon color="primary">person</v-icon>

							<span class="font-weight-bold subtitle-1">{{ teacher.name }} </span>
							<span>【{{teacher.nickname}}】</span>
						</v-card-text>

						<v-card-actions>

							<v-spacer></v-spacer>
							<v-btn color="primary" @click="edit(teacher)">
								<v-icon>edit</v-icon>
								编辑
							</v-btn>
							<v-btn color="error" @click="del(teacher.id)">
								<v-icon>delete</v-icon>
								删除
							</v-btn>
							<v-spacer></v-spacer>
						</v-card-actions>
					</v-card>
				</v-col>
			</v-row>
		</v-container>

	</v-app>
</template>

<script>
	import Pagination from "../../components/pagination";
	import File from "../../components/file.vue";
	export default {
		name: 'business-teacher',

		components: {
			Pagination,
			File
		},

		data: function() {
			return {
				teacher: {},
				teachers: [],
				FILE_USE: FILE_USE,

				// 控制模态框
				dialog: false,
			}
		},

		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
		},

		methods: {
			/** 
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);
					Loading.hide();

				})
			},

			/**
			 * 修改教师
			 */

			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				_this.dialog = true;
			},

			/**
			 * 删除教师，By Id
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},


			/**
			 * 保存教师
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						_this.list(1);
						_this.dialog = false;
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},


			/**
			 * 新增教师
			 */
			add() {
				let _this = this;
				_this.teacher = {
					image: "/static/image/avatar.png",
				};
				_this.dialog = true;
			},


			/**
			 * 选择头像之后
			 */
			afterUpload(resp) {
				let _this = this;
				let image = resp.content;
				_this.teacher.image = image;
			}
		}

	}
</script>

<style scoped>
	/* 鼠标移到图片上变手  */
	.card-img {
		cursor: pointer;
	}
</style>

```





CONFIG

```
package com.lzn.file.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public  class SpringMvcConfig extends WebMvcConfigurationSupport {

    @Value("${file.path}")
    private String FILE_PATH;

    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
//        registry.addResourceHandler("/f/teacher/**")
//                .addResourceLocations("file:" + FILE_PATH+ "/teacher/");
//        registry.addResourceHandler("/f/teacher/**")
//                .addResourceLocations("file:" + FILE_PATH+ "/course/");
        registry.addResourceHandler("/f/**").addResourceLocations("file:" + FILE_PATH);
        super.addResourceHandlers(registry);
    }
}
```





uploadController 

```
package com.lzn.file.controller.admin;


import com.lzn.dto.FileDto;
import com.lzn.dto.ResponseDto;
import com.lzn.enums.FileUseEnum;
import com.lzn.service.FileService;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    @Value("${file.path}")
    private String FILE_PATH;
    @Value("${file.domain}")
    private String FILE_DOMAIN;

    @Autowired
    private FileService fileService;

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file,
            String use
            ) throws IOException {

        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        FileUseEnum useEnum = FileUseEnum.getByCode(use);

        String fileName=  file.getOriginalFilename();
        String suffix = fileName.substring(fileName.lastIndexOf(".") + 1).toLowerCase();
        String key = UuidUtil.getShortUuid();

        // 如果文件夹不存在则创建
        String dir = useEnum.name().toLowerCase();
        File fullDir = new File(FILE_PATH + dir);
        if( !fullDir.exists()){
            fullDir.mkdir();
        }

        String path  = dir +  File.separator + key + "." + suffix;

        String fullPath =FILE_PATH  + path;
        // 文件的路径应该是自动生成的
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        LOG.info("保存文件记录开始");
        FileDto fileDto = new FileDto();
        fileDto.setPath(path);
        fileDto.setName(fileName);
        fileDto.setSize(Math.toIntExact(file.getSize()));
        fileDto.setSuffix(suffix);
        fileDto.setUse(use);


        fileService.save(fileDto);


        ResponseDto responseDto = new ResponseDto();
        responseDto.setContent(FILE_DOMAIN + path);
        return responseDto;
    }
}
```







# 文件上传组件的使用

## 文件上传成功后返回值的处理

```
package com.lzn.file.controller.admin;


import com.lzn.dto.FileDto;
import com.lzn.dto.ResponseDto;
import com.lzn.enums.FileUseEnum;
import com.lzn.service.FileService;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    @Value("${file.path}")
    private String FILE_PATH;
    @Value("${file.domain}")
    private String FILE_DOMAIN;

    @Autowired
    private FileService fileService;

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file,
            String use
            ) throws IOException {

        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        FileUseEnum useEnum = FileUseEnum.getByCode(use);

        String fileName=  file.getOriginalFilename();
        String suffix = fileName.substring(fileName.lastIndexOf(".") + 1).toLowerCase();
        String key = UuidUtil.getShortUuid();

        // 如果文件夹不存在则创建
        String dir = useEnum.name().toLowerCase();
        File fullDir = new File(FILE_PATH + dir);
        if( !fullDir.exists()){
            fullDir.mkdir();
        }

        String path  = dir +  File.separator + key + "." + suffix;

        String fullPath =FILE_PATH  + path;
        // 文件的路径应该是自动生成的
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        LOG.info("保存文件记录开始");
        FileDto fileDto = new FileDto();
        fileDto.setPath(path);
        fileDto.setName(fileName);
        fileDto.setSize(Math.toIntExact(file.getSize()));
        fileDto.setSuffix(suffix);
        fileDto.setUse(use);


        fileService.save(fileDto);

        ResponseDto responseDto = new ResponseDto();
        fileDto.setPath(FILE_DOMAIN + path);
        responseDto.setContent(fileDto);
        return responseDto;
    }
}
```







teacher.vue

			/**
			 * 选择头像之后
			 */
			afterUpload(resp) {
				let _this = this;
				let image = resp.content.path;
				_this.teacher.image = image;
			}




## 课程管理和小节管理使用文件组件



课程封面选择

course.vue

```vue
<!-- 课程管理页面 -->

<!-- 

treeview 参考链接：
vuetify和ztree在树形结构数据上有很大不同，因此需要前端重构
 https://www.codetd.com/en/article/8602247
 https://blog.csdn.net/gaogzhen/article/details/103980548
 
 
 step1: 先要实现读取后端的课程分类信息 并且全部展示 出来
 step2: 勾选上课程，能及时反馈勾选课程的id
 step3: 也是treeview本身没有的功能，就是如果在编辑功能下，应该要展示已经选择的数据
 -->
<template>

	<v-app class="ma-3">
		<!-- 课程修改 新增 模态框 -->
		<v-dialog v-model="dialogCourse"  persistent id="course-detail" max-width="1000px" height="1000px">

			<v-card>
				<v-card-title class="font-weight-bold">
					课程详情表单
				</v-card-title>
				<!-- 重点 树状 -->

				<v-card-text>
					<div class="black--text">分类</div>
					<v-col cols="10">
						<template>
							<v-treeview selectable :items="items" v-model="selection" return-object></v-treeview>
						</template>
					</v-col>

				</v-card-text>

				<v-card-text>
					<v-row>
						<v-col cols="4">
							<v-text-field label="名称" v-model="course.name"></v-text-field>
						</v-col>

						<v-col cols="4">
							<v-select label="讲师" v-model="course.teacherId" :items="teachers" item-text="name" item-value="id"></v-select>
						</v-col>
						<v-col cols="4">
							<v-text-field label="时长" v-model="course.time"></v-text-field>
						</v-col>
					</v-row>
				</v-card-text>

				<v-card-text>
					<v-row>
						<v-col cols="4">
							<!-- vuetify key value  -->
							<v-select label="级别" v-model="course.level" :items="COURSE_LEVEL" item-text="value" item-value="key"></v-select>
						</v-col>

						<v-col cols="4">
							<v-select label="收费" v-model="course.charge" :items="COURSE_CHARGE" item-text="value" item-value="key"></v-select>
						</v-col>

						<v-col cols="4">
							<v-select label="状态" v-model="course.status" :items="COURSE_STATUS" item-text="value" item-value="key"></v-select>
						</v-col>
					</v-row>
				</v-card-text>

	<!-- 			<v-card-text>
					<v-col cols="12">
						<v-text-field label="封面" v-model="course.image"></v-text-field>
					</v-col>
				</v-card-text>
 -->
				<v-card-text>
					<v-col cols="12">
					
						<file 
						v-bind:text="'上传封面'" 		      		
						v-bind:after-upload="afterUpload" 
						v-bind:suffixs="['jpg', 'jpeg', 'png']"
						v-bind:use="FILE_USE.COURSE.key"
						v-bind:input-id="'image-upload'" v-bind:label="'封面'"></file>
					
					</v-col>
					
					
					<v-col cols="4">
						<v-img v-show="course.image" v-bind:src="course.image"></v-img>
						<v-img v-show="!course.image" src="/static/image/demo-course.jpg"></v-img>
					</v-col>
					
					
				</v-card-text>


				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn class="primary" @click="dialogCourse = false">
						取消
					</v-btn>

					<v-btn class="success" @click="save()">
						保存
					</v-btn>
				</v-card-actions>

			</v-card>
		</v-dialog>

		<!-- 课程内容模态框 -->
		<v-dialog v-model="dialogContent" persistent id="dialog-content">
			<v-card>
				<v-card-title class="font-weight-bold">
					课程内容修改
				</v-card-title>


				<v-card-text>
					<v-col cols="12">
						{{ saveContentLabel }}
					</v-col>
				</v-card-text>

				<v-card-text dark>
					<!-- <v-col cols="12"> -->
					<div id="content"></div>
					<!-- </v-col> -->
				</v-card-text>

				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn @click="dialogContent = false" class="primary">
						取消
					</v-btn>

					<v-btn @click="saveContent()" class="success">
						保存
					</v-btn>

					<v-btn class="info" id="close-content">
						关闭
					</v-btn>
				</v-card-actions>
			</v-card>
		</v-dialog>

		<!-- 课程排序模态框 -->
		<v-dialog v-model="dialogSort" persistent max-width="300px">
			<v-card>
				<v-card-title class="font-weight-bold">
					课程排序修改
				</v-card-title>

				<v-card-text>
					<v-container>
						<v-col cols="12">
							<v-text-field label="当前排序" v-model="sort.oldSort" disabled></v-text-field>
						</v-col>
						<v-col cols="12">
							<v-text-field label="新排序" v-model="sort.newSort" required></v-text-field>
						</v-col>
					</v-container>
				</v-card-text>


				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn @click="dialogSort = false" class="primary">
						取消
					</v-btn>

					<v-btn @click="updateSort()" class="success">
						更新排序
					</v-btn>
				</v-card-actions>
			</v-card>
		</v-dialog>


		<!-- 主要内容 -->
		<div class="display-1 grey--text">课程管理</div>


		<p class="ma-10">
			<v-btn class="mr-5 mb-5" color="primary" @click="add()">
				<v-icon left small>add</v-icon>
				新增
			</v-btn>

			<v-btn class="mb-5" color="primary" @click="list(1)">
				<v-icon left small>refresh</v-icon>
				刷新
			</v-btn>
		</p>



		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="5"></pagination>

		<v-container>
			<v-row>
				<v-col sm="12" md="4" v-for="(course, i) in courses" :key="i">
					<v-card>
						<v-img class="card-img" v-show="!course.image" src="/static/image/demo-course.jpg">

						</v-img>

						<v-img class="card-img" v-show="course.image" :src="course.image">

						</v-img>



						<v-card-title class="font-weight-bold indigo--text text--darken-3 text-h4">

							{{ course.name  }}

						</v-card-title>

						<v-card-text>
							<div v-for="teacher in teachers.filter(t=>{return t.id===course.teacherId})">
								<v-list two-line class="teacher-card">
									<v-list-item>
										<v-avatar class="mr-7">
											<img v-show="!teacher.image" src="/static/image/avatar.png" />
											<img v-show="teacher.image" v-bind:src="teacher.image" />
										</v-avatar>
										<v-list-item-content>
											<v-list-item-title>{{ teacher.name }}</v-list-item-title>
											<v-list-item-subtitle>{{ teacher.position }}</v-list-item-subtitle>
										</v-list-item-content>
									</v-list-item>
								</v-list>
							</div>
						</v-card-text>
						<v-divider></v-divider>
						<!-- 发布 收费 初级  -->
						<v-card-text>

							<v-chip class="ma-2" color="indigo" text-color="white"> {{COURSE_LEVEL | optionKV(course.level)}}</v-chip>

							<v-chip class="ma-2" color="orange" text-color="white"> {{COURSE_CHARGE | optionKV(course.charge)}}</v-chip>

							<v-chip class="ma-2" color="green" text-color="white"> {{COURSE_STATUS | optionKV(course.status) }}</v-chip>

							<v-chip class="ma-2" color="indigo" text-color="white">ID:{{ course.id }}</v-chip>

							<v-chip class="ma-2" color="orange" text-color="white"> 排序:{{ course.sort }}</v-chip>

							<v-chip class="ma-2" color="green" text-color="white">时长:{{ course.time | formatSecond }}</v-chip>

						</v-card-text>



						<!-- 课程价格 -->
						<!-- d-flex 作用可以让图标和价格在x轴方向居中 -->
						<v-card-text class="ml-3 text-h5 indigo--text text--darken-3 font-weight-bold d-flex">
							<v-icon left color="indigo darken-3">fas fa-yen-sign</v-icon>
							{{ course.price }}
						</v-card-text>

						<!-- 课程简介 -->
						<v-card-text class="text-subtitle-1 ml-3">
							{{ course.summary }}
						</v-card-text>
						<v-divider></v-divider>

						<v-card-actions>
							<v-col cols="12" class="d-flex align-center justify-space-around

">

								<v-btn small class="success" @click="toChapter(course)">
									大章
								</v-btn>

								<v-btn small class="primary" @click="editContent(course)">

									内容
								</v-btn>

								<v-btn small class="accent darken-2" @click="openSortModal(course)">

									排序
								</v-btn>

								<v-btn small class="info" @click="edit(course)">

									编辑
								</v-btn>

								<v-btn small class="error" @click="del(course.id)">
									删除
								</v-btn>

							</v-col>
						</v-card-actions>
					</v-card>

				</v-col>
			</v-row>
		</v-container>
	</v-app>
</template>

<script>
	import Pagination from "../../components/pagination";
	import File from "../../components/file.vue"
	export default {

		updated() {
			$('#course-detail').scroll(0, 0);
		},


		components: {
			Pagination,
			File
		},

		name: 'business-course',

		data: function() {
			return {
				// treeview try demo
				selection: [], // 表示已经选择的数据
				
				FILE_USE: FILE_USE,



				saveContentInterval: {},

				// 排序模态框
				dialogSort: false,
				// 内容编辑模态框
				dialogContent: false,

				// 课程修改 新增
				dialogCourse: false,

				saveContentLabel: "",

				course: {},
				courses: [],
				COURSE_LEVEL: COURSE_LEVEL_ARRAY,
				COURSE_CHARGE: COURSE_CHARGE_ARRAY,
				COURSE_STATUS: COURSE_STATUS_ARRAY,
				categorys: [],

				categoryList: [],

				teachers: [],




				sort: {
					id: "",
					oldSort: 0,
					newSort: 0,
				},

				tree: [],

				items: [],
			}
		},


		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			// 获取所有分类
			_this.allCategory();
			// 获取所有的老师
			_this.allTeachers();
			// 分页展示
			_this.list(1);
		},

		watch: {

			selection: {

				deep: true,

				handler() {

					// changedIndex 就是发生改变的位置
					console.log(this.selection.length);
				}

			}

		},
		methods: {

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax
					.post(process.env.VUE_APP_SERVER + "/business/admin/course/list", {
						page: page,
						size: _this.$refs.pagination.size,
					})
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						_this.courses = resp.content.list;
						_this.$refs.pagination.render(page, resp.content.total);
					});
			},


			/**
			 * 获取所有老师
			 */
			allTeachers() {
				let _this = this;
				Loading.show();
				_this.$ajax
					.post(process.env.VUE_APP_SERVER + "/business/admin/teacher/all")
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						_this.teachers = resp.content;
						console.log(_this.teachers);
					});
			},

			/**
			 * 获取所有分类
			 */
			allCategory() {
				let _this = this;
				Loading.show();
				_this.$ajax
					.post(process.env.VUE_APP_SERVER + "/business/admin/category/all")
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						_this.categorys = resp.content;

						_this.initTree();
					});
			},

			initTree() {
				// 首先展示出所有的分类数据
				let _this = this;
				_this.items = [];
				let i = 0;
				for (i = 0; i < _this.categorys.length; ++i) {
					if (_this.categorys[i].parent === "00000000") {
						_this.categorys[i].children = [];
						_this.items.push(_this.categorys[i]);
					}
				}
				for (i = 0; i < _this.categorys.length; ++i) {
					if (_this.categorys[i].parent !== "00000000") {
						let index = _this.items.findIndex((data) => data.id === _this.categorys[i].parent);
						_this.items[_this.items.findIndex((data) => data.id === _this.categorys[i].parent)].children.push(_this.categorys[
							i]);
					}
				}
			},


			/**
			 * 打开修改排序的模态框
			 */
			openSortModal(course) {
				let _this = this;
				_this.sort = {
					id: course.id,
					oldSort: course.sort,
					newSort: course.sort
				};

				_this.dialogSort = true;
			},



			/**
			 * 排序
			 */
			updateSort() {
				let _this = this;
				if (_this.sort.newSort === _this.sort.oldSort) {
					Toast.warning("排序没有变化");
					return;
				}
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + "/business/admin/course/sort", _this.sort).then((res) => {
					let response = res.data;

					if (response.success) {
						Toast.success("更新排序成功");
						_this.dialogSort = false;
						_this.list(1);
					} else {
						Toast.error("更新排序失败");
					}
				});
			},

			/**
			 * 打开内容编辑器
			 */
			/**
			 * 点击【编辑】
			 */
			edit(course) {
				let _this = this;
				_this.course = $.extend({}, course);
				_this.listCategory(course.id);
				_this.dialogCourse = true;
			},

			/**
			 * 查找课程下所有分类
			 * @param courseId
			 */
			listCategory(courseId) {
				let _this = this;
				Loading.show();
				_this.$ajax
					.post(
						process.env.VUE_APP_SERVER +
						"/business/admin/course/list-category/" +
						courseId
					)
					.then((res) => {

						let response = res.data;
						let categorys = response.content;


						_this.selection = [];
						for (let i = 0; i < categorys.length; ++i) {
							for (let j = 0; j < _this.items.length; ++j) {

								let k = _this.items[j].children.findIndex((data) => data.id === categorys[i].categoryId);
								_this.selection.push(_this.items[j].children[k]);

							}

						}

						Loading.hide();


					});


			},

			/**
			 * 打开内容编辑器
			 */
			editContent(course) {

				let _this = this;
				_this.dialogContent = true;
				let id = course.id;
				_this.course = course;


				$("#content").summernote({
					focus: true,
					height: 300
				});

				// 先清空历史文本
				$("#content").summernote("code", "");
				_this.saveContentLabel = "";

				Loading.show();

				_this.$ajax
					.get(
						process.env.VUE_APP_SERVER +
						"/business/admin/course/find-content/" +
						id
					)
					.then((response) => {
						Loading.hide();
						let resp = response.data;

						if (resp.success) {

							if (resp.content) {
								$("#content").summernote("code", resp.content.content);
							}

							// 定时自动保存
							let saveContentInterval = setInterval(function() {
								_this.saveContent();
							}, 5000);

							// 关闭内容框时，清空自动保存任务
							$('#close-content').on("click", function(e) {
								clearInterval(saveContentInterval);
								_this.dialogContent = false;
							});
						} else {
							Toast.warning(resp.message);
						}
					});
			},


			/**
			 * 保存内容
			 */
			saveContent() {
				let _this = this;
				let content = $("#content").summernote("code");
				Loading.show();
				_this.$ajax
					.post(
						process.env.VUE_APP_SERVER + "/business/admin/course/save-content", {
							id: _this.course.id,
							content: content,
						}
					)
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							// Toast.success("内容保存成功");
							let now = Tool.dateFormat("hh:mm:ss");
							_this.saveContentLabel = "最后保存的时间: " + now;
						} else {
							Toast.warning(resp.message);
						}
					});
			},

			/**
			 * 保存课程
			 */
			save() {
				let _this = this;
				// 保存校验
				if (
					1 != 1 ||
					!Validator.require(_this.course.name, "名称") ||
					!Validator.length(_this.course.name, "名称", 1, 50) ||
					!Validator.length(_this.course.summary, "概述", 1, 2000) ||
					!Validator.length(_this.course.image, "封面", 1, 100)
				) {
					return;
				}

				_this.course.categorys = _this.selection;

				if (_this.course.categorys.length == 0) {
					Toast.warning("请选择分类!");
					return ;
				}

				Loading.show();
				_this.$ajax
					.post(
						process.env.VUE_APP_SERVER + "/business/admin/course/save",
						_this.course
					)
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.dialogCourse = false;
							_this.list(1);
							Toast.success("保存成功！");
							_this.section = []; // 清空已经选择的
						} else {
							Toast.warning(resp.message);
						}
					});
			},


			/**
			 * 去大章
			 */
			toChapter(course) {
				let _this = this;
				SessionStorage.set(SESSION_KEY_COURSE, course);
				_this.$router.push("/business/chapter");
			},

			/**
			 * 新增课程
			 */
			/**
			 * ,点击【新增】
			 */
			add() {
				let _this = this;
				_this.course = {

					// 也可以初始化更多的枚举字段，收费、初级、草稿
					level: "1",
					status: "P",
					charge: "C",
					sort: _this.$refs.pagination.total + 1
				};
				// 新增的时候，让所有的节点都不选中
				_this.selection = [];
				_this.dialogCourse = true;
			},

			/**
			 * 删除课程
			 */

			del(id) {
				let _this = this;
				Confirm.show("删除课程后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax
						.delete(
							process.env.VUE_APP_SERVER + "/business/admin/course/delete/" + id
						)
						.then((response) => {
							Loading.hide();
							let resp = response.data;
							if (resp.success) {
								_this.list(1);
								Toast.success("删除成功！");
							}
						});
				});
			},
			
			
			/**
			 * 选择封面之后
			 */
			afterUpload(resp) {
				let _this = this;
				let image = resp.content.path;
				_this.course.image = image;
			}
			

		},



	};
</script>

<style scoped>
	.teacher-card {
		cursor: pointer;
	}

	.teacher-card:hover {
		background-color: lightgrey;
	}
</style>

```





小节视频选择

section.vue

```vue
<!-- 小节页面 -->
<template>
	<v-app class="ma-3" app>
		<!-- 主要内容 -->
		<div class="display-1 grey--text">
			{{ course.name }}
			<v-icon>keyboard_arrow_right</v-icon>
			<span class="text-h5 grey--text"> {{ chapter.name }}</span>
		</div>


		<v-dialog v-model="dialogSection" persistent max-width="1000">
			<v-card>
				<v-card-title>
					小节表单
				</v-card-title>

				<v-card-text>
					<v-row>
						<v-col cols="6">
							<v-text-field label="课程名称" :value="course.name" disabled=""></v-text-field>
						</v-col>
						<v-col cols="6">
							<v-text-field label="大章名称" :value="chapter.name" disabled></v-text-field>
						</v-col>

						<v-col cols="6">
							<v-text-field label="标题" v-model="section.title" required></v-text-field>
						</v-col>

						<v-col cols="6">
							<v-select label="收费" v-model="section.charge" :items="SECTION_CHARGE" item-text="value" item-value="key"></v-select>
						</v-col>

						<v-col cols="6">
							<v-text-field label="时长" v-model="section.time" required></v-text-field>
						</v-col>
						<v-col cols="6">
							<v-text-field label="顺序" v-model="section.sort" required></v-text-field>
						</v-col>

						<v-col cols="12">
							<!-- <v-text-field label="视频" v-model="section.video" required></v-text-field> -->
							<file v-bind:text="'上传视频'" v-bind:afterUpload="afterUpload" v-bind:use="FILE_USE.COURSE.key" v-bind:suffixs="['mp4']"
							>

							</file>
						</v-col>

					</v-row>
					
					<v-row class="d-flex justify-center">
						<v-col cols="4">
							<video v-bind:src="section.video" controls="controls">
								
							</video>
						</v-col>
						
					</v-row>
				</v-card-text>

				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn @click="dialogSection = false" clas="info">
						取消
					</v-btn>

					<v-btn @click="save()" class="success">
						保存
					</v-btn>
				</v-card-actions>
			</v-card>
		</v-dialog>


		<p class="ma-10">

			<v-btn to="/business/course" class="mr-5 mb-5" color="primary">
				返回课程
			</v-btn>

			<v-btn to="/business/chapter" class="mr-5 mb-5" color="primary">
				返回大章
			</v-btn>

			<v-btn class="mr-5 mb-5" color="primary" @click="add()">
				<v-icon left small>add</v-icon>
				新增
			</v-btn>

			<v-btn class="mb-5" color="primary" @click="list(1)">
				<v-icon left small>refresh</v-icon>
				刷新
			</v-btn>

		</p>


		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="5"></pagination>


		<v-container>
			<v-row>
				<v-col cols="12">
					<v-simple-table>
						<thead>
							<tr>
								<th class="primary--text text-h6 text-center">
									ID
								</th>
								<th class="primary--text  text-h6 text-center">
									标题
								</th>
								<th class="primary--text  text-h6 text-center">
									视频
								</th>
								<th class="primary--text  text-h6 text-center">
									时长
								</th>
								<th class="primary--text  text-h6 text-center">
									收费
								</th>
								<th class="primary--text  text-h6 text-center">
									顺序
								</th>
								<th class="primary--text  text-h6 text-center">
									操作
								</th>
							</tr>
						</thead>
						<tbody>
							<tr v-for="section in sections" class="text-center">
								<td class="text-center">
									{{ section.id}}
								</td>

								<td class="text-center">
									{{ section.title }}
								</td>

								<td>
									{{ section.video }}
								</td>

								<td>
									{{ section.time | formatSecond }}
								</td>

								<td>
									{{ SECTION_CHARGE | optionKV(section.charge) }}
								</td>

								<td>
									{{ section.sort }}
								</td>

								<td>
									<v-row align="center" justify="space-around">
										<v-btn x-small fab @click="edit(section)" class="primary">
											<v-icon>edit</v-icon>
										</v-btn>

										<v-btn x-small fab @click="del(section.id)" class="warning">
											<v-icon>delete</v-icon>
										</v-btn>
									</v-row>
								</td>
							</tr>
						</tbody>
					</v-simple-table>
				</v-col>
			</v-row>
		</v-container>

	</v-app>
</template>

<script>
	import Pagination from "../../components/pagination.vue";
	import File from "../../components/file.vue"
	export default {

		components: {
			Pagination,
			File
		},

		data: function() {
			return {
				section: {},
				sections: [],
				chapter: {},
				course: {},
				SECTION_CHARGE: SECTION_CHARGE_ARRAY,
				
				FILE_USE: FILE_USE,

				dialogSection: false,
			}
		},

		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			let course = SessionStorage.get(SESSION_KEY_COURSE) || {};
			let chapter = SessionStorage.get(SESSION_KEY_CHAPTER) || {};
			if (Tool.isEmpty(course) || Tool.isEmpty(chapter)) {
				_this.$router.push("/welcome");
			}
			_this.course = course;
			_this.chapter = chapter;
			_this.list(1);
		},

		methods: {
			// 获取所有小节的数据
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax
					.post(process.env.VUE_APP_SERVER + "/business/admin/section/list", {
						page: page,
						//  跟组子组件获取  size应该有一个默认的参数
						size: _this.$refs.pagination.size,
						courseId: _this.course.id,
						chapterId: _this.chapter.id
					})
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						_this.sections = resp.content.list;
						_this.$refs.pagination.render(page, resp.content.total);
					});
			},

			/**
			 * 新增小节
			 */
			add() {
				let _this = this;
				_this.dialogSection = true;
			},

			/**
			 * 编辑小节
			 */
			edit(section) {
				let _this = this;
				_this.section = $.extend({}, section);
				_this.dialogSection = true;
			},

			/**
			 * 保存
			 */
			save() {
				let _this = this;
				// 保存校验
				if (
					1 != 1 ||
					!Validator.require(_this.section.title, "标题") ||
					!Validator.length(_this.section.title, "标题", 1, 50) ||
					!Validator.length(_this.section.video, "视频", 1, 200)
				) {
					return;
				}

				_this.section.courseId = _this.course.id;
				_this.section.chapterId = _this.chapter.id;

				Loading.show();
				_this.$ajax
					.post(
						process.env.VUE_APP_SERVER + "/business/admin/section/save",
						_this.section
					)
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							// 关闭模态框
							_this.dialogSection = false;
							_this.list(1);
							Toast.success("保存成功");
						} else {
							Toast.warning(resp.message);
						}
					});
			},

			/**
			 * 删除小节
			 */
			del(id) {
				let _this = this;

				Confirm.show("删除小节后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax
						.delete(
							process.env.VUE_APP_SERVER + "/business/admin/section/delete/" + id
						)
						.then((response) => {
							Loading.hide();
							let resp = response.data;
							if (resp.success) {
								_this.list(1);
								Toast.success("删除成功！");
							}
						});
				});
			},

			/**
			 * 选择小节视频之后
			 */
			afterUpload(resp) {
				let _this = this;
				let video = resp.content.path;
				_this.section.video = video;
			}

		}
	}
</script>

<style scoped>
	video {
		width: 100%;
	}
</style>

```



springboot 对文件大小有限制



: the request was rejected because its size (106824413) exceeds the configured maximum (10485760)



max-file-size: 单个文件的大小

max-request-size 请求的大小



file 属性配置

```
# 系统名称
spring.application.name=file
# 系统路径
server.servlet.context-path=/file
# 系统端口
server.port=9003
# 注册中心
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
# 文件配置
file.path=D:/code/file/
file.domain=http://127.0.0.1:9000/file/f/


spring.servlet.multipart.max-file-size=500MB
spring.servlet.multipart.max-request-size=500MB
```







## 自动获取视频时长

section.vue

```vue
<!-- 小节页面 -->
<template>
	<v-app class="ma-3" app>
		<!-- 主要内容 -->
		<div class="display-1 grey--text">
			{{ course.name }}
			<v-icon>keyboard_arrow_right</v-icon>
			<span class="text-h5 grey--text"> {{ chapter.name }}</span>
		</div>


		<v-dialog v-model="dialogSection" persistent max-width="1000">
			<v-card>
				<v-card-title>
					小节表单
				</v-card-title>

				<v-card-text>
					<v-row>
						<v-col cols="6">
							<v-text-field label="课程名称" :value="course.name" disabled=""></v-text-field>
						</v-col>
						<v-col cols="6">
							<v-text-field label="大章名称" :value="chapter.name" disabled></v-text-field>
						</v-col>

						<v-col cols="6">
							<v-text-field label="标题" v-model="section.title" required></v-text-field>
						</v-col>

						<v-col cols="6">
							<v-select label="收费" v-model="section.charge" :items="SECTION_CHARGE" item-text="value" item-value="key"></v-select>
						</v-col>

						<v-col cols="6">
							<v-text-field label="时长" v-model="section.time" required></v-text-field>
						</v-col>
						<v-col cols="6">
							<v-text-field label="顺序" v-model="section.sort" required></v-text-field>
						</v-col>

						<v-col cols="12">
							<!-- <v-text-field label="视频" v-model="section.video" required></v-text-field> -->
							<file v-bind:text="'上传视频'" v-bind:afterUpload="afterUpload" v-bind:use="FILE_USE.COURSE.key" v-bind:suffixs="['mp4']"
							>

							</file>
						</v-col>

					</v-row>
					
					<v-row class="d-flex justify-center">
						<v-col cols="4">
							<video v-bind:src="section.video" controls="controls" id="video">
								
							</video>
						</v-col>
						
					</v-row>
				</v-card-text>

				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn @click="dialogSection = false" clas="info">
						取消
					</v-btn>

					<v-btn @click="save()" class="success">
						保存
					</v-btn>
				</v-card-actions>
			</v-card>
		</v-dialog>


		<p class="ma-10">

			<v-btn to="/business/course" class="mr-5 mb-5" color="primary">
				返回课程
			</v-btn>

			<v-btn to="/business/chapter" class="mr-5 mb-5" color="primary">
				返回大章
			</v-btn>

			<v-btn class="mr-5 mb-5" color="primary" @click="add()">
				<v-icon left small>add</v-icon>
				新增
			</v-btn>

			<v-btn class="mb-5" color="primary" @click="list(1)">
				<v-icon left small>refresh</v-icon>
				刷新
			</v-btn>

		</p>


		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="5"></pagination>


		<v-container>
			<v-row>
				<v-col cols="12">
					<v-simple-table>
						<thead>
							<tr>
								<th class="primary--text text-h6 text-center">
									ID
								</th>
								<th class="primary--text  text-h6 text-center">
									标题
								</th>
								<th class="primary--text  text-h6 text-center">
									视频
								</th>
								<th class="primary--text  text-h6 text-center">
									时长
								</th>
								<th class="primary--text  text-h6 text-center">
									收费
								</th>
								<th class="primary--text  text-h6 text-center">
									顺序
								</th>
								<th class="primary--text  text-h6 text-center">
									操作
								</th>
							</tr>
						</thead>
						<tbody>
							<tr v-for="section in sections" class="text-center">
								<td class="text-center">
									{{ section.id}}
								</td>

								<td class="text-center">
									{{ section.title }}
								</td>

								<td>
									{{ section.video }}
								</td>

								<td>
									{{ section.time | formatSecond }}
								</td>

								<td>
									{{ SECTION_CHARGE | optionKV(section.charge) }}
								</td>

								<td>
									{{ section.sort }}
								</td>

								<td>
									<v-row align="center" justify="space-around">
										<v-btn x-small fab @click="edit(section)" class="primary">
											<v-icon>edit</v-icon>
										</v-btn>

										<v-btn x-small fab @click="del(section.id)" class="warning">
											<v-icon>delete</v-icon>
										</v-btn>
									</v-row>
								</td>
							</tr>
						</tbody>
					</v-simple-table>
				</v-col>
			</v-row>
		</v-container>

	</v-app>
</template>

<script>
	import Pagination from "../../components/pagination.vue";
	import File from "../../components/file.vue"
	export default {

		components: {
			Pagination,
			File
		},

		data: function() {
			return {
				section: {},
				sections: [],
				chapter: {},
				course: {},
				SECTION_CHARGE: SECTION_CHARGE_ARRAY,
				
				FILE_USE: FILE_USE,

				dialogSection: false,
			}
		},

		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			let course = SessionStorage.get(SESSION_KEY_COURSE) || {};
			let chapter = SessionStorage.get(SESSION_KEY_CHAPTER) || {};
			if (Tool.isEmpty(course) || Tool.isEmpty(chapter)) {
				_this.$router.push("/welcome");
			}
			_this.course = course;
			_this.chapter = chapter;
			_this.list(1);
		},

		methods: {
			// 获取所有小节的数据
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax
					.post(process.env.VUE_APP_SERVER + "/business/admin/section/list", {
						page: page,
						//  跟组子组件获取  size应该有一个默认的参数
						size: _this.$refs.pagination.size,
						courseId: _this.course.id,
						chapterId: _this.chapter.id
					})
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						_this.sections = resp.content.list;
						_this.$refs.pagination.render(page, resp.content.total);
					});
			},

			/**
			 * 新增小节
			 */
			add() {
				let _this = this;
				_this.dialogSection = true;
			},

			/**
			 * 编辑小节
			 */
			edit(section) {
				let _this = this;
				_this.section = $.extend({}, section);
				_this.dialogSection = true;
			},

			/**
			 * 保存
			 */
			save() {
				let _this = this;
				// 保存校验
				if (
					1 != 1 ||
					!Validator.require(_this.section.title, "标题") ||
					!Validator.length(_this.section.title, "标题", 1, 50) ||
					!Validator.length(_this.section.video, "视频", 1, 200)
				) {
					return;
				}

				_this.section.courseId = _this.course.id;
				_this.section.chapterId = _this.chapter.id;

				Loading.show();
				_this.$ajax
					.post(
						process.env.VUE_APP_SERVER + "/business/admin/section/save",
						_this.section
					)
					.then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							// 关闭模态框
							_this.dialogSection = false;
							_this.list(1);
							Toast.success("保存成功");
						} else {
							Toast.warning(resp.message);
						}
					});
			},

			/**
			 * 删除小节
			 */
			del(id) {
				let _this = this;

				Confirm.show("删除小节后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax
						.delete(
							process.env.VUE_APP_SERVER + "/business/admin/section/delete/" + id
						)
						.then((response) => {
							Loading.hide();
							let resp = response.data;
							if (resp.success) {
								_this.list(1);
								Toast.success("删除成功！");
							}
						});
				});
			},

			/**
			 * 选择小节视频之后
			 */
			afterUpload(resp) {
				let _this = this;
				let video = resp.content.path;
				_this.section.video = video;
				_this.getTime();
			},
			
			/**
			 * 获取时长
			 */
			getTime() {
				let _this = this;
				let ele = document.getElementById("video");
				_this.section.time = parseInt(ele.duration, 10);
			}

		}
	}
</script>

<style scoped>
	video {
		width: 100%;
	}
</style>

```









# 课程内容富文本编辑里面使用文件组件

新增课程内容文件表，用于管理当前这篇内容用到的文件，支持新增 删除，上传文件后自动新增一条记录


---
typora-root-url: /images
---

# 文件上传功能开发

# 完成基本的文件上传功能

## 搭建单独文件模块file

com.lzn.file.config

启动类

```
package com.lzn.file.config;


import org.mybatis.spring.annotation.MapperScan;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.core.env.Environment;

@SpringBootApplication
@EnableEurekaClient // 注册到注册中心
@MapperScan("com.lzn.mapper")
@ComponentScan("com.lzn")
public class FileApplication {
    private static final Logger LOG = LoggerFactory.getLogger(FileApplication.class);

    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(FileApplication.class);
        Environment environment = app.run(args).getEnvironment();
        LOG.info("启动成功！！");
        LOG.info("File地址: \thttp://127.0.0.1:{}", environment.getProperty("server.port"));
    }
}

```

file pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>course</artifactId>
        <groupId>com.lzn</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>file</artifactId>
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- 集成mybatis -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>

        <dependency>
            <groupId>com.lzn</groupId>
            <artifactId>server</artifactId>
        </dependency>
        <dependency>
            <groupId>com.lzn</groupId>
            <artifactId>server</artifactId>
        </dependency>


    </dependencies>


</project>
```

复制system resource 下面的两个文件到file模块里

```
# 系统名称
spring.application.name=file
# 系统路径
server.servlet.context-path=/file
# 系统端口
server.port=9003
# 注册中心
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
```





修改logback.xml中的路径





修改gateway 配置文件

```
# 应用名字
spring.application.name=gateway
# 启动端口
server.port=9000
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# 路由转发配置
spring.cloud.gateway.routes[0].id=system
spring.cloud.gateway.routes[0].uri=http://127.0.0.1:9001
spring.cloud.gateway.routes[0].predicates[0].name=Path
spring.cloud.gateway.routes[0].predicates[0].args[0]=/system/**


spring.cloud.gateway.routes[1].id=business
#spring.cloud.gateway.routes[1].uri=http://127.0.0.1:9002
spring.cloud.gateway.routes[1].uri=lb://business
spring.cloud.gateway.routes[1].predicates[0].name=Path
spring.cloud.gateway.routes[1].predicates[0].args[0]=/business/**

spring.cloud.gateway.routes[2].id=file
spring.cloud.gateway.routes[2].uri=lb://file
spring.cloud.gateway.routes[2].predicates[0].name=Path
spring.cloud.gateway.routes[2].predicates[0].args[0]=/file/**
```





## springboot + vue文件上传功能

type = "file" 文件上传控件

触发文件上传动作方法一： 在文件上传组件上增加change事件

teacher.vue

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" />
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<input id="file-upload-input" type="file" v-on:change="uploadImage()">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
				})
			}
		}
	}
</script>

```

后端

file controller admin

```java
package com.lzn.file.controller.admin;


import com.lzn.dto.ResponseDto;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug


        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        String key = UuidUtil.getShortUuid();
        String fullPath = "D:/code/file/teacher/" + key +"-" + fileName;
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        ResponseDto responseDto = new ResponseDto();
        return responseDto;
    }
}

```



# 讲师头像的保存和显示

## 文件访问配置

springboot 静态资源的配置，静态自愿包含图片、css、js等

file config 



```
package com.lzn.file.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class SpringMvcConfig implements WebMvcConfigurer {
//
//    @Value("${file.path}")
//    private String FILE_PATH;

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/**").addResourceLocations("file:D:/code/file/teacher/");
    }
    // http:127.0.0.1:9003/file/f/teacher/XPEC7kSP-头像1.jpg
}
```

浏览器可以直接访问到图片

http://127.0.0.1:9000/file/teacher/njSFOZ5M-%E5%A4%B4%E5%83%8F2.jpg





测试路由转发到file是否生效，

测试的时候要注意浏览器是有静态资源缓存的，可以用ctrl+f5强制刷新，

也可以用chrome 无痕浏览来测试，不会有缓存





这里测试打开不来于是开始学习，如何进行文件访问配置

https://blog.csdn.net/shuaigg001/article/details/94433969

https://www.cnblogs.com/java-synchronized/p/7091723.html





## 修改BUG

uploadController



```
package com.lzn.file.controller.admin;


import com.lzn.dto.ResponseDto;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug


        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        String key = UuidUtil.getShortUuid();
        String fullPath = "D:/code/file/teacher/" + key +"-" + fileName;
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        ResponseDto responseDto = new ResponseDto();
        return responseDto;
    }
}
```



config配置

```
package com.lzn.file.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

//@Configuration
//@EnableWebMvc
//public class SpringMvcConfig implements WebMvcConfigurer {
//    @Override
//    public void addResourceHandlers(ResourceHandlerRegistry registry) {
//        registry.addResourceHandler("/f/**")
//                .addResourceLocations("file:D:/code/file/teacher/");
//
//    }
//}


@Configuration
public  class SpringMvcConfig extends WebMvcConfigurationSupport {
    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/**")
                .addResourceLocations("file:D:/code/file/teacher/");

        super.addResourceHandlers(registry);
    }
}
```

http://127.0.0.1:9003/file/f/hc7gLRQ2-%E5%A4%B4%E5%83%8F1.jpg

为什么f 后面不能跟teacher

```
package com.lzn.file.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

//@Configuration
//@EnableWebMvc
//public class SpringMvcConfig implements WebMvcConfigurer {
//    @Override
//    public void addResourceHandlers(ResourceHandlerRegistry registry) {
//        registry.addResourceHandler("/f/**")
//                .addResourceLocations("file:D:/code/file/teacher/");
//
//    }
//}


@Configuration
public  class SpringMvcConfig extends WebMvcConfigurationSupport {
    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/teacher/**")
                .addResourceLocations("file:D:/code/file/teacher/");

        super.addResourceHandlers(registry);
    }
}
```

改成这样http://127.0.0.1:9003/file/f/teacher/hc7gLRQ2-%E5%A4%B4%E5%83%8F1.jpg 就可以访问了



图片卡单自适应bug

```html
						<img v-show="!course.image" style="width: 100%;" class="media-object img-responsive" src="/static/image/demo-course.jpg" />
						<img v-show="course.image" style="width: 100%;"  class="media-object img-responsive" v-bind:src="course.image" />
```





img-responsive : bootstrap 内置的样式，图片自适应，

前面有一个图片自适应的bug已经解决了，但是效果还是不好，如果文字过长的话，应该决定了整个页面的高度’





## 实时显示与保存

前端 teacher.vue

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable  editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" />
						<img v-show="teacher.image" class="editable  editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<input id="file-upload-input" type="file" v-on:change="uploadImage()">
									<img v-bind:src="teacher.image" class="img-responsive" >
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
					
				})
			}
		}
	}
</script>

```



## 显示美化



利用bootstrap 栅格系统，一个div是12格，可以让图片只占用4格的宽度

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" />
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<input id="file-upload-input" type="file" v-on:change="uploadImage()">
									<div v-show="teacher.image" class="row">
										<div class="col-sm-4">
											<img v-bind:src="teacher.image" class="img-responsive" >
										</div>
									
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
					
				})
			}
		}
	}
</script>

```



后端修改

```
# 系统名称
spring.application.name=file
# 系统路径
server.servlet.context-path=/file
# 系统端口
server.port=9003
# 注册中心
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
# 文件配置
file.path=D:/code/file/
file.domain=http://127.0.0.1:9000/file/


```





```
package com.lzn.file.controller.admin;


import com.lzn.dto.ResponseDto;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    @Value("${file.path}")
    private String FILE_PATH;
    @Value("${file.domain}")
    private String FILE_DOMAIN;

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug

        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        String key = UuidUtil.getShortUuid();
        String fullPath =FILE_PATH  + "teacher/" + key +"-" + fileName;
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        ResponseDto responseDto = new ResponseDto();
        responseDto.setContent(FILE_DOMAIN + "f/teacher/" + key + "-" +fileName);
        return responseDto;
    }
}
```







```
package com.lzn.file.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public  class SpringMvcConfig extends WebMvcConfigurationSupport {

    @Value("${file.path}")
    private String FILE_PATH;

    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/f/teacher/**")
                .addResourceLocations("file:" + FILE_PATH+ "/teacher/");

        super.addResourceHandlers(registry);
    }
}
```





maven多环境配置，将开发环境和生产环境配置成不同的值





# 文件上传组件开发

优化的点：

用一个单独的按钮，来代替file 空间， 且操作的流程没有变化





图片自适应调整：

1. flex  bootstrap4才有的。
2. img-responsive bootstrap自带样式



teacher.vue:

```
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" 
						 style="width: 200px;height:200px;"/>
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro"
							style="width: 200px;height:200px;"/>
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<button 
									style="margin-bottom: 5px;"
									v-on:click="selectImage()"
									type="button"
									class= "btn btn-white btn-default btn-round">
										<i class="ace-icon fa fa-upload">
											上传头像
										</i>
									</button>
									
									<div></div>
									
									<input class="hidden" id="file-upload-input" type="file" v-on:change="uploadImage()">
									<div v-show="teacher.image" class="row">
										<div class="col-sm-4">
											<img v-bind:src="teacher.image" class="img-responsive" >
										</div>
									
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				formData.append('file', document.querySelector('#file-upload-input').files[0]);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
				})
			},
			
			selectImage() {
				$("#file-upload-input").trigger("click");// 触发
			}
		}
	}
</script>

```



## 增加上传文件类型的判断

优化： 使用vue的$refs来获取组件

teacher.vue

```vue
<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" 
						 style="width: 200px;height:200px;"/>
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro"
							style="width: 200px;height:200px;"/>
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<button 
									style="margin-bottom: 5px;"
									v-on:click="selectImage()"
									type="button"
									class= "btn btn-white btn-default btn-round">
										<i class="ace-icon fa fa-upload">
											上传头像
										</i>
									</button>
									
									<div></div>
									
									<input ref="file" class="hidden" id="file-upload-input" type="file" v-on:change="uploadImage()">
									<div v-show="teacher.image" class="row">
										<div class="col-sm-4">
											<img v-bind:src="teacher.image" class="img-responsive" >
										</div>
									
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	export default {
		components: {
			Pagination
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},
			
			
			uploadImage() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				let file = _this.$refs.file.files[0];
				// 判断文件格式
				let suffixs = ["jpg", "jpeg", "png"];
				let fileName = file.name;
				let suffix = fileName.substring(fileName.lastIndexOf(".") + 1, fileName.length).toLowerCase();
				
				let validateSuffix = false;
				for(let i = 0;i<suffixs.length;++i) {
					if(suffixs[i].toLowerCase() === suffix ) {
						validateSuffix = true;
						break;
					}
				}
				
				if(!validateSuffix) {
					Toast.warning("文件格式不正确,只支持上传:" + suffixs.join(","));
					return ;
				}
				
				formData.append('file', file);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					let image = resp.content;
					console.log("头像地址:" , image);
					_this.teacher.image = image;
				})
			},
			
			selectImage() {
				$("#file-upload-input").trigger("click");// 触发
			}
		}
	}
</script>

```





## 制作文件上传公共组件

一个项目中 很多地方会用到文件上传，所以有必要把文件上传功能做成组件

props用于父子组件传递数据，可以理解成组件可配置的属性



为组件增加上传 成功后的回调函数，和组件不相关的业务代码应该由外部通过回调函数传进来

如果一个页面放了两个文件上传组件，会出现两个input的id重复

，可以把id也做成可以配置的





components file.vue

```vue
<template>
	<div>
		<button style="margin-bottom: 5px;" v-on:click="selectFile()" type="button" class="btn btn-white btn-default btn-round">
			<i class="ace-icon fa fa-upload">
				{{ text }}
			</i>
		</button>


		<input ref="file" class="hidden" v-bind:id="inputId+'-input'" type="file" v-on:change="uploadFile()">
	</div>
</template>

<script>
	export default {
		name: 'file',
		props: {
			text: {
				default: "上传文件"
			},
			inputId: {
				default: "file-upload"
			},
			suffixs: {
				default: []
			},
			afterUpload: {
				type: Function,
				default: null
			}
		},
		data: function() {
			return {

			};
		},
		methods: {

			uploadFile() {
				let _this = this;
				let formData = new window.FormData();
				// key: "file"必须和后端controller参数名一样
				let file = _this.$refs.file.files[0];
				// 判断文件格式
				let suffixs = _this.suffixs;
				let fileName = file.name;
				let suffix = fileName.substring(fileName.lastIndexOf(".") + 1, fileName.length).toLowerCase();

				let validateSuffix = false;
				for (let i = 0; i < suffixs.length; ++i) {
					if (suffixs[i].toLowerCase() === suffix) {
						validateSuffix = true;
						break;
					}
				}

				if (!validateSuffix) {
					Toast.warning("文件格式不正确,只支持上传:" + suffixs.join(","));
					$("#" + _this.inputId + "-input").val("");
					return;
				}

				formData.append('file', file);
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/upload', formData).then((response) => {
					Loading.hide();
					let resp = response.data;
					console.log("上传文件成功:", resp);
					_this.afterUpload(resp);
					
					// 清空，下次在选择同一个东西时候，也会触发
					$("#" + _this.intputId + "-input").val("");
					

				})
			},

			selectFile() {
				let _this = this;
        $("#" + _this.inputId + "-input").trigger("click");
			}
		}
	}
</script>

<style>
</style>

```





view teacher.vue

```vue

<template>
	<div>
		<p>
			<button v-on:click="add()" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-edit"></i>
				新增
			</button>
			&nbsp;
			<button v-on:click="list(1)" class="btn btn-white btn-default btn-round">
				<i class="ace-icon fa fa-refresh"></i>
				刷新
			</button>
		</p>

		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="8"></pagination>


		<div class="row">
			<div v-for="teacher in teachers" class="col-md-3">
				<div class="center">
					<span class="profile-picture">
						<img v-show="!teacher.image" class="editable img-responsive editable-click editable-empty" src="/static/image/profile-pic.jpg"
						 v-bind:title="teacher.intro" style="width: 200px;height:200px;" />
						<img v-show="teacher.image" class="editable img-responsive editable-click editable-empty" v-bind:src="teacher.image"
						 v-bind:title="teacher.intro" style="width: 200px;height:200px;" />
					</span>

					<div class="space-4"></div>

					<div class="width-85 label label-info label-xlg arrowed-in arrowed-in-right">
						<div class="inline position-relative">
							<a href="javascript:;" class="user-title-label dropdown-toggle" data-toggle="dropdown">
								<i class="ace-icon fa fa-circle light-green"></i>
								&nbsp;
								<span class="white">{{teacher.position}}</span>
							</a>
						</div>
					</div>
				</div>

				<div class="space-6"></div>

				<div class="text-center">
					<a href="javascript:;" class="text-info bigger-110" v-bind:title="teacher.motto">
						<i class="ace-icon fa fa-user"></i>
						{{teacher.name}}【{{teacher.nickname}}】
					</a>
				</div>

				<div class="space-6"></div>

				<div class="profile-social-links align-center">
					<button v-on:click="edit(teacher)" class="btn btn-xs btn-info">
						<i class="ace-icon fa fa-pencil bigger-120"></i>
					</button>
					&nbsp;
					<button v-on:click="del(teacher.id)" class="btn btn-xs btn-danger">
						<i class="ace-icon fa fa-trash-o bigger-120"></i>
					</button>
				</div>

				<div class="hr hr16 dotted"></div>

			</div>
		</div>

		<div id="form-modal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">表单</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-10">
									<input v-model="teacher.name" class="form-control">
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">昵称</label>
								<div class="col-sm-10">
									<input v-model="teacher.nickname" class="form-control">
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">头像</label>
								<div class="col-sm-10">
									<file v-bind:text="'上传头像1'" 
									v-bind:after-upload="afterUpload"
									v-bind:suffixs="['jpg', 'jpeg', 'png']"
									v-bind:input-id="'image-upload'"></file>
									
									<div v-show="teacher.image" class="row">
										<div class="col-md-4">
											<img v-bind:src="teacher.image" class="img-responsive">
										</div>
									</div>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-2 control-label">职位</label>
								<div class="col-sm-10">
									<input v-model="teacher.position" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">座右铭</label>
								<div class="col-sm-10">
									<input v-model="teacher.motto" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">简介</label>
								<div class="col-sm-10">
									<textarea v-model="teacher.intro" class="form-control" rows="5"> </textarea>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button v-on:click="save()" type="button" class="btn btn-primary">保存</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
	</div>
</template>

<script>
	import Pagination from "../../components/pagination";
	import File from "../../components/file.vue";
	export default {
		components: {
			Pagination,
			File
		},
		name: "business-teacher",
		data: function() {
			return {
				teacher: {},
				teachers: [],
			}
		},
		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);
			// sidebar激活样式方法一
			// this.$parent.activeSidebar("business-teacher-sidebar");

		},
		methods: {
			/**
			 * 点击【新增】
			 */
			add() {
				let _this = this;
				_this.teacher = {};
				$("#form-modal").modal("show");
			},

			/**
			 * 点击【编辑】
			 */
			edit(teacher) {
				let _this = this;
				_this.teacher = $.extend({}, teacher);
				$("#form-modal").modal("show");
			},

			/**
			 * 列表查询
			 */
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.teachers = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},

			/**
			 * 点击【保存】
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.teacher.name, "姓名") ||
					!Validator.length(_this.teacher.name, "姓名", 1, 50) ||
					!Validator.length(_this.teacher.nickname, "昵称", 1, 50) ||
					!Validator.length(_this.teacher.image, "头像", 1, 100) ||
					!Validator.length(_this.teacher.position, "职位", 1, 50) ||
					!Validator.length(_this.teacher.motto, "座右铭", 1, 50) ||
					!Validator.length(_this.teacher.intro, "简介", 1, 500)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/business/admin/teacher/save', _this.teacher).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						$("#form-modal").modal("hide");
						_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 点击【删除】
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除讲师后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/business/admin/teacher/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			},

			afterUpload(resp) {
				let _this = this;
				let image = resp.content;
				console.log("头像地址:" , image);
				_this.teacher.image = image;
			}
		}
	}
</script>

```





# 增加文件管理功能

## 文件表设计与基本代码生成

```sql
-- 文件
drop table if exists `file`;
create table `file` (
  `id` char(8) not null default '' comment 'id',
  `path` varchar(100) not null comment '相对路径',
  `name` varchar(100) comment '文件名',
  `suffix` varchar(10) comment '后缀',
  `size` int comment '大小|字节B',
  `use` char(1) comment '用途|枚举[FileUseEnum]：COURSE("C", "讲师"), TEACHER("T", "课程")',
  `created_at` datetime(3) comment '创建时间',
  `updated_at` datetime(3) comment '修改时间',
  primary key (`id`),
  unique key `path_unique` (`path`)
) engine=innodb default charset=utf8mb4 comment='文件';
```





持久层

```
<table tableName="file" domainObjectName="File"/>
```



服务层  生成



server enum：

```java
package com.lzn.enums;

public enum FileUseEnum {

    COURSE("C", "课程"),
    TEACHER("T", "讲师");

    private String code;

    private String desc;

    FileUseEnum(String code, String desc) {
        this.code = code;
        this.desc = desc;
    }

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public void setDesc(String desc) {
        this.desc = desc;
    }

    public String getDesc() {
        return desc;
    }

    public static FileUseEnum getByCode(String code){
        for(FileUseEnum e: FileUseEnum.values()){
            if(code.equals(e.getCode())){
                return e;
            }
        }
        return  null;
    }
}

```



然后枚举类生成

```
package com.lzn.generator.enums;


import com.lzn.enums.*;

import java.io.FileOutputStream;
import java.io.OutputStreamWriter;
import java.lang.reflect.Method;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class EnumGenerator {
    static String path = "D:\\code\\course-project\\admin\\public\\static\\js\\enums.js";

    public static void main(String[] args) {
        StringBuffer bufferObject = new StringBuffer();
        StringBuffer bufferArray = new StringBuffer();
        long begin = System.currentTimeMillis();
        try {
            toJson(SectionChargeEnum.class, bufferObject, bufferArray);
            toJson(YesNoEnum.class, bufferObject, bufferArray);
            toJson(CourseLevelEnum.class, bufferObject, bufferArray);
            toJson(CourseStatusEnum.class, bufferObject, bufferArray);
            toJson(CourseChargeEnum.class, bufferObject, bufferArray);
            toJson(FileUseEnum.class, bufferObject, bufferArray);


            StringBuffer buffer = bufferObject.append("\r\n").append(bufferArray);
            writeJs(buffer);
        } catch (Exception e) {
            e.printStackTrace();
        }
        long end = System.currentTimeMillis();
        System.out.println("执行耗时:" + (end - begin) + " 毫秒");
    }

    private static void toJson(Class clazz, StringBuffer bufferObject, StringBuffer bufferArray) throws Exception {
        String key = toUnderline(clazz.getSimpleName());
        toJson(clazz, key, bufferObject, bufferArray);
    }

    private static void toJson(Class clazz, String key, StringBuffer bufferObject, StringBuffer bufferArray) throws Exception {
        Object[] objects = clazz.getEnumConstants();
        Method name = clazz.getMethod("name");
        Method getDesc = clazz.getMethod("getDesc");
        Method getCode = clazz.getMethod("getCode");

        // 生成对象
        bufferObject.append(key).append("={");
        for (int i = 0; i < objects.length; i++) {
            Object obj = objects[i];
            if (getCode == null) {
                bufferObject.append(name.invoke(obj)).append(":{key:\"").append(name.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            } else {
                bufferObject.append(name.invoke(obj)).append(":{key:\"").append(getCode.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            }
            if (i < objects.length - 1) {
                bufferObject.append(",");
            }
        }
        bufferObject.append("};\r\n");

        // 生成数组
        bufferArray.append(key).append("_ARRAY=[");
        for (int i = 0; i < objects.length; i++) {
            Object obj = objects[i];
            if (getCode == null) {
                bufferArray.append("{key:\"").append(name.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            } else {
                bufferArray.append("{key:\"").append(getCode.invoke(obj)).append("\", value:\"").append(getDesc.invoke(obj)).append("\"}");
            }
            if (i < objects.length - 1) {
                bufferArray.append(",");
            }
        }
        bufferArray.append("];\r\n");
    }

    /**
     * 写文件
     * @param stringBuffer
     */
    public static void writeJs(StringBuffer stringBuffer) {
        FileOutputStream out = null;
        try {
            out = new FileOutputStream(path);
            OutputStreamWriter osw = new OutputStreamWriter(out, "UTF-8");
            System.out.println(path);
            osw.write(stringBuffer.toString());
            osw.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        finally {
            try {
                out.close();
            } catch (Exception e) {
                e.printStackTrace();
            }

        }
    }

    /**
     * 功能：驼峰转大写下划线，并去掉_ENUM
     * 如：SectionChargeEnum 变成 SECTION_CHARGE
     * @param str
     * @return
     */
    public static String toUnderline(String str) {
        String result = underline(str).toString();
        return result.substring(1, result.length()).toUpperCase().replace("_ENUM", "");
    }

    /**
     * 驼峰转下划线，第一位是下划线
     * 如：SectionChargeEnum 变成 _section_charge_enum
     * @param str
     * @return
     */
    private static StringBuffer underline(String str) {
        Pattern pattern = Pattern.compile("[A-Z]");
        Matcher matcher = pattern.matcher(str);
        StringBuffer sb = new StringBuffer(str);
        if(matcher.find()) {
            sb = new StringBuffer();
            matcher.appendReplacement(sb,"_"+matcher.group(0).toLowerCase());
            matcher.appendTail(sb);
        }else {
            return sb;
        }
        return underline(sb.toString());
    }
}
```

再运行





vue生成

-----



# 重点！



我先重写了前端 用vuetify

在另外一个仓库里

另外小节保存时长更新有个bug，需要修改sql，已经完成



todo: 修改前端代码生成器





从这里开始 就开始用新的前端模板了

navbar.vue

				<v-list-group :value="true" prepend-icon="apps" color="blue" no-action="">
					<template v-slot:activator>
						<v-list-item-content>
							<v-list-item-title>文件管理</v-list-item-title>
						</v-list-item-content>
					</template>
				
					<v-list-item to="/file/file">
						<v-list-item-content>
							<v-list-item-title>文件管理</v-list-item-title>
						</v-list-item-content>
					</v-list-item>


route index.js

```js
import Vue from 'vue'
// import VueRouter from 'vue-router'
import Router from 'vue-router'
// 导入组件
import Login from '../views/login.vue'
import Admin from '../views/admin.vue'
import Welcome from '../views/admin/welcome.vue'
import Category from '../views/admin/category.vue'
import Teacher from '../views/admin/teacher.vue'
import Course from '../views/admin/course.vue'
import Chapter from '../views/admin/chapter.vue'
import Section from '../views/admin/section.vue'
import File from '../views/admin/file.vue'
// Vue.use(VueRouter);
Vue.use(Router);

// const routes = [
	
// ]

// const router = new VueRouter({
//   mode: 'history',
//   base: process.env.BASE_URL,
//   routes
// })

// export default router
export default new Router(
    {
        mode: 'history', // history hash 推荐使用history hash 的话前面由前缀，url形式不美观，history推荐使用，路由前面只有以恶搞#
        base: process.env.BASE_URL,
        routes: [{
            path: '*',
            redirect: "/login",
        }, {
            path: "/login",
            component: Login
        }, {
            path: "/",
            name: "admin", 
            // name属性后面会用到
            component: Admin,
            children: [{
                path: 'welcome',
                name: 'welcome',
                component: Welcome
            }, {
                path: 'business/category',
                name: 'business/category',
                component: Category
            }, {
							path: 'business/teacher',
							name: 'business/teacher',
							component: Teacher
						}, {
							path: 'business/course',
							name: 'business/course',
							component: Course
						}, {
							path: 'business/chapter',
							name: 'business/chapter',
							component: Chapter
						}, {
							path: 'business/section',
							name: 'business/section',
							component: Section
						}, {
							path: 'file/file',
							name: 'file/file',
							component: File
						}]
        }],
				
				ScrollBehavior(to ,from, savedPosition) {
					return {x: 0, y:0};
				}
    }

)
```



mapper 自动配置文件钟

```
<property name="autoDelimitKeywords" value="true"/>
```

可以自动检测关键字



server 生成器

```
static String MODULE = "file";
```

vue 生成器

```
static String MODULE = "file";
```

然后再生成



## 上传文件保存文件记录

统一文件名为 8 位uuid文件后缀，后面会进一步规范文件名

修改file 属性配置

```
# 系统名称
spring.application.name=file
# 系统路径
server.servlet.context-path=/file
# 系统端口
server.port=9003
# 注册中心
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
# 文件配置
file.path=D:/code/file/
file.domain=http://127.0.0.1:9000/file/f/
```





uploadController

```
package com.lzn.file.controller.admin;


import com.lzn.dto.FileDto;
import com.lzn.dto.ResponseDto;
import com.lzn.service.FileService;
import com.lzn.util.UuidUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;


@RequestMapping("/admin")
@RestController
public class UploadController {

    @Value("${file.path}")
    private String FILE_PATH;
    @Value("${file.domain}")
    private String FILE_DOMAIN;

    @Autowired
    private FileService fileService;

    private static final Logger LOG = LoggerFactory.getLogger(
            UploadController.class
    );


    public static final String BUSINESS_NAME = "文件上传";


    @RequestMapping("/upload")
    public ResponseDto upload(
            @RequestParam MultipartFile file
            ) throws IOException {
//        debug

        LOG.info("上传文件开始:{}", file);
        LOG.info(file.getOriginalFilename());
        LOG.info(String.valueOf(file.getSize()));

        // 保存文件到本地
        String fileName=  file.getOriginalFilename();
        // 文件后缀
        String suffix = fileName.substring(fileName.lastIndexOf(".") + 1).toLowerCase();
        String key = UuidUtil.getShortUuid();
        String path  = "teacher/" + key + "." + suffix;

        String fullPath =FILE_PATH  + path;
        // 文件的路径应该是自动生成的
        File dest = new File(fullPath);// 生成目标位置
        file.transferTo(dest);// 写道目标位置
        LOG.info(dest.getAbsolutePath());

        LOG.info("保存文件记录开始");
        FileDto fileDto = new FileDto();
        fileDto.setPath(path);
        fileDto.setName(fileName);
        fileDto.setSize(Math.toIntExact(file.getSize()));
        fileDto.setSuffix(suffix);
        fileDto.setUse("");


        fileService.save(fileDto);


        ResponseDto responseDto = new ResponseDto();
        responseDto.setContent(FILE_DOMAIN + path);
        return responseDto;
    }
}

```



文件记录不允许编辑和删除，但是可以做一些统计功能，比如文件大小统计，文件类型统计，也可以增加文件审核功能，对不合规的图片、视频做处理



file.vue 去掉 新增、编辑、删除功能

```vue
<!-- 小节页面 -->
<template>
	<v-app class="ma-3" app>
		<v-dialog v-model="dialog" persistent max-width="300">
			<v-card>
				<v-card-title>
					表单
				</v-card-title>

				<v-card-text>
					<v-col cols="12">
						<v-text-field label="相对路径" v-model="file.path" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-text-field label="文件名" v-model="file.name" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-text-field label="后缀" v-model="file.suffix" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-text-field label="大小" v-model="file.size" required></v-text-field>
					</v-col>
					<v-col cols="12">
						<v-select label="用途" v-model="file.use" :items="FILE_USE" item-text="value" item-value="key"></v-select>
					</v-col>

				</v-card-text>
				<v-card-actions>
					<v-spacer></v-spacer>
					<v-btn @click="dialog = false" clas="info">
						取消
					</v-btn>

					<v-btn @click="save()" class="success">
						保存
					</v-btn>
				</v-card-actions>
			</v-card>
		</v-dialog>


		<p class="ma-10">

<!-- 			<v-btn class="mr-5 mb-5" color="primary" @click="add()">
				<v-icon left small>add</v-icon>
				新增
			</v-btn>
 -->
			<v-btn class="mb-5" color="primary" @click="list(1)">
				<v-icon left small>refresh</v-icon>
				刷新
			</v-btn>

		</p>


		<pagination ref="pagination" v-bind:list="list" v-bind:itemCount="5"></pagination>


		<v-container>
			<v-row>
				<v-col cols="12">
					<v-simple-table>
						<thead>
							<tr>
								<th class="primary--text text-h6 text-center">id</th>
								<th class="primary--text text-h6 text-center">相对路径</th>
								<th class="primary--text text-h6 text-center">文件名</th>
								<th class="primary--text text-h6 text-center">后缀</th>
								<th class="primary--text text-h6 text-center">大小</th>
								<th class="primary--text text-h6 text-center">用途</th>
				<!-- 				<th class="primary--text  text-h6 text-center">
									操作
								</th> -->
							</tr>
						</thead>
						<tbody>
							<tr v-for="file in files" class="text-center">

								<td>{{file.id}}</td>
								<td>{{file.path}}</td>
								<td>{{file.name}}</td>
								<td>{{file.suffix}}</td>
								<td>{{file.size}}</td>
								<td>{{FILE_USE | optionKV(file.use)}}</td>
<!-- 
								<td>
									<v-row align="center" justify="space-around">
										<v-btn x-small fab @click="edit(file)" class="primary">
											<v-icon>edit</v-icon>
										</v-btn>

										<v-btn x-small fab @click="del(file.id)" class="warning">
											<v-icon>delete</v-icon>
										</v-btn>
									</v-row>
								</td> -->
							</tr>
						</tbody>
					</v-simple-table>
				</v-col>
			</v-row>
		</v-container>

	</v-app>
</template>

<script>
	import Pagination from "../../components/pagination.vue";
	export default {
		name: "file-file",
		components: {
			Pagination
		},

		data: function() {
			return {
				file: {},
				files: [],
				FILE_USE: FILE_USE_ARRAY,

				dialog: false,
			}
		},

		mounted: function() {
			let _this = this;
			_this.$refs.pagination.size = 5;
			_this.list(1);

		},

		methods: {
			// 获取所有小节的数据
			list(page) {
				let _this = this;
				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/file/list', {
					page: page,
					size: _this.$refs.pagination.size,
				}).then((response) => {
					Loading.hide();
					let resp = response.data;
					_this.files = resp.content.list;
					_this.$refs.pagination.render(page, resp.content.total);

				})
			},
			/**
			 * 新增小节
			 */
			add() {
				let _this = this;
				_this.file = {};
				_this.dialog = true;
			},

			/**
			 * 编辑小节
			 */
			edit(file) {
				let _this = this;
				_this.file = $.extend({}, file);
				_this.dialog = true;
			},

			/**
			 * 保存
			 */
			save() {
				let _this = this;

				// 保存校验
				if (1 != 1 ||
					!Validator.require(_this.file.path, "相对路径") ||
					!Validator.length(_this.file.path, "相对路径", 1, 100) ||
					!Validator.length(_this.file.name, "文件名", 1, 100) ||
					!Validator.length(_this.file.suffix, "后缀", 1, 10)
				) {
					return;
				}

				Loading.show();
				_this.$ajax.post(process.env.VUE_APP_SERVER + '/file/admin/file/save', _this.file).then((response) => {
					Loading.hide();
					let resp = response.data;
					if (resp.success) {
						_this.dialog = false,
							_this.list(1);
						Toast.success("保存成功！");
					} else {
						Toast.warning(resp.message)
					}
				})
			},

			/**
			 * 删除小节
			 */
			del(id) {
				let _this = this;
				Confirm.show("删除文件后不可恢复，确认删除？", function() {
					Loading.show();
					_this.$ajax.delete(process.env.VUE_APP_SERVER + '/file/admin/file/delete/' + id).then((response) => {
						Loading.hide();
						let resp = response.data;
						if (resp.success) {
							_this.list(1);
							Toast.success("删除成功！");
						}
					})
				});
			}
		}
	}
</script>

<style>
</style>

```



## 文件格式化

filter.js

```JS
/**
 * 数组过滤器 例如：{{SECTION_CHARGE | optionKV(section.charge)}}
 * @param object 例如：{CHARGE:{key:"C", value:"收费"},FREE:{key:"F", value:"免费"}}
 * @param key 例如：C
 * @returns {string} 例如：收费
 */
let optionKV = (object, key) =>  {
    if (!object || !key) {
        return "";
    } else {
        let result = "";
        for(let enums in object){
            if (key === object[enums]["key"]) {
                result = object[enums]["value"];
            }
        }
        return result;
    }
};
/**
 * 数组过滤器 例如：{{CHARGE | optionKVArray(section.charge)}}
 * @param list 例如：[{key:"C", value:"收费"},{key:"F", value:"免费"}]
 * @param key 例如：C
 * @returns {string} 例如：收费
 */
let optionKVArray = (list, key) =>  {
    if (!list || !key) {
        return "";
    } else {
        let result = "";
        for (let i = 0; i < list.length; i++) {
            if (key === list[i]["key"]) {
                result = list[i]["value"];
            }
        }
        return result;
    }
};



/**
 * 时长格式化
 * @param value 例如：36000
 * @returns {string} 例如：10:00:00
 */
let formatSecond = (value) => {
    value = value || 0;
    let second = parseInt(value, 10); // 秒
    let minute = 0; // 分
    let hour = 0; // 小时
    if (second > 60) {
        // 当大于60秒时，才需要做转换
        minute = Math.floor(second / 60);
        second = Math.floor(second % 60);
        if (minute > 60) {
            hour = Math.floor(minute / 60);
            minute = Math.floor(minute % 60);
        }
    } else {
        // 小于60秒时，直接显示，不需要处理
    }
    let result = "" + PrefixInteger(second, 2) + "";
    // 拼上分钟
    result = "" + PrefixInteger(minute, 2) + ":" + result;
    // 拼上小时
    result = "" + PrefixInteger(hour, 2) + ":" + result;
    return result;
};



/**
 * 格式化指定长度，前面补0
 */
function PrefixInteger(num, length) {
    return (Array(length).join('0') + num).slice(-length);
}

/**
 * 格式化文件大小
 * @param value
 * @returns {string}
 */
let formatFileSize = (value) => {
    value = value || 0;
    let result;
    if (value > 100 * 1024) {
        result = Math.round((value / 1024 / 1024) * 100) / 100 + "MB";
    } else {
        result = Math.round((value / 1024) * 100) / 100 + "KB";
    }
    return result;
};


/**
 * 控制长度
 */
function ellipsis(value) {
    if(!value) return '';
    if(value.length > 32) {
        return value.slice(0,32)+ '...';
    }
    return value;
}


export default {
    optionKV,
    formatSecond,
    ellipsis,
		formatFileSize
}
```





file.vue

​		<td>{{file.size | formatFileSize }}</td>



